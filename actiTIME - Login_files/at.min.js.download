function SubmitTTCommentsManager(){}
SubmitTTCommentsManager.prototype.init=function(a){this.VIEW_DESCRIPTION_POPUP_CAPTION=messageResource.getMessage("submit_tt.comments.view_description_popup_caption");this.EDIT_DESCRIPTION_POPUP_CAPTION=messageResource.getMessage("submit_tt.comments.edit_description_popup_caption");this.Messages={MODIFICATIONS_NOT_SAVED:messageResource.getMessage("submit_tt.comments.modifications_not_saved"),TIMEOUT_DESCRIPTION_SAVING:messageResource.getMessage("submit_tt.comments.timeout_description_saving"),TIMEOUT_DESCRIPTION_LOADING:messageResource.getMessage("submit_tt.comments.timeout_description_loading"),
ERROR_DESCRIPTION_SAVING:messageResource.getMessage("submit_tt.comments.error_description_saving"),ERROR_DESCRIPTION_LOADING:messageResource.getMessage("submit_tt.comments.error_description_loading"),TEXT_AREA_NOTE_NAME:messageResource.getMessage("submit_tt.comments.text_area_note_name"),TOO_LONG_DESCRIPTION:function(a){return messageResource.getMessage("submit_tt.comments.too_long_description",[a])}};this.showCommentsUtil=this;this.imgEntered=imgPath("dialogs/comments/comment_entered.png");this.imgBlank=
imgPath("dialogs/comments/comment_blank.png");this.state={};this.state.userId=a.userId;this.reloadPageFunction=a.reloadPageFunction;this.updateImgFunction=a.updateImgFunction;this.updateFormFunction=a.updateFormFunction;this.entityType="comment";return this};SubmitTTCommentsManager.prototype.doLoadDescription=function(a,b){this.loadComment(b)};SubmitTTCommentsManager.prototype.doSaveDescription=function(a,b,c){this.saveComment(b,c)};
SubmitTTCommentsManager.prototype.saveState=function(a,b,c){this.state.taskId=a;this.state.day=b;this.state.date=parseDate(c,"yyyy-MM-dd")};SubmitTTCommentsManager.prototype.showEditableComment=function(a,b,c,d,e){this.saveState(a,b,c);showSavingDescriptionWithDefaultOffset("",e,this.showCommentsUtil,document.getElementById(d),!1,this.imgEntered,this.imgBlank,void 0,{onCloseTabMessage:this.Messages.MODIFICATIONS_NOT_SAVED})};
SubmitTTCommentsManager.prototype.showReadOnlyComment=function(a,b,c,d,e){this.saveState(a,b,c);showDescriptionWithDefaultOffset(a+"_"+b,e,this.showCommentsUtil,document.getElementById(d))};SubmitTTCommentsManager.prototype.loadComment=function(a){var b=this;makeRpcCall("EnterTTService.loadComment",[this.state.userId,this.state.taskId,this.state.date],function(c){a(c?c:"");b.updateImg(c)},function(a,d,e){return b.errorHandler(e)})};
SubmitTTCommentsManager.prototype.saveComment=function(a,b){var c=this;makeRpcCall("EnterTTService.saveComment",[this.state.userId,this.state.taskId,this.state.date,a],function(){b&&b();c.updateForm(a)},function(a,b,f){return c.errorHandler(f)})};SubmitTTCommentsManager.prototype.updateImg=function(a){this.updateImgFunction();this.updateForm(a)};SubmitTTCommentsManager.prototype.updateForm=function(a){this.updateFormFunction(this.state.taskId,this.state.day,a)};
SubmitTTCommentsManager.prototype.reloadPage=function(){this.reloadPageFunction()};
SubmitTTCommentsManager.prototype.errorsMap={"com.actimind.actitime.administration.NoSuchUserException":"submit_tt.js.comments.error_user_was_deleted","com.actimind.actitime.task.NoSuchTaskException":"submit_tt.js.comments.error_task_was_deleted","com.actimind.actitime.services.NoRightsForRemoteCallException":"submit_tt.js.comments.error_no_rights_for_this_operation","com.actimind.actitime.services.NoRightsForManagingOtherUsersException":"submit_tt.js.comments.error_no_rights_for_managing_other_users","com.actimind.actitime.services.NoRightsToSubmitTTException":"submit_tt.js.comments.error_no_rights_for_submitting_tt",
"com.actimind.actitime.administration.NoRightsToViewUsersTimeTrack":"submit_tt.js.comments.error_no_rights_to_manage_selected_user_tt","com.actimind.actitime.task.TaskIsNotAssignedToUserException":"submit_tt.js.comments.error_task_is_not_assigned","com.actimind.actitime.task.DayIsLockedException":"submit_tt.js.comments.error_day_is_locked","com.actimind.actitime.task.TaskCompletedException":"submit_tt.js.comments.error_task_completed","com.actimind.actitime.services.DateBeforeHireDateException":"submit_tt.js.comments.error_day_before_hire_date"};
SubmitTTCommentsManager.prototype.cleanupRetryController=function(){descriptionCleanup();descriptionSavingCleanup(!0)};
SubmitTTCommentsManager.prototype.errorHandler=function(a){var b=this.errorsMap[a.exception];return b?(this.cleanupRetryController(),alert(messageResource.getMessage(b)),this.reloadPage(),!0):"com.actimind.actitime.administration.FutureDatesTimeTrackingIsRestrictedException"==a.exception?(this.cleanupRetryController(),alert(messageResource.getMessage("submit_tt.js.comments.error_day_is_in_future")),!0):!1};var operationConfirmDlg=null;function highlightText(a){return'<span class="highlightText">'+a+"</span>"}function highlightNumber(a){return'<span class="highlightNumber">'+a+"</span>"}
function OperationConfirmDlg(){this.confirmDlgDiv=$("#operationConfirmDialogDiv");this.dialogInnerDiv=this.confirmDlgDiv.find(".confirmDialogInnerDiv");this.dialogTable=this.confirmDlgDiv.find(".confirmDialogTable");this.header=this.confirmDlgDiv.find(".header");this.message=this.confirmDlgDiv.find(".confirmMessage");this.attention=this.confirmDlgDiv.find(".operationAttention");this.confirmButton=this.confirmDlgDiv.find(".confirmDialogApplyButton");this.confirmAnotherButton=this.confirmDlgDiv.find(".confirmDialogApplyAnotherButton");
this.cancelButton=this.confirmDlgDiv.find(".confirmDialogCancelButton");this.onConfirm=void 0;this.attentionTitleText=""}OperationConfirmDlg.prototype.open=function(a){KeyDownHandler.setOnKeyDownHandler(function(a){handleEscape(function(){operationConfirmDlg.close()},a)});var b=this;(this.withoutMoireMode=a?!0:!1)||showMoire("moireDiv","container");this.confirmDlgDiv.show();this.positionDlg();window.setTimeout(function(){try{b.confirmButton.focus()}catch(a){}},200)};
OperationConfirmDlg.prototype.confirmClick=function(){this.close();if(this.onConfirm)this.onConfirm(1)};OperationConfirmDlg.prototype.confirmAnotherClick=function(){this.close();if(this.onConfirm)this.onConfirm(2)};OperationConfirmDlg.prototype.cancelClick=function(){this.close();if(this.onCancel)this.onCancel()};OperationConfirmDlg.prototype.close=function(){KeyDownHandler.restoreOnKeyDownHandler();this.confirmDlgDiv.hide();this.withoutMoireMode||hideMoire("moireDiv");if(this.onClose)this.onClose()};
OperationConfirmDlg.prototype.positionDlg=function(){var a=getBodyScrollTop();this.confirmDlgDiv.css({top:a+"px"});this.dialogInnerDiv.css({"margin-top":-this.dialogTable.height()/2+"px"});this.dialogTable.width(this.width);this.dialogInnerDiv.width(this.dialogTable.width());this.dialogInnerDiv.height(this.dialogTable.height())};
OperationConfirmDlg.prototype.initWithDataAsConfirmDeletionDialog=function(a,b,c,d,e,f){""==this.attentionTitleText&&(this.attentionTitleText=messageResource.getMessage("operation.confirm.dialog.attention"));this.dialogTable.toggleClass("attention",a);this.attention.get(0).innerHTML=(a?"<div class='attention'>"+this.attentionTitleText+"</div>":"")+e;this.initWithData(b,c,messageResource.getMessage("delete.confirm.dialog.about_to_delete",[d]),messageResource.getMessage("common.cancel"),{onConfirm:f},
!1,!1)};
OperationConfirmDlg.prototype.initWithData=function(a,b,c,d,e,f,g){this.header.html(a);this.confirmButton.prop("value",b[0]);b[1]?(this.confirmAnotherButton.show(),this.confirmAnotherButton.prop("value",b[1])):(this.confirmAnotherButton.hide(),this.confirmAnotherButton.prop("value",""));this.message.html(c);this.cancelButton.prop("value",d);this.onConfirm=e.onConfirm;this.onCancel=e.onCancel;this.onClose=e.onClose;this.dialogInnerDiv.toggleClass("hideExclamationMarkSection",f);this.dialogInnerDiv.toggleClass("smallDialog",g)};function SmartDate(a,b,c){this.dateFormat=c;this.dateFieldFunc=a;this.dateHolderFunc=b;this.holderDateFormat="yyyy-MM-dd";this.updateHolder(this.parseDate())}SmartDate.prototype.getDateField=function(){return this.dateFieldFunc()};SmartDate.prototype.getDateFieldValue=function(){return this.dateFieldFunc().value};SmartDate.prototype.getHolderValue=function(){return this.dateHolderFunc().value};SmartDate.prototype.isParseable=function(){return null!=this.parseDate()};
SmartDate.prototype.isEmpty=function(){return 0==trim(this.getDateFieldValue()).length};SmartDate.prototype.updateHolder=function(a){if(null==a)this.setHolderValue("");else{var b=new DateFormat(this.holderDateFormat);this.setHolderValue(b.formatDate(a))}};SmartDate.prototype.setDate=function(a){if(null==a)this.setDateFieldValue("");else{var b=new DateFormat(this.dateFormat);this.setDateFieldValue(b.formatDate(a));this.updateHolder(a)}};
SmartDate.prototype.parseDate=function(){if(this.isEmpty())return null;var a=parseDate(this.getDateFieldValue(),this.dateFormat);if(a){var b=new DateFormat(this.dateFormat);this.setDateFieldValue(b.formatDate(a));return a}return null};SmartDate.prototype.parseDateAndUpdateHolder=function(){var a=this.parseDate();this.updateHolder(a);return a};SmartDate.prototype.setDateFieldValue=function(a){this.dateFieldFunc().value=a};SmartDate.prototype.setHolderValue=function(a){this.dateHolderFunc().value=a};
SmartDate.prototype.checkDate=function(a){this.parseDateAndUpdateHolder();return this.isEmpty()?!0:null==this.parseDate()?(a&&(alert(messageResource.getMessage("common.js.invalid_date")),this.getDateField().focus()),!1):!0};function renderTTAHistoryTable(a,b,c){function d(){return $("<td></td>")}function e(a){return d().append(a).addClass("dateCell")}function f(a,b){var c=d().addClass("statusCell");if(a==WeekApprovalStatus.READY)c.append(messageResource.getMessage("submit_tt.tta_history.table.status_text.ready"));else if(a==WeekApprovalStatus.APPROVED)c.append(b?messageResource.getMessage("submit_tt.tta_history.table.status_text.auto_approved"):messageResource.getMessage("submit_tt.tta_history.table.status_text.approved")).addClass("approved");
else if(a==WeekApprovalStatus.REJECTED)c.append(messageResource.getMessage("submit_tt.tta_history.table.status_text.rejected")).addClass("rejected");else throw Error("Wrong history response format");return c}function g(a,c){var e=d().addClass("userCell");c||e.append(b==a.id?messageResource.getMessage("submit_tt.tta_history.table.user_text.me"):escapeHtmlSymbols(UserNameFormat.formatFML(a.firstName,a.lastName,a.middleName)));return e}function h(a){return d().append(escapeHtmlSymbols(a)).addClass("commentCell")}
a=a.find(".tableContentContainer table tbody");a.empty();c&&0!=c.length||a.append('<tr><td colspan="4" class="emptyTable">'+messageResource.getMessage("submit_tt.tta_history.table.empty")+"</td></tr>");for(var k="",m=0,l=c.length;m<l;m++){var k=c[m],p=null==k.approverNameInfo,k=$("<tr/>").append(e(k.statusChangeDateInViewerTimezone)).append(f(k.status,p)).append(g(k.approverNameInfo,p)).append(h(k.comment));m==l-1&&k.addClass("lastRow");a.append(k)}};function TaskDeadlineCellRenderer(){}TaskDeadlineCellRenderer.prototype=_.create(TableCellRenderer.prototype);TaskDeadlineCellRenderer.prototype.init=function(a,b,c,d,e,f,g){TableCellRenderer.call(this);this.weekStartDay=a;this.scheduleCalculator=b;this.changesCallback=c;this.scrollableContainer=d;this.noValueMessage=e;this.deadlineInThePastMessage=f;this.checkPastDate=g;return this};
TaskDeadlineCellRenderer.prototype.generateContent=function(a,b){a.getCellEl().innerHTML="<div></div>";var c=this,d=document.createElement("div");$(d).addClass("clearDate");$(d).click(function(){a.setValue(null);a.updateUI();c.changesCallback(a)});var e=document.createElement("div");$(e).addClass("clearDateContainer");e.appendChild(d);b||a.getCellEl().firstChild.appendChild(e);var f=new DateSelector({minValue:new Date(1970,0,1),weekStartDay:this.weekStartDay,renderTo:a.getCellEl().firstChild,scheduleCalculator:this.scheduleCalculator,
date:a.getValue(),format:Date.convertSmartToExtDateFormat(SystemSettings.dateFormat).replace(/F/,"M"),scrollableContainer:this.scrollableContainer,displayValue:function(a){this.setText(a?this.formatDate(a):c.noValueMessage)},renderDateMenuToContent:!1});f.on("change",function(){a.setValue(f.getValue());a.updateUI();c.changesCallback(a)});a.dateSelector=f;b&&a.getCellEl().firstChild.appendChild(e)};
TaskDeadlineCellRenderer.prototype.updateUI=function(a){TableCellRenderer.prototype.updateUI.call(this,a);this.updateDeadlineCell(a)};
TaskDeadlineCellRenderer.prototype.updateDeadlineCell=function(a){var b=a.getValue();if(b){var c=currentUserTime().clearTime().getTime();this.checkPastDate&&c>b.getTime()?($(a.getCellEl()).addClass("deadlineInPast"),a.getCellEl().title=this.deadlineInThePastMessage):($(a.getCellEl()).removeClass("deadlineInPast"),a.getCellEl().title="");$(a.getCellEl()).removeClass("deadlineNotSet");a.dateSelector.setValue(b)}else $(a.getCellEl()).addClass("deadlineNotSet"),$(a.getCellEl()).removeClass("deadlineInPast"),
a.getCellEl().title="",a.dateSelector.unsetValue()};TaskDeadlineCellRenderer.prototype.getCellClassName=function(a){return["deadlineCell"]};function TaskEstimateCellRenderer(){}TaskEstimateCellRenderer.prototype=_.create(TableCellRenderer.prototype);TaskEstimateCellRenderer.prototype.init=function(a){TableCellRenderer.call(this);this.changesCallback=a;return this};
TaskEstimateCellRenderer.prototype.generateContent=function(a){var b=this,c=createElementWithProperties("input",{type:"text",value:a.getValue(),maxLength:"6",onblur:function(){this.prevValue==this.value||void 0===this.prevValue&&""==this.value||(a.setValue($(this).pVal()),a.updateUI(),b.changesCallback(a),this.prevValue=this.value)}});$(c).addClass("inputFieldWithPlaceholder");$(c).attr("placeholder",messageResource.getMessage("add_new_tasks.task_estimate.placeholder"));$(c).placeholder();a.getCellEl().appendChild(c);
a.estimateInput=c};TaskEstimateCellRenderer.prototype.updateUI=function(a){TableCellRenderer.prototype.updateUI.call(this,a);$(a.estimateInput).removeClass("error");a.estimateInput.title="";if(a.isEmpty())$(a.estimateInput).pVal("");else if(a.isValid()){var b=UserTime.parseTimeWithSystemSettings(a.getValue()),b=UserTime.formatTime(b);$(a.estimateInput).pVal(b)}else $(a.estimateInput).addClass("error"),a.estimateInput.title=messageResource.getMessage("add_new_tasks.err_invalid_budget",[SystemSettings.decimalSeparator])};
TaskEstimateCellRenderer.prototype.getCellClassName=function(a){return["estimateCell"]};function TaskEstimateCellValidator(){}TaskEstimateCellValidator.prototype=_.create(TabularDataTableCellValidator.prototype);TaskEstimateCellValidator.prototype.isEmpty=function(a){return""==a.getValue()};TaskEstimateCellValidator.prototype.isValid=function(a){a=a.getValue();a=""!=a?UserTime.parseTimeWithSystemSettings(a):"";return!spentTimeIsInvalid(a)&&6E7>a};function CreateNewTasksTable(){this.constructor=CreateNewTasksTable}CreateNewTasksTable.prototype=_.create(Table.prototype);
CreateNewTasksTable.prototype.init=function(a,b,c,d,e,f,g,h,k,m,l,p,t,x,u,y,v){Table.call(this,a);this.theadEl=a;this.billingTypes=e;this.defaultBillingTypeId=f;this.weekStartDay=h;this.scheduleCalculator=k;this.defaultAddToTTValue=l;this.showAddToTTColumn=m;this.showBillingTypeColumn=g;this.estEnabled=p;this.scrollableContainer=v;this.changesCallback=function(a){a&&a.getRow().updateClearLineCell();x()};var r=this;this.nameCellRenderer=(new TaskNameCellRenderer).init(this.changesCallback,function(){r.markRowsWithEqualNamesAsInvalid()});
this.descriptionCellRenderer=(new TaskDescriptionCellRenderer).init(u,this.changesCallback);this.estEnabled&&(this.estimateCellRenderer=(new TaskEstimateCellRenderer).init(this.changesCallback));this.deadlineCellRenderer=(new TaskDeadlineCellRenderer).init(this.weekStartDay,this.scheduleCalculator,this.changesCallback,this.scrollableContainer,messageResource.getMessage("add_new_tasks.set_deadline"),messageResource.getMessage("add_new_tasks.js.deadline_is_in_past"),!0);this.billingTypeCellRenderer=
this.billingTypes&&this.showBillingTypeColumn?(new TaskBillingTypeCellRenderer).init(this.billingTypes,this.defaultBillingTypeId,this.changesCallback,this.scrollableContainer):null;this.clearLineCellRenderer=(new TaskClearLineCellRenderer).init();this.addToTTCellRenderer=this.showAddToTTColumn?(new TaskAddToTTCellRenderer).init(function(){r.updateAddAllToTTCheckboxValue()}):null;this.nameCellValidator=new TaskNameCellValidator;this.descriptionCellValidator=new TaskDescriptionCellValidator;this.estEnabled&&
(this.estimateCellValidator=new TaskEstimateCellValidator);this.showBillingTypeColumn&&(this.billingTypeCellValidator=new TaskBillingTypeCellValidator);this.addAllToTTCheckbox=(new CustomCheckbox({checkmarkAdditionalClass:"checkMark",onChange:function(a){r.updateAllCheckboxesAccordingToHeaderCheckbox(a)}})).init($(a).find(".tableHeaderCheckboxContainer"));this.validateCallback=t;this.hideDescriptionPopupCallback=y;insertBefore(b,a);this.createBodyContent(d,c);return this};
CreateNewTasksTable.prototype.updateAllCheckboxesAccordingToHeaderCheckbox=function(a){for(var b=0;b<this.rows.length;b++)this.rows[b].setAddToTTValue({checked:a.checked})};CreateNewTasksTable.prototype.updateAddAllToTTCheckboxValue=function(){if(this.showAddToTTColumn){for(var a=!0,b=0;b<this.rows.length;b++)this.rows[b].addToTTCell.addToTTCheckbox.isChecked()||(a=!1);this.addAllToTTCheckbox.setState({checked:a})}};
CreateNewTasksTable.prototype.createBodyContent=function(a,b){var c=b;if(a&&0<a.length){for(var d=0;d<a;d++)this.addRow(this.createRow(a[d]));c-=a.length}for(d=0;d<c;d++)this.addRow(this.createEmptyRow())};
CreateNewTasksTable.prototype.createRow=function(a){return(new CreateNewTasksTableRow).init(a,this.nameCellRenderer,this.nameCellValidator,this.descriptionCellRenderer,this.descriptionCellValidator,this.estimateCellRenderer,this.estimateCellValidator,this.deadlineCellRenderer,this.billingTypeCellRenderer,this.billingTypeCellValidator,this.addToTTCellRenderer,this.clearLineCellRenderer)};
CreateNewTasksTable.prototype.createEmptyRow=function(){return this.createRow({name:"",description:"",estimate:"",deadline:null})};CreateNewTasksTable.prototype.buildDOM=function(a){Table.prototype.buildDOM.call(this,a);this.updateTableClasses()};CreateNewTasksTable.prototype.addNonEmptyRow=function(a){a=this.createRow(a);this.addRow(a);a.buildDOM(this.getTBody());a.writeCellsContent();a.getRowEl().className=this.getRowElClasses(a.getRowIdx()).join(" ");this.updateAddAllToTTCheckboxValue()};
CreateNewTasksTable.prototype.addTasks=function(a){for(var b=this.rows.length;0<b&&this.rows[b-1].isEmpty();)b--;for(var c=0;c<a.length;c++){var d=a[c];d.estimate=d.budgetedTime;b<this.rows.length?this.replaceRowAndUpdateDOM(b,this.createRow(a[c])):this.addNonEmptyRow(a[c]);b++}0<a.length&&this.changesCallback();this.markRowsWithEqualNamesAsInvalid()};
CreateNewTasksTable.prototype.addEmptyRow=function(){var a=this.createEmptyRow();this.addRow(a);a.buildDOM(this.getTBody());a.writeCellsContent();a.getRowEl().className=this.getRowElClasses(a.getRowIdx()).join(" ");this.updateAddAllToTTCheckboxValue();a.hasErrors()||$(this).trigger("schedulesChanged")};CreateNewTasksTable.prototype.addEmptyRows=function(a){for(var b=0;b<a;b++)this.addEmptyRow()};
CreateNewTasksTable.prototype.replaceRowWithNewEmptyRow=function(a){this.replaceRowAndUpdateDOM(a,this.createEmptyRow());this.markRowsWithEqualNamesAsInvalid()};CreateNewTasksTable.prototype.updateTableClasses=function(){var a=this.getBaseTableClasses();this.tableEl.className=a.join(" ")};
CreateNewTasksTable.prototype.getBaseTableClasses=function(){var a=["createTasksTable"];this.billingTypes&&this.showBillingTypeColumn||a.push("hideBillingType");this.estEnabled||a.push("hideEstimate");this.showAddToTTColumn||a.push("hideAddToTT");return a};CreateNewTasksTable.prototype.getTasks=function(){for(var a=[],b=0;b<this.rows.length;b++)if(!this.rows[b].isEmpty()){var c=this.rows[b].getTask();a.push(c)}return a};
CreateNewTasksTable.prototype.getNotEmptyRowsNumbers=function(){for(var a=[],b=0;b<this.rows.length;b++)this.rows[b].isEmpty()||a.push(b);return a};CreateNewTasksTable.prototype._validationDetected=function(){this.validateCallback&&this.validateCallback()};
CreateNewTasksTable.prototype.validate=function(){for(var a=this.isEmpty(),b=!a,c=0;c<this.rows.length;c++)var d=this.rows[c].validate(),b=b&&d;a&&(a=this.rows[0].cells[0],a.setInvalid(),a.tooltip="",a.updateUI());a=this.markRowsWithEqualNamesAsInvalid();return b&&!a};CreateNewTasksTable.prototype.hasErrors=function(){for(var a=0;a<this.rows.length;a++)if(this.rows[a].hasErrors())return!0;return!1};
CreateNewTasksTable.prototype.isEmpty=function(){for(var a=0;a<this.rows.length;a++)if(!this.rows[a].isEmpty())return!1;return!0};CreateNewTasksTable.prototype.markRowsWithEqualNamesAsInvalid=function(){for(var a=this.getRowsWithEqualNames(),b=!1,c=0;c<this.rows.length;c++){var d=this.rows[c].cells[0];a[c]?(d.setInvalid(),d.tooltip=messageResource.getMessage("add_new_tasks.err_duplicate_task_name"),b=!0):d.isEmpty()||d.setValid();d.updateUI()}return b};
CreateNewTasksTable.prototype.getRowsWithEqualNames=function(){for(var a={},b=[!1],c=0;c<this.rows.length;c++){var d=this.rows[c].cells[0].getValue().toLowerCase();""!=d&&(a.hasOwnProperty(d)?b[c]=!0:a[d]=c)}return b};CreateNewTasksTable.prototype.updateUI=function(){this.updateTableClasses();for(var a=0;a<this.rows.length;a++)this.rows[a].updateUI();this.updateAddAllToTTCheckboxValue()};
CreateNewTasksTable.prototype.showTaskNameExistsError=function(a,b){var c=this.rows[a].cells[0];c.setInvalid();c.tooltip=b?messageResource.getMessage("add_new_tasks.err_duplicate_detected.completed_task"):messageResource.getMessage("add_new_tasks.err_duplicate_detected.open_task");c.updateUI()};CreateNewTasksTable.prototype.updateBillingTypes=function(a){for(var b=0;b<this.rows.length;b++)this.rows[b].updateBillingTypes(a);this.validate()};CreateNewTasksTable.prototype.hideDescriptionPopup=function(a){this.hideDescriptionPopupCallback(a)};
CreateNewTasksTable.prototype.disableTextSelection=function(){};function CreateNewTasksTableRow(){}CreateNewTasksTableRow.prototype=_.create(TableRow.prototype);
CreateNewTasksTableRow.prototype.init=function(a,b,c,d,e,f,g,h,k,m,l,p){TableRow.call(this);this.nameCell=this.createNameCell(a.name,b,c);this.addCellObj(this.nameCell);this.descriptionCell=this.createDescriptionCell(a.description,d,e);this.addCellObj(this.descriptionCell);f&&(this.estimateCell=this.createEstimateCell(a.estimate,f,g),this.addCellObj(this.estimateCell));this.deadlineCell=this.createDeadlineCell(a.deadline,h);this.addCellObj(this.deadlineCell);k&&(this.billingTypeCell=this.createBillingTypeCell(a.billingType,
k,m),this.addCellObj(this.billingTypeCell));l&&(this.addToTTCell=this.createAddToTTCell(a.addToTT,l),this.addCellObj(this.addToTTCell));this.clearLineCell=this.createClearLineCell(p);this.addCellObj(this.clearLineCell);return this};CreateNewTasksTableRow.prototype.writeCellsContent=function(){for(var a=this.getCells(),b=0;b<a.length;b++)a[b].writeContent()};CreateNewTasksTableRow.prototype.updateUI=function(){for(var a=0;a<this.cells.length;a++)this.updateCellUI(a)};
CreateNewTasksTableRow.prototype.updateClearLineCell=function(){this.clearLineCell.updateUI()};CreateNewTasksTableRow.prototype.isEmpty=function(){var a=this.nameCell.isEmpty()&&this.descriptionCell.isEmpty()&&null==this.deadlineCell.getValue();this.estimateCell&&(a=a&&this.estimateCell.isEmpty());return a};CreateNewTasksTableRow.prototype.isModified=function(){var a=!this.isEmpty();this.billingTypeCell&&(a=a||this.billingTypeCell.getValue()!=this.getTable().defaultBillingTypeId);return a};
CreateNewTasksTableRow.prototype.validate=function(){this.nameCell.validate(!1);this.descriptionCell.validate(!0);this.estimateCell&&this.estimateCell.validate(!0);this.billingTypeCell&&this.billingTypeCell.validate(!1);this.isEmpty()&&(this.nameCell.setValid(),this.estimateCell&&this.estimateCell.setValid());this.nameCell.isValid()||(this.nameCell.tooltip=messageResource.getMessage("add_new_tasks.err_task_name_empty"));this.updateUI();return!this.hasErrors()};
CreateNewTasksTableRow.prototype.hasErrors=function(){return!this.nameCell.isValid()||!this.descriptionCell.isValid()||this.estimateCell&&!this.estimateCell.isValid()||this.billingTypeCell&&this.billingTypeCell.isEmpty()?!0:!1};
CreateNewTasksTableRow.prototype.clearLine=function(){this.isModified()?confirm(messageResource.getMessage("add_new_tasks.js.modification_will_lost_confirm"))&&(this.getTable().replaceRowWithNewEmptyRow(this.rowIdx),this.getTable().hideDescriptionPopup()):this.addToTTCell&&(this.addToTTCell.setValue(!1),this.addToTTCell.updateUI());this.getTable().updateAddAllToTTCheckboxValue()};
CreateNewTasksTableRow.prototype.getTask=function(){var a=this.addToTTCell?this.addToTTCell.getValue():this.getTable().defaultAddToTTValue?!0:!1,a={name:this.nameCell.getValue(),description:this.descriptionCell.getValue(),deadline:this.deadlineCell.getValue(),markedToBeAddedToUserTasks:a};this.estimateCell&&(a.budgetedTime=this.estimateCell.getValue()?UserTime.parseTimeWithSystemSettings(this.estimateCell.getValue()):null);a.billingType=this.billingTypeCell?this.billingTypeCell.getValue():this.getTable().defaultBillingTypeId;
return a};CreateNewTasksTableRow.prototype.setAddToTTValue=function(a){this.addToTTCell&&(this.addToTTCell.addToTTCheckbox.setState(a),this.updateUI())};CreateNewTasksTableRow.prototype.createNameCell=function(a,b,c){a=(new TabularDataTableCell).init(a,c,this);a.setRenderer(b);return a};CreateNewTasksTableRow.prototype.createDescriptionCell=function(a,b,c){a=(new TabularDataTableCell).init(a,c,this);a.setRenderer(b);return a};
CreateNewTasksTableRow.prototype.createEstimateCell=function(a,b,c){a=a||0===a?UserTime.formatTime(a):"";c=(new TabularDataTableCell).init(a,c,this);c.setRenderer(b);return c};CreateNewTasksTableRow.prototype.createDeadlineCell=function(a,b){var c=new TableCell(a,this);c.setRenderer(b);return c};CreateNewTasksTableRow.prototype.createBillingTypeCell=function(a,b,c){a=(new TabularDataTableCell).init(a,c,this);a.setRenderer(b);return a};
CreateNewTasksTableRow.prototype.createAddToTTCell=function(a,b){var c=new TableCell(a,this);c.setRenderer(b);return c};CreateNewTasksTableRow.prototype.createClearLineCell=function(a){var b=new TableCell(null,this);b.setRenderer(a);return b};CreateNewTasksTableRow.prototype.updateBillingTypes=function(a){this.billingTypeCell.getRenderer().updateBillingTypes(a);$(this.billingTypeCell.getCellEl()).empty();this.billingTypeCell.writeContent();this.updateUI()};
CreateNewTasksTableRow.prototype.highlight=function(){$(this.getRowEl()).addClass("highlighted")};CreateNewTasksTableRow.prototype.unhighlight=function(){$(this.getRowEl()).removeClass("highlighted")};function TaskNameCellRenderer(){}TaskNameCellRenderer.prototype=_.create(TableCellRenderer.prototype);TaskNameCellRenderer.prototype.init=function(a,b){TableCellRenderer.call(this);this.changesCallback=a;this.checkDuplicatesCallback=b;return this};
TaskNameCellRenderer.prototype.generateContent=function(a){var b=this,c=createElementWithProperties("input",{type:"text",maxLength:window.__GENERATED_CONSTANTS__.EntityTextLimits.MAX_CPT_NAME,onkeyup:function(){this.keyUpValue!=this.value&&(a.setValue($(this).pVal()),b.changesCallback(a),this.keyUpValue=this.value)},onblur:function(){this.blurValue==this.value||void 0===this.blurValue&&""==this.value||(a.setValue($(this).pVal().trim()),b.changesCallback(a),b.checkDuplicatesCallback(),this.blurValue=
this.value)},value:a.getValue()});$(c).addClass("inputFieldWithPlaceholder");$(c).attr("placeholder",messageResource.getMessage("add_new_tasks.task_name.placeholder"));$(c).placeholder();a.getCellEl().appendChild(c);a.nameInput=c};
TaskNameCellRenderer.prototype.updateUI=function(a){TableCellRenderer.prototype.updateUI.call(this,a);$(a.nameInput).pVal(a.getValue());a.isValid()?($(a.nameInput).removeClass("error"),a.nameInput.title=""):($(a.nameInput).addClass("error"),a.nameInput.title=a.tooltip?a.tooltip:"")};TaskNameCellRenderer.prototype.getCellClassName=function(a){return["nameCell"]};function TaskNameCellValidator(){}TaskNameCellValidator.prototype=_.create(TabularDataTableCellValidator.prototype);TaskNameCellValidator.prototype.isEmpty=function(a){return""==a.getValue()};TaskNameCellValidator.prototype.isValid=function(a){return!0};function TaskDescriptionCellRenderer(){}TaskDescriptionCellRenderer.prototype=_.create(TableCellRenderer.prototype);TaskDescriptionCellRenderer.prototype.init=function(a,b){TableCellRenderer.call(this);this.descriptionTitle=messageResource.getMessage("add_new_tasks_tooltip_enable_description.task");this.showTaskDescriptionPopupCallback=a;this.changesCallback=b;return this};
TaskDescriptionCellRenderer.prototype.generateContent=function(a){var b=document.createElement("table");b.className="descriptionCellTable";var c=document.createElement("tbody");b.appendChild(c);var d=document.createElement("tr");c.appendChild(d);var e="descriptionCell"+a.getRow().getRowIdx(),f=createElementWithProperties("td",{id:e}),g=this;f.appendChild(this.buildDescriptionElement(a,a.getValue(),function(){g.showTaskDescriptionPopupCallback(a.getValue(),e,f,function(b){a.setValue(b);a.updateUI();
g.changesCallback(a)})}));d.appendChild(f);a.getCellEl().appendChild(b)};TaskDescriptionCellRenderer.prototype.buildDescriptionElement=function(a,b,c){b=createElementWithProperties("a",{id:"descriptionElement",href:"#",title:this.descriptionTitle,onclick:function(){c()}});var d=document.createElement("img");b.appendChild(d);this.setDescriptionImage(d,a.isEmpty());a.descriptionImg=d;return b};
TaskDescriptionCellRenderer.prototype.setDescriptionImage=function(a,b){a.src=b?imgPath("dialogs/comments/comment_blank.png"):imgPath("dialogs/comments/comment_entered.png")};TaskDescriptionCellRenderer.prototype.updateUI=function(a){TableCellRenderer.prototype.updateUI.call(this,a);this.setDescriptionImage(a.descriptionImg,a.isEmpty());a.isValid()?$(a.getCellEl()).removeClass("error"):$(a.getCellEl()).addClass("error")};TaskDescriptionCellRenderer.prototype.getCellClassName=function(a){return["descriptionCell"]};function TaskDescriptionCellValidator(){}TaskDescriptionCellValidator.prototype=_.create(TabularDataTableCellValidator.prototype);TaskDescriptionCellValidator.prototype.isEmpty=function(a){return _.isEmpty(a.getValue())};TaskDescriptionCellValidator.prototype.isValid=function(a){return 2E3>=trim(a.getValue()).length};function TaskBillingTypeCellValidator(){}TaskBillingTypeCellValidator.BILLING_TYPE_NOT_SELECTED_VALUE=-1;TaskBillingTypeCellValidator.prototype=_.create(TabularDataTableCellValidator.prototype);TaskBillingTypeCellValidator.prototype.isEmpty=function(a){return a.getValue()==TaskBillingTypeCellValidator.BILLING_TYPE_NOT_SELECTED_VALUE};TaskBillingTypeCellValidator.prototype.isValid=function(a){return!0};function TaskClearLineCellRenderer(){}TaskClearLineCellRenderer.prototype=_.create(TableCellRenderer.prototype);TaskClearLineCellRenderer.prototype.init=function(){TableCellRenderer.call(this);return this};
TaskClearLineCellRenderer.prototype.generateContent=function(a){var b=document.createElement("div");b.className="clearLine";a.getCellEl().appendChild(b);a.getCellEl().title=messageResource.getMessage("add_new_tasks.clear_line_tooltip");$(a.getCellEl()).click(function(){a.getRow().clearLine()});$(a.getCellEl()).hover(function(){a.getRow().isModified()&&(a.getRow().highlight(),$(a.getCellEl()).addClass("active"))},function(){a.getRow().isModified()&&(a.getRow().unhighlight(),$(a.getCellEl()).removeClass("active"))})};
TaskClearLineCellRenderer.prototype.updateUI=function(a){TableCellRenderer.prototype.updateUI.call(this,a);a.getCellEl().title=messageResource.getMessage("add_new_tasks.clear_line_tooltip");a.getRow().isModified()?($(a.getCellEl()).addClass("modified"),a.getCellEl().title=messageResource.getMessage("add_new_tasks.clear_line_tooltip")):($(a.getCellEl()).removeClass("modified"),a.getCellEl().title="")};TaskClearLineCellRenderer.prototype.getCellClassName=function(a){return["clearLineCell"]};function TaskAddToTTCellRenderer(){}TaskAddToTTCellRenderer.prototype=_.create(TableCellRenderer.prototype);TaskAddToTTCellRenderer.prototype.init=function(a){TableCellRenderer.call(this);this.updateAddAllToTTCheckboxCallback=a;return this};TaskAddToTTCellRenderer.prototype.generateContent=function(a){var b=this;a.addToTTCheckbox=(new CustomCheckbox({containerAdditionalClass:"checkboxContainer",checkmarkAdditionalClass:"checkMark",onChange:function(c){a.setValue(c.checked);b.updateAddAllToTTCheckboxCallback()}})).init($(a.getCellEl()))};
TaskAddToTTCellRenderer.prototype.updateUI=function(a){TableCellRenderer.prototype.updateUI.call(this,a);$(a.addToTTCheckbox).attr("checked",1==a.getValue())};TaskAddToTTCellRenderer.prototype.getCellClassName=function(a){return["addToTTCell"]};function initTaskSelectControl(a,b,c,d,e,f,g,h,k){function m(a){var b=w.prop("checked")?A:B,d=w.prop("checked")?B:A;q.setInActiveProjects(!w.prop("checked"));d.hideSelector();b.showSelector();z=b;if(!b.isInitialized()&&null==D||a)b.spin(),D=makeRpcCall("RetrieveCustomersProjectsService.getCustomersProjectsForTaskSelectControl",[c],t,x)}function l(){n.hasClass("hidden")||(n.addClass("hidden"),r.removeClass("active"),KeyDownHandler.restoreOnKeyDownHandler(),z.closeDropdown(),u(0,0))}function p(a){n.find(".filterPanel").hide();
q.clearQuery(a)}function t(a){B.init(a,!0);A.init(a,!1);z.stopSpin()}function x(a,b,c){z.stopSpin();l();D=null;return"com.actimind.actitime.administration.NoSuchUserException"==c.exception?(document.location.reload(),!0):!1}function u(a,b){p(!0);0!=a||0!=b?(n.find(".pleaseSelectCustomerOrProject").hide(),n.find(".selectorFilterButton").prop("disabled",!1),q.makeInitialRequest(a,b)):(q.clear(),n.find(".pleaseSelectCustomerOrProject").show(),n.find(".selectorFilterButton").prop("disabled",!0))}function y(a){a=
a||window.event;a.keyCode==KEY_CODE_ESC&&(1==n.find(".filterPanel:visible").length?p():l())}var v=$("#"+a),r=$(b),n=v.find(".addTasksPanel"),C=n.find(f?".importSelectedButton":".addSelectedButton"),w=n.find("#importArchivedCheckbox");f&&(n.find(".importArchivedLabel").text(truncateStringByLength(messageResource.getMessage("task_selector.import_archived"),35,35)),n.find(".buttonImportTitle").text(truncateStringByLength(messageResource.getMessage("task_selector.import_selected"),30,30)));var E=n.find("#importDescriptionsCheckbox"),
D=null,B=new CPSelectorController(n.find(".customerProjectSelector.activeProjects"),u),A=new CPSelectorController(n.find(".customerProjectSelector.archivedProjects"),u),z=w.prop("checked")?A:B,q=new TaskListController({container:n.find(".taskList"),searchField:n.find(".filterField"),initialRequestSpinnerPlaceholder:n.find(".spinnerPlaceholder"),isOwnTimeTrack:e,isImportTasksMode:f,desiredPortionSize:100,maxResultsPerPortion:150,isMultiSelect:!0,onSelectionChange:function(){C.toggleClass("disabled",
0==q.getSelectedTaskIds().length);C.prop("disabled",0==q.getSelectedTaskIds().length)}});q.setData(c,d,g);r.click(function(){if(n.is(":visible"))l();else if(n.hasClass("hidden")&&(n.removeClass("hidden"),f&&v.position({of:r,at:"left bottom",my:"left top",collision:"none"}),r.addClass("active"),m(!0),KeyDownHandler.setOnKeyDownHandler(y),smoothlyScrollDownToElement(n,5),k))$(k).one("scroll",l)});C.click(function(){if(!C.hasClass("disabled")){var a=void 0,b=0,c=0;q.isSelectAllRows()?(b=q.getCustomerId(),
c=q.getProjectId()):a=q.getSelectedTaskIds();l();z.hideSelector();h(a,E.prop("checked"),b,c,!w.prop("checked"))}});w.click(function(){m()});setMouseDownOutsideHandler(v,function(a){0==$(a.target).closest(r).length&&l()});n.find(".selectorFilterButton").click(function(){n.find(".filterPanel").show();n.find(".filterField").focus()});n.find(".filterPanel .closeButton").click(function(){p()});n.find(".selectAllButton").click(function(){q.selectAll()});n.find(".unselectAllButton").click(function(){q.unselectAll()})}
;function initTaskSearchControl(a,b,c,d,e,f,g,h){a=$("#"+a);var k=a.find(".taskSearchField"),m=messageResource.getMessage("submit_tt.task_search.label_1");22<m.length&&(m=messageResource.getMessage("submit_tt.task_search.label_2"),20<m.length&&(m=messageResource.getMessage("submit_tt.task_search.label_3")));k.attr("placeholder",m).placeholder();if(h){var l=new TaskListController({container:a.find(".taskList"),searchField:k,initialRequestSpinnerPlaceholder:$("#"+g),isOwnTimeTrack:d,desiredPortionSize:20,
maxResultsPerPortion:30,isEnableKeyboardNavigation:!0,isHideOnEmptyQuery:!0,onRequestProcessingComplete:function(){k.focus()},onTaskSelect:function(a){f(a);k.blur();l.clearQuery()},needClearButton:!0});l.setData(b,c,e);setMouseDownOutsideHandler(a,function(){l.hide()})}else k.prop("disabled",!0)};function initRecentTasksControl(a,b,c,d,e,f,g){function h(a){a=a||window.event;a.keyCode==KEY_CODE_ESC&&k()}function k(){l.isShown()&&(m.removeClass("active"),l.hide(),KeyDownHandler.restoreOnKeyDownHandler())}a=$("#"+a);var m=a.find(".addTasksButton"),l=new TaskListController({container:a.find(".taskList"),searchField:null,initialRequestSpinnerPlaceholder:$("#"+g),isOwnTimeTrack:d,isRecentTasksMode:!0,isImportTasksMode:!1,desiredPortionSize:30,maxResultsPerPortion:30,onTaskSelect:function(a){f(a);
m.removeClass("active")}});l.setData(b,c,e);m.click(function(){l.isShown()?(k(),m.removeClass("active")):(l.makeInitialRequest(0,0),KeyDownHandler.setOnKeyDownHandler(h),m.addClass("active"))});setMouseDownOutsideHandler(a,function(){k()})};prepareNameAsArray.defaultNameMaxLength=43;function prepareNameAsArray(a,b,c,d,e,f){var g;g="";c||(c=prepareNameAsArray.defaultNameMaxLength);e||(e="(archived)");f&&d&&!b&&(c-=e.length);a=a.length>c?a.substring(0,c)+"...":a;d&&!b&&(g+=e);result=[];result[0]=a;0<g.length&&(result[1]=g);return result}function prepareName(a,b,c,d,e,f){a=prepareNameAsArray(a,b,c,d,e,f);b=a[0];for(c=1;c<a.length;c++)b+=" "+a[c];return b}function getSimpleTextNameFromArray(a){return null==a?"":a.join(" ")}
function OldCustomer(a,b,c,d,e){this.id=a;this.name=d?prepareName(b,c,e,!0):b;this.fullName=b;this.active=c;this.archived=!c}function OldProject(a,b,c,d,e,f){this.id=a;this.name=e?prepareName(b,c,f,!0):b;this.active=c;this.archived=!c;this.customerId=d}
function loadCustomers(a,b){var c=a.customerProjectStatus[0].checked,d=a.customerId;if(d){var e;0<=d.selectedIndex&&(e=d.options[d.selectedIndex].value);var f=[];b||(f[0]=c?{name:"-- "+messageResource.getMessage("customers_projects.All_active_customers_filter_value")+" --",value:0}:{name:"-- "+messageResource.getMessage("customers_projects.All_customers_filter_value")+" --",value:0});for(i=0;i<customers.length;i++)if(c&&customers[i].active||!c)f[f.length]={name:customers[i].name,value:customers[i].id};
c=0;b&&(c=1);fillInSelect(d,f,c);selectOptionWithValue(d,e)}}function loadProjects(a,b){var c=getCustomerProjectsOptions(a.customerId.options[a.customerId.selectedIndex].value,a.customerProjectStatus[0].checked,b),d;0<=a.projectId.selectedIndex&&(d=a.projectId.options[a.projectId.selectedIndex].value);fillInSelect(a.projectId,c,0);selectOptionWithValue(a.projectId,d)}
function fillInSelect(a,b,c,d){a.options.length=c;for(i=0;i<b.length;i++){var e=b[i].name;71<=b[i].name.length&&(e=b[i].name.substring(0,70)+"...");a.options[c+i]="undefined"!=typeof d&&d==b[i].value?new Option(e,b[i].value,!0,!0):new Option(e,b[i].value)}}function clearSelect(a){a.options.length=0}
function getCustomerProjectsOptions(a,b,c){var d=[];c||(d[0]=b?{name:"-- "+messageResource.getMessage("customers_projects.All_active_projects_filter_value")+" --",value:0}:{name:"-- "+messageResource.getMessage("customers_projects.All_projects_filter_value")+" --",value:0});for(i=0;i<projects.length;i++)if(b)(0>=a||projects[i].customerId==a)&&projects[i].active&&(d[d.length]={name:projects[i].name,value:projects[i].id});else if(0>=a||projects[i].customerId==a)d[d.length]={name:projects[i].name,value:projects[i].id};
return d}function selectOptionWithValue(a,b){if(b)for(i=0;i<a.options.length;i++)if(b==a.options[i].value){a.options[i].selected=!0;break}}function selectCustomer(a,b){0>=b?a.customerId.selectedIndex=0:selectOptionWithValue(a.customerId,b);loadProjects(a)}function findProjectCustomerId(a){for(i=0;i<projects.length;i++)if(projects[i].id==a)return projects[i].customerId;return-1}function customerHasProjects(a){for(i=0;i<projects.length;i++)if(projects[i].customerId==a)return!0;return!1};function CustomerProjectOutputData(a,b,c){this.customerName=a;this.projectName=b;this.entityArchived=c}function CPSelectorClientUtil(){}CPSelectorClientUtil.DEFAULT_SPINNER_OPTS={lines:11,length:4,width:3,radius:8,corners:1,rotate:0,direction:1,color:"#a0a0a0",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2E9,top:"auto",left:"auto"};
CPSelectorClientUtil.makePredefinedSelection=function(a,b,c){if(b.optionValue==CoarseSelection.SPECIFIC){var d=b.selection.getFirstLevel().slice(0),e=b.selection.getSecondLevel().slice(0);1==d.length+e.length&&(0==e.length?d[0]=new OldCustomer(d[0],c.customerName,c.entityArchived):e[0]=new OldProject(e[0],c.projectName,c.entityArchived));return a.getSelectionHelper().getDescription(new TwoLevelSelection(d,e),void 0,b.showInactive)}return b.optionValue==CoarseSelection.ALL?a.getAllSelectedMessage():
a.getAllActiveItemsMessage()};CPSelectorClientUtil.handleChange=function(a){a.isAlreadyShown()&&handleChange(!0)};Ext.namespace("AT");
AT.CustomerProjectSelectorActiveOnlyPanel=Ext.extend(AT.CustomerProjectSelectorPanel,{allItemsOptionLabelKeyNotFiltered:"projects_customers_selector.all_active_projects_customers",allItemsOptionLabelKeyFiltered:"projects_customers_selector.all_active_projects_customers_filtered",showShowInactiveCheckbox:!1,createSelectionFilters:function(){},getAllActiveItemsMessage:function(){return messageResource.getEscapedMessage(this.getAllItemsOptionLabelKey())},getShowInactive:function(){return!1},setFilterFlag:function(a){this.showInactive=
!1},updateState:function(){this.selectOption(this.optionValue)},disableTextSelectionForNeededElements:function(){disableTextSelection(this.customOptionsContainer.el.dom)}});function BaseRetrieveCustomersProjectsRPCManager(){RpcControlManager.call(this);this.selectorMenu=null}BaseRetrieveCustomersProjectsRPCManager.prototype=_.create(RpcControlManager.prototype);BaseRetrieveCustomersProjectsRPCManager.prototype.getService=function(){return jsonrpc.RetrieveCustomersProjectsService};BaseRetrieveCustomersProjectsRPCManager.prototype.getMethods=function(){return["RetrieveCustomersProjectsService.getActiveCustomersProjects","RetrieveCustomersProjectsService.getAllCustomersProjects"]};
BaseRetrieveCustomersProjectsRPCManager.prototype.setSelectorMenu=function(a){this.selectorMenu=a};BaseRetrieveCustomersProjectsRPCManager.prototype.setSpinner=function(a){this.spinner=a};BaseRetrieveCustomersProjectsRPCManager.prototype.getSpinner=function(){return this.spinner};BaseRetrieveCustomersProjectsRPCManager.prototype.onDataSavingComplete=function(a){this.spinner.stop();this.selectorMenu.panel.initializeSelector(a)};
BaseRetrieveCustomersProjectsRPCManager.prototype.endSavingData=function(a){a||(this.selectorMenu.hide(),this.selectorMenu.panel.enableControls())};BaseRetrieveCustomersProjectsRPCManager.prototype.getTimeoutMsg=function(){return messageResource.getMessage("common.ajax.timeout.read_data")};BaseRetrieveCustomersProjectsRPCManager.prototype.getRpcErrorMsg=function(){return messageResource.getMessage("common.ajax.unexpected_server_error")};function RetrieveAllCustomersProjectsRPCManager(a){BaseRetrieveCustomersProjectsRPCManager.call(this);this.filterByAssignments=a}RetrieveAllCustomersProjectsRPCManager.prototype=_.create(BaseRetrieveCustomersProjectsRPCManager.prototype);RetrieveAllCustomersProjectsRPCManager.prototype.makeRemoteCall=function(a){this.getService().getAllCustomersProjects(a,this.filterByAssignments)};function RetrieveActiveCustomersProjectsRPCManager(){BaseRetrieveCustomersProjectsRPCManager.call(this)}RetrieveActiveCustomersProjectsRPCManager.prototype=_.create(BaseRetrieveCustomersProjectsRPCManager.prototype);RetrieveActiveCustomersProjectsRPCManager.prototype.makeRemoteCall=function(a){this.getService().getActiveCustomersProjects(a)};ReportPreviewUtils={getCSVTimeValue:function(){return"1"+SystemSettings.decimalSeparator+"2345"},getHTMLTimeValue:function(a){return messageResource.getMessage(a==TimeFormat.TIME?"common.hh_mm":"common.##_##")},countNotEmptyLevels:function(a){for(var b=0,c=0;c<a.length;c++)a[c]!=ReportGroupingLevel.NONE&&b++;return b},filterNotEmptyLevels:function(a){for(var b=[],c=0;c<a.length;c++)a[c]!=ReportGroupingLevel.NONE&&b.push(a[c]);return b},checkGroupingLevel:function(a,b){for(var c=0;c<b.length;c++)if(a==
b[c])return!0;return!1},createCell:function(a,b,c,d){var e=document.createElement("td");e.innerHTML=a;b&&(e.className=b);c&&(e.colSpan=c);d&&(e.rowSpan=d);return e},addCreatedCell:function(a,b){a.appendChild(b)},addCell:function(a,b,c,d,e){a.appendChild(ReportPreviewUtils.createCell(escapeHtmlSymbols(b),c,d,e))},createCellWithFloatingContent:function(a,b,c,d){var e="floatingContainer";b&&(e+=" "+b);a="<div class='floatingContent'>"+escapeHtmlSymbols(a)+"</div>";return ReportPreviewUtils.createCell(a,
e,c,d)},addCellWithFloatingContent:function(a,b){a.appendChild(ReportPreviewUtils.createCellWithFloatingContent(b))},addCSVTimeValueCell:function(a){ReportPreviewUtils.addCell(a,ReportPreviewUtils.getCSVTimeValue())},addHTMLTimeValueCell:function(a,b,c){ReportPreviewUtils.addCell(a,ReportPreviewUtils.getHTMLTimeValue(b),"timeValueCell "+(c?c:""))},addEmptyCell:function(a){ReportPreviewUtils.addCell(a,"")},addEmptyCells:function(a,b){for(var c=0;c<b;c++)ReportPreviewUtils.addEmptyCell(a)},addSheetHeaderRow:function(a,
b){var c=document.createElement("tr");c.className="csvPreviewHeaderRow";c.appendChild(ReportPreviewUtils.createCell("","csvTolLeftCell"));for(var d=0;d<b;d++){var e=String.fromCharCode(65+d);c.appendChild(ReportPreviewUtils.createCell(e,e))}a.appendChild(c)},getLevelPreviewName:function(a){switch(a){case ReportGroupingLevel.BILLING_TYPE:return messageResource.getMessage("report.billing_type");case ReportGroupingLevel.CUSTOMER:return SystemSettings.firstLevelNamingSingular;case ReportGroupingLevel.PROJECT:return SystemSettings.secondLevelNamingSingular;
case ReportGroupingLevel.PROJECT_NAME:return SystemSettings.secondLevelNamingSingular;case ReportGroupingLevel.TASK:return SystemSettings.thirdLevelNamingSingular;case ReportGroupingLevel.TASK_NAME:return SystemSettings.thirdLevelNamingSingular;case ReportGroupingLevel.USER:return messageResource.getMessage("report.user");case ReportGroupingLevel.USER_GROUP:return SystemSettings.userGroupNamingSingular;case ReportGroupingLevel.TIME_ZONE_GROUP:return messageResource.getMessage("common.Time_Zone_Group");
case ReportGroupingLevel.USER_RATE:return messageResource.getMessage("report.cost.rate");case ReportGroupingLevel.TT_COMMENTS:return messageResource.getMessage("reports.comments_report.report.comments");case ReportGroupingLevel.DATE:return messageResource.getMessage("report.date");case ReportGroupingLevel.WEEK:return messageResource.getMessage("report.week");case ReportGroupingLevel.MONTH:return messageResource.getMessage("report.month");default:return"None"}},getGroupingOptionName:function(a){switch(a){case ReportGroupingLevel.BILLING_TYPE:return messageResource.getMessage("report.common.billing_types");
case ReportGroupingLevel.CUSTOMER:return SystemSettings.firstLevelNamingPlural;case ReportGroupingLevel.PROJECT:return SystemSettings.secondLevelNamingPlural;case ReportGroupingLevel.PROJECT_NAME:return messageResource.getMessage("report.projects_joined_by_name");case ReportGroupingLevel.TASK:return SystemSettings.thirdLevelNamingPlural;case ReportGroupingLevel.TASK_NAME:return messageResource.getMessage("report.tasks_joined_by_name");case ReportGroupingLevel.USER:return messageResource.getMessage("report.users");
case ReportGroupingLevel.USER_GROUP:return SystemSettings.userGroupNamingPlural;case ReportGroupingLevel.TIME_ZONE_GROUP:return messageResource.getMessage("common.Time_Zone_Groups");case ReportGroupingLevel.TT_COMMENTS:return messageResource.getMessage("reports.comments_report.report.comments");case ReportGroupingLevel.TASK_AND_TT_COMMENTS:return messageResource.getMessage("report.tasks.and_tt_comments");case ReportGroupingLevel.PROJECT_AND_TT_COMMENTS:return messageResource.getMessage("report.projects.and_tt_comments");
case ReportGroupingLevel.CUSTOMER_AND_TT_COMMENTS:return messageResource.getMessage("report.customers.and_tt_comments");case ReportGroupingLevel.DATE:return messageResource.getMessage("report.dates");case ReportGroupingLevel.WEEK:return messageResource.getMessage("report.weeks");case ReportGroupingLevel.MONTH:return messageResource.getMessage("report.months");default:return"None"}},makeGroupingHeader:function(a){for(var b="",c=!1,d=0;d<a.length;d++)a[d]!=ReportGroupingLevel.NONE&&(c&&(b+=" / "),b+=
ReportPreviewUtils.getGroupingOptionName(a[d]),c=!0);return b},isLevelCanBeAddedMoreThanOnce:function(a,b){switch(a){case ReportGroupingLevel.CUSTOMER:return ReportPreviewUtils.levelsArrayContainsNoneOfLevels(b,[ReportGroupingLevel.PROJECT,ReportGroupingLevel.TASK]);case ReportGroupingLevel.CUSTOMER_AND_TT_COMMENTS:return ReportPreviewUtils.levelsArrayContainsNoneOfLevels(b,[ReportGroupingLevel.CUSTOMER,ReportGroupingLevel.PROJECT,ReportGroupingLevel.TASK]);case ReportGroupingLevel.PROJECT:return ReportPreviewUtils.levelsArrayContainsNoneOfLevels(b,
[ReportGroupingLevel.TASK]);case ReportGroupingLevel.PROJECT_NAME:case ReportGroupingLevel.PROJECT_AND_TT_COMMENTS:return ReportPreviewUtils.levelsArrayContainsNoneOfLevels(b,[ReportGroupingLevel.TASK,ReportGroupingLevel.PROJECT]);case ReportGroupingLevel.TASK_NAME:case ReportGroupingLevel.TASK_AND_TT_COMMENTS:return ReportPreviewUtils.levelsArrayContainsNoneOfLevels(b,[ReportGroupingLevel.TASK]);case ReportGroupingLevel.USER_GROUP:return ReportPreviewUtils.levelsArrayContainsNoneOfLevels(b,[ReportGroupingLevel.USER]);
case ReportGroupingLevel.BILLING_TYPE:return ReportPreviewUtils.levelsArrayContainsNoneOfLevels(b,[ReportGroupingLevel.TASK]);case ReportGroupingLevel.TASK:return-1==$.inArray(ReportGroupingLevel.TASK_NAME,b)||-1==$.inArray(ReportGroupingLevel.PROJECT,b);default:return!0}},levelsArrayContainsNoneOfLevels:function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(a[c]==b[d])return!1;return!0}};ExportPanel=function(a,b,c){DropdownTemplateView.call(this,a);this.updateOnInit=!1;this.processPDF=b;this.processCSV=c};
ExportPanel.prototype=_.create(DropdownTemplateView.prototype,{html:"<div class='exportSelector noprint menuZindex' style='display: none;'>    <div class='row toCSV'><div class='type'><%-toCSV%></div></div>    <div class='row toPDF'><div class='type'><%-toPDF%></div></div></div>",afterRender:function(){var a=this;this.isShown=!1;this.processPDF?this.findPDFButton().click(function(){a.hide();$(document).trigger(a.processPDF)}):this.$el.addClass("noPDF");this.processCSV?this.findAndBindClick(".toCSV",
function(){a.hide();$(document).trigger(a.processCSV)}):this.$el.addClass("noCSV")},messageKeys:function(){return{toCSV:"report.config.export.to_csv",toPDF:"report.config.export.to_pdf"}},findPDFButton:function(){return this.find(".toPDF")}});var timeout=1E4,jsonrpc,editDescriptionPopup=new EditableTextDhtmlPopup("editDescriptionPopup");editDescriptionPopup.setApplyBeyondScreenDisplayFix(!0);var editDescriptionState;
function EditDescriptionState(a,b,c,d,e,f,g,h){this.objectId=a;this.cell=b;this.image=c;this.state="EDITING";this.originalDescription="";this.descriptionUtil=d;null!=d&&(this.textLengthNote=new TextAreaLengthNote("descLength",d.Messages.TEXT_AREA_NOTE_NAME,2E3));void 0!=e&&1!=e||this.updatePopupState();this.commentEnteredImg=f;if(void 0==f||null==f)this.commentEnteredImg=imgPath("dialogs/comments/comment_entered.png");this.commentBlankImg=g;if(void 0==g||null==g)this.commentBlankImg=imgPath("dialogs/comments/comment_blank.png");
this.requestId=null;this.descriptionImageChangeCallback=h}EditDescriptionState.prototype.isDescriptionModified=function(){var a=toUnixLineFeeds(trim(this.originalDescription)),b=toUnixLineFeeds(trim(editDescriptionPopup.getPopupTextValue()));return a!=b};EditDescriptionState.prototype.setState=function(a){this.state=a;this.updatePopupState()};
EditDescriptionState.prototype.updateImage=function(){editDescriptionState.image.src=editDescriptionPopup.isEmpty()?this.commentBlankImg:this.commentEnteredImg;this.descriptionImageChangeCallback&&this.descriptionImageChangeCallback(editDescriptionState.image)};
EditDescriptionState.prototype.updatePopupState=function(){"EDITING"==this.state?this.turnPopupToEditingState():"LOADING"==this.state?this.turnPopupToLoadingState():"SAVING"==this.state&&(null!=this.cell&&(this.cell.style.backgroundColor=DHTMLColors.beingSavedColor),this.turnPopupToSavingState())};
EditDescriptionState.prototype.turnPopupToEditingState=function(){document.getElementById("editDescriptionPopupEditingState").style.display="block";document.getElementById("editDescriptionPopupSavingState").style.display="none";document.getElementById("editDescriptionPopupLoadingState").style.display="none";document.getElementById("editDescriptionPopupButtons").style.display="block";$("#closeEditDescriptionPopupSpan").removeClass("disabled");this.textLengthNote.show()};
EditDescriptionState.prototype.turnPopupToSavingState=function(){document.getElementById("editDescriptionPopupEditingState").style.display="none";document.getElementById("editDescriptionPopupSavingState").style.display="block";document.getElementById("editDescriptionPopupLoadingState").style.display="none";document.getElementById("editDescriptionPopupButtons").style.display="none";$("#closeEditDescriptionPopupSpan").addClass("disabled");this.textLengthNote.hide()};
EditDescriptionState.prototype.turnPopupToLoadingState=function(){document.getElementById("editDescriptionPopupEditingState").style.display="none";document.getElementById("editDescriptionPopupSavingState").style.display="none";document.getElementById("editDescriptionPopupLoadingState").style.display="block";document.getElementById("editDescriptionPopupButtons").style.display="none";$("#closeEditDescriptionPopupSpan").addClass("disabled");this.textLengthNote.hide()};
EditDescriptionState.prototype.turnPopupToHideState=function(){document.getElementById("editDescriptionPopupEditingState").style.display="none";document.getElementById("editDescriptionPopupSavingState").style.display="none";document.getElementById("editDescriptionPopupLoadingState").style.display="none";document.getElementById("editDescriptionPopupButtons").style.display="none";this.textLengthNote.hide()};EditDescriptionState.prototype.setRequestId=function(a){a&&(this.requestId=a)};
EditDescriptionState.prototype.getRequestId=function(){return this.requestId};
function setPopupHandlers(a,b){editDescriptionPopup.setAfterShowHandler(function(){a&&a.classList.add("pressed")});editDescriptionPopup.setAfterHideHandler(function(){ExitConfirmationHandlersManager.restoreExitConfirmation();a&&a.classList.remove("pressed");editDescriptionState=null});editDescriptionPopup.setBeforeHideHandler(function(){if(isBusySavingState()||editDescriptionState&&editDescriptionState.isDescriptionModified()&&!confirm(b.Messages.MODIFICATIONS_NOT_SAVED))return!1;editDescriptionState&&
editDescriptionState.turnPopupToHideState();return!0})}function showSavingDescriptionWithDefaultOffset(a,b,c,d,e,f,g,h,k){showSavingDescriptionWithOffset(a,b,c,d,e,-100,25,f,g,h,k)}
function showSavingDescriptionWithOffset(a,b,c,d,e,f,g,h,k,m,l){if(!isBusySavingState()){if(void 0==d||null==d)d=b.parentNode;b=b.childNodes[0];setPopupHandlers(d,c);editDescriptionState=new EditDescriptionState(a,d,b,c,null,h,k,m);editDescriptionState.isConfirmationOnUnloadRequired=!0;ExitConfirmationHandlersManager.setUpExitConfirmation(l&&l.onCloseTabMessage?l.onCloseTabMessage:messageResource.getMessage("edit_description.error_not_saved_modifications"),function(){return editDescriptionState&&
editDescriptionState.isConfirmationOnUnloadRequired&&editDescriptionState.isDescriptionModified()},!1);void 0!=e&&1==e?(a=getOnPageDescription(a),editDescriptionState.textLengthNote.update(a),editDescriptionState.originalDescription=a,editDescriptionPopup.show(c.EDIT_DESCRIPTION_POPUP_CAPTION,a,f,g)):(editDescriptionState.setState("LOADING"),editDescriptionPopup.show(c.EDIT_DESCRIPTION_POPUP_CAPTION,"",f,g),loadSavingDescription(a,c))}}
function loadSavingDescription(a,b){editDescriptionState.retryController=new RpcRetryController(timeout,function(){editDescriptionState&&b.doLoadDescription(a,savingDescriptionLoaded,function(a){editDescriptionState.retryController.handleErrorOrRetry(a)},function(a){editDescriptionState&&editDescriptionState.setRequestId(a)})},savingDescriptionLoadingTimeout,processSavingDescriptionError);editDescriptionState.retryController.start()}
function savingDescriptionLoaded(a,b){if(isBusySavingState())if(null!=b)editDescriptionState.retryController.handleErrorOrRetry(b);else{editDescriptionState.retryController&&editDescriptionState.retryController.stop();var c=null===a?"":a;editDescriptionState.originalDescription=c;editDescriptionState.setState("EDITING");editDescriptionPopup.update(editDescriptionState.descriptionUtil.EDIT_DESCRIPTION_POPUP_CAPTION,c);editDescriptionState.textLengthNote.update(c)}}
function isBusySavingState(){return null!=editDescriptionState&&"EDITING"!=editDescriptionState.state}function isCorrectDescriptionLength(a){var b=editDescriptionPopup.getPopupTextValue(),b=getStringWithUnifiedNewLineSymbol(b).length;return 2E3<b?(alert(a.Messages.TOO_LONG_DESCRIPTION(b)),!1):!0}function trimDescriptionPopupTextValue(){editDescriptionPopup.getPopupTextObject().value=trim(editDescriptionPopup.getPopupTextValue())}
function saveOnPageDescription(a){if(isBusySavingState()||void 0==editDescriptionState)return!0;trimDescriptionPopupTextValue();var b=editDescriptionState.descriptionUtil;if(!a&&!isCorrectDescriptionLength(b))return!1;editDescriptionState.state="SAVING";b.doSaveDescription(editDescriptionState.objectId,editDescriptionPopup.getPopupTextValue(),function(a,b){descriptionSaved(a,b,!0)},null,function(a){editDescriptionState&&editDescriptionState.setRequestId(a)});return!0}
function saveDescription(a){if(!isBusySavingState()){trimDescriptionPopupTextValue();var b=editDescriptionState.descriptionUtil;isCorrectDescriptionLength(b)&&(editDescriptionState.setState("SAVING"),editDescriptionState.retryController=new RpcRetryController(timeout,function(){editDescriptionState&&b.doSaveDescription(editDescriptionState.objectId,editDescriptionPopup.getPopupTextValue(),function(b,d){descriptionSaved(b,d,!1)&&a&&a()},function(a){editDescriptionState.retryController.handleErrorOrRetry(a)},
function(a){editDescriptionState&&editDescriptionState.setRequestId(a)})},descriptionSavingTimeout,processSavingDescriptionError),editDescriptionState.retryController.start())}}function descriptionSaved(a,b,c){if(!isBusySavingState())return!1;if(null!=b&&editDescriptionState.retryController)return editDescriptionState.retryController.handleErrorOrRetry(b),!1;editDescriptionState.updateImage();void 0==c&&(c=!1);descriptionSavingCleanup(c);return!0}
function processSavingDescriptionError(a){editDescriptionState&&editDescriptionState.retryController.stop();-1!=a.name.indexOf("com.actimind.actitime.services.NoRightsForRemoteCallException")?noRightsURL?document.location.href=noRightsURL:document.location.reload():-1!=a.name.indexOf("com.actimind.actitime.task.NoSuchTaskException")?(alert(messageResource.getMessage("edit_description.error_task_was_deleted")),document.location.reload()):-1!=a.name.indexOf("com.actimind.actitime.project.NoSuchProjectException")?
(alert(messageResource.getMessage("edit_description.error_project_was_deleted")),document.location.reload()):-1!=a.name.indexOf("com.actimind.actitime.customer.NoSuchCustomerException")?(alert(messageResource.getMessage("edit_description.error_customer_was_deleted")),document.location.reload()):("LOADING"==editDescriptionState.state?alert(editDescriptionState.descriptionUtil.Messages.ERROR_DESCRIPTION_LOADING):alert(editDescriptionState.descriptionUtil.Messages.ERROR_DESCRIPTION_SAVING),descriptionSavingCleanup(!0))}
function descriptionSavingCleanup(a){if(editDescriptionState){editDescriptionState.retryController&&editDescriptionState.retryController.stop();editDescriptionState.descriptionUtil.loadTimerId&&window.clearTimeout(editDescriptionState.descriptionUtil.loadTimerId);"undefined"!=typeof editDescriptionState.descriptionUtil.tid&&window.clearTimeout(editDescriptionState.descriptionUtil.tid);var b=editDescriptionState.cell,c=function(){editDescriptionState&&editDescriptionState.cell==b||null==b||(b.style.backgroundColor=
"")};editDescriptionState=null;editDescriptionPopup.hide();editDescriptionPopup.setAfterHideHandler(null);ExitConfirmationHandlersManager.restoreExitConfirmation();a?c():window.setTimeout(c,1E3)}}function descriptionSavingTimeout(){descriptionSavingLoadingTimeout(editDescriptionState.descriptionUtil.Messages.TIMEOUT_DESCRIPTION_SAVING)}function savingDescriptionLoadingTimeout(){descriptionSavingLoadingTimeout(editDescriptionState.descriptionUtil.Messages.TIMEOUT_DESCRIPTION_LOADING)}
function descriptionSavingLoadingTimeout(a){isBusySavingState()&&(confirm(a)?editDescriptionState&&editDescriptionState.retryController&&(editDescriptionState.retryController.stop(),isBusySavingState()&&editDescriptionState.retryController.start()):isBusySavingState()&&(editDescriptionState&&editDescriptionState.getRequestId()&&JSONRpcClient.cancelRequest(editDescriptionState.getRequestId()),jsonrpc.abortAllRequests(),descriptionSavingCleanup(!0)))}
function setSaveHandler(a,b){var c=document.getElementById("scbutton");initNameOkButton=c.value;initFunctionOkButton=c.onclick;c.value=a;c.onclick=b}function setOldButtonInDescriptionPopup(){var a=document.getElementById("scbutton");a.value=initNameOkButton;a.onclick=initFunctionOkButton}editDescriptionPopup.showAboveBasicPopups=function(){$("#editDescriptionPopup").addClass("aboveLightboxZindex")};editDescriptionPopup.showUnderBasicPopups=function(){$("#editDescriptionPopup").removeClass("aboveLightboxZindex")};var timeout=1E4,descriptionsCache=[],descriptionPopup=new StaticTextDhtmlPopup("descriptionPopup"),descriptionState;function ViewDescriptionMessages(){}ViewDescriptionMessages.ERR_TASK_WAS_DELETED="view_description.error_task_was_deleted";ViewDescriptionMessages.ERR_PROJECT_WAS_DELETED="view_description.error_project_was_deleted";ViewDescriptionMessages.ERR_CUSTOMER_WAS_DELETED="view_description.error_customer_was_deleted";
function ViewDescriptionState(a,b,c,d){this.objectId=a;this.cell=b;this.image=c;this.state="LOADING";this.descriptionUtil=d;this.requestId=null;this.updatePopupState()}ViewDescriptionState.prototype.setState=function(a){this.state=a;this.updatePopupState()};ViewDescriptionState.prototype.updatePopupState=function(){"VIEW"==this.state?this.turnPopupToViewState():"LOADING"==this.state&&this.turnPopupToLoadingState()};ViewDescriptionState.prototype.turnPopupToViewState=function(){$("#closeEditDescriptionPopupSpan").removeClass("disabled")};
ViewDescriptionState.prototype.turnPopupToLoadingState=function(){$("#closeEditDescriptionPopupSpan").addClass("disabled")};function showDescriptionWithDefaultOffset(a,b,c,d){showDescriptionWithOffset(a,b,c,d,-100,25)}
function showDescriptionWithOffset(a,b,c,d,e,f){if(!isBusyState()){descriptionPopup.hide();if(void 0==d||null==d)d=b.parentNode;b=b.childNodes[0];descriptionPopup.setAfterShowHandler(function(){d&&(d.style.backgroundColor=DHTMLColors.onClickHighlightColor,$(d).addClass("active"))});descriptionPopup.setAfterHideHandler(function(){d&&(d.style.backgroundColor="",$(d).removeClass("active"))});descriptionPopup.setBeforeHideHandler(function(){return isBusyState()?!1:!0});descriptionState=new ViewDescriptionState(a,
d,b,c);b=getDescription(c.entityType,a);null==b?(descriptionState.setState("LOADING"),descriptionPopup.show(c.VIEW_DESCRIPTION_POPUP_CAPTION,"Loading ...",e,f),loadDescription(a,c)):(descriptionState.setState("VIEW"),descriptionPopup.show(c.VIEW_DESCRIPTION_POPUP_CAPTION,b,e,f))}}function getDescription(a,b){return descriptionsCache[a+b]}function cacheDescription(a,b,c){descriptionsCache[a+b]=c}
function loadDescription(a,b){descriptionState.retryController=new RpcRetryController(timeout,function(){b.doLoadDescription(a,descriptionLoaded,function(a){descriptionState&&descriptionState.retryController.handleErrorOrRetry(a)},function(a){descriptionState&&(descriptionState.requestId=a)})},descriptionLoadingTimeout,processDescriptionError);descriptionState.retryController.start()}
function descriptionLoaded(a,b){if(isBusyState())if(descriptionState.tid&&window.clearTimeout(descriptionState.tid),null!=b)descriptionState.retryController.handleErrorOrRetry(b);else{var c=descriptionState.descriptionUtil;cacheDescription(c.entityType,descriptionState.objectId,a);descriptionState.setState("VIEW");descriptionPopup.update(c.VIEW_DESCRIPTION_POPUP_CAPTION,a)}}function isBusyState(){return null!=descriptionState&&"LOADING"==descriptionState.state}
function processDescriptionError(a){-1!=a.name.indexOf("com.actimind.actitime.services.NoRightsForRemoteCallException")?"undefined"!=typeof noRightsURL&&noRightsURL?document.location.href=noRightsURL:document.location.reload():-1!=a.name.indexOf("com.actimind.actitime.task.NoSuchTaskException")?(alert(messageResource.getMessage(ViewDescriptionMessages.ERR_TASK_WAS_DELETED)),document.location.reload()):-1!=a.name.indexOf("com.actimind.actitime.project.NoSuchProjectException")?(alert(messageResource.getMessage(ViewDescriptionMessages.ERR_PROJECT_WAS_DELETED)),
document.location.reload()):-1!=a.name.indexOf("com.actimind.actitime.customer.NoSuchCustomerException")?(alert(messageResource.getMessage(ViewDescriptionMessages.ERR_CUSTOMER_WAS_DELETED)),document.location.reload()):("LOADING"==descriptionState.state?alert(descriptionState.descriptionUtil.Messages.ERROR_DESCRIPTION_LOADING):alert(descriptionState.descriptionUtil.Messages.ERROR_DESCRIPTION_SAVING),descriptionCleanup())}
function descriptionCleanup(){descriptionState&&(descriptionState.retryController&&descriptionState.retryController.stop(),descriptionState=null,descriptionPopup.hide())}
function descriptionLoadingTimeout(){isBusyState()&&(confirm(descriptionState.descriptionUtil.Messages.TIMEOUT_DESCRIPTION_LOADING)?isBusyState()&&descriptionState&&(descriptionState.retryController.stop(),descriptionState.retryController.start()):isBusyState()&&(descriptionState&&descriptionState.requestId&&JSONRpcClient.cancelRequest(descriptionState.requestId),jsonrpc.abortAllRequests(),descriptionCleanup()))};function RejectCommentDialog(){}
RejectCommentDialog.prototype.init=function(a,b){var c=this;this.rejectCallback=b;this.rejectCommentDialogDiv=$("#"+a);this.rejectCommentDialog=new DropdownDialog({wrapperClass:"rejectCommentDialogWrapper",dialogDiv:this.rejectCommentDialogDiv,hideButtons:!1,isWithBeak:!0,hideOnResize:!0,showEmptyTitleBar:!1,okButtonText:messageResource.getMessage("change_week_approval_status.reject_comment_dialog.reject_button"),onOkClick:function(){return c.rejectCallback()}});this.rejectCommentDialogUserInfo=this.rejectCommentDialogDiv.find("span.userInfo");
this.rejectCommentField=this.rejectCommentDialogDiv.find(".rejectWeekComment");this.rejectCommentTextArea=$("#rejectWeekCommentTextArea");this.rejectCommentLengthNote=new TextAreaLengthNote("rejectCommentLength",null,255);this.rejectCommentTextChangeHandler=function(){c.rejectCommentLengthNote.update(c.rejectCommentTextArea.pVal())};this.rejectCommentTextArea.blur(c.rejectCommentTextChangeHandler);this.rejectCommentTextArea.keyup(c.rejectCommentTextChangeHandler);this.rejectCommentTextArea.on("paste",
c.rejectCommentTextChangeHandler);this.rejectCommentLengthNote.show();return this};
RejectCommentDialog.prototype._open=function(a,b,c){c&&(this.rejectCallback=c);this.rejectCommentDialogUserInfo.text(messageResource.getMessage("reject_comment_dialog.caption.part2",[b.userInfo]));this.rejectCommentField.val("");this.rejectCommentField.placeholder();c=b.isBottom?{offset:"47px -15px",my:"right bottom",at:"right top",collision:"none"}:{offset:"47px 15px",my:"right top",at:"right bottom",collision:"none"};this.rejectCommentDialog.setBeak(b.isBottom);this.rejectCommentDialog.showAt(a,
c);this.rejectCommentTextChangeHandler();this.rejectCommentTextArea.focus()};RejectCommentDialog.prototype.isValid=function(){return this.rejectCommentLengthNote.isTextLengthValid()};RejectCommentDialog.prototype.getComment=function(){return this.rejectCommentField.pVal()};WeekSelectorWithRange=Ext.extend(WeekSelector,{fromDateFormat:new DateFormat("MMM dd"),toDateFormat:new DateFormat("MMM dd, yyyy"),formatDate:function(a){return Ext.isDate(a)?this.fromDateFormat.formatDate(a)+" - "+this.toDateFormat.formatDate(a.getNDaysAfter(6)):a.toString()},onRender:function(a,b){WeekSelectorWithRange.superclass.onRender.call(this,a,b);Ext.get(this.el).addClass("weekSelectorWithRange")}});Ext.namespace("AT");
AT.DateRangeSelector=Ext.extend(Ext.Container,{autoEl:"div",layout:"table",calendarIcoSrc:"calendar_small_ico.gif",buttonTextFormat:Date.convertSmartToExtDateFormat(SystemSettings.dateFormat),onChangeCallBack:Ext.emptyFn,onRenderCallBack:Ext.emptyFn,hideFromDateButton:!1,fromDate:null,toDate:null,rangeTypeId:null,menuStates:[],radioGroup:"dateRange",buttonsPaneCls:"",dropdownButtonCls:"",statusCls:"",rangeMinDays:7,rangeMaxDays:62,rangeReverseMessageKey:"date_range_selector.range_error.reverse.short",rangeTooSmallMessageKey:"date_range_selector.range_error.shorter_than_7_days",
rangeTooLongMessageKey:"date_range_selector.range_error.longer_than_2_months",dateTooOldMessageKey:"date_range_selector.range_error.too_old",dateFormat:new DateFormat(TimeUtils.UNIFORM_DATE_FORMAT),errorMessageKey:null,scheduleCalculator:null,initComponent:function(){AT.DateRangeSelector.superclass.initComponent.call(this);this.dateRangeInitState={fromDate:this.fromDate,toDate:this.toDate,dateRangeStateId:this.rangeTypeId};this.createStatusElement();this.fromDateButton=this.createDateButton("fromDate",
this.scheduleCalculator);this.toDateButton=this.createDateButton("toDate",this.scheduleCalculator);this.updateButtons(this.fromDate,this.toDate);this.buttonsPane=this.getButtonsPane();this.add(this.buttonsPane);this.createDropdown();this.addEvents("change")},createDropdown:function(){this.dropdownCtn=this.getDropdownButton();this.add(this.dropdownCtn)},createStatusElement:function(){this.statusElement=new Ext.BoxComponent({autoEl:{tag:"span",cls:this.statusCls,html:""}})},defineDropdownEvents:function(){this.dropdownCtn.on("render",
function(){this.dropdownCtn.el.on("mouseover",this.clickableAreaOver,this);this.dropdownCtn.el.on("mouseout",this.clickableAreaOut,this);this.dropdownCtn.el.on("mousedown",this.toggleMenu,this);this.dropdownCtn.el.dom.style.cursor="pointer"},this)},defineStatusElementEvents:function(){this.statusElement.on("render",function(){this.dropdownCtn.el.dom.style.cursor="pointer"},this)},defineButtonsPaneEvents:function(){this.buttonsPane.on("render",function(){this.buttonsPane.el.on("mouseover",this.clickableAreaOver,
this);this.buttonsPane.el.on("mouseout",this.clickableAreaOut,this);this.buttonsPane.el.on("mousedown",this.toggleMenu,this);this.buttonsPane.el.dom.style.cursor="pointer"},this)},afterRender:function(){function a(){this.updateState(this.customState);this.verifyRangeSize();this.fireChangeEvent();this.onChangeCallBack()}function b(b){b.on("change",a,h)}function c(b){b.un("change",a,h)}function d(a,d){a.on("menushow",b);a.on("menuhide",c);a.show()}this.overDate=this.overClickableArea=!1;this.defineStatusElementEvents();
this.fromDateButton.on("render",function(){this.fromDateButton.el.on("mouseover",this.dateOver,this);this.fromDateButton.el.on("mouseout",this.dateOut,this)},this);this.toDateButton.on("render",function(){this.toDateButton.el.on("mouseover",this.dateOver,this);this.toDateButton.el.on("mouseout",this.dateOut,this)},this);this.defineButtonsPaneEvents();this.defineDropdownEvents();for(var e=0;e<this.menuStates.length;++e){var f=this.menuStates[e];f.radioGroup=this.radioGroup;f.clickHandler=this.itemClicked;
f.handlerScope=this;f.custom&&(this.customState=f);if(this.rangeTypeId==f.id){var g=f;this.statusElement.on("render",function(){g.custom?(this.updateState(g),this.updateButtons(this.fromDate,this.toDate)):this.selectState(g);this.onRenderCallBack.call(this)},this)}}this.menuShown=!1;var h=this;d(this.fromDateButton);d(this.toDateButton)},getBaseButtonItems:function(){var a=[];this.hideFromDateButton||a.push(this.fromDateButton,{xtype:"box",autoEl:{tag:"span",html:"&ndash;",style:"text-align: center; width: 15px; display: inline-block; margin-left: 5px;"}});
a.push(this.toDateButton);return a},getButtonsPane:function(){return new AT.RoundedBox({cls:this.buttonsPaneCls,straightBorder:"right",items:[this.statusElement,{xtype:"container",autoEl:"div",layout:"table",items:this.getBaseButtonItems()}]})},getDropdownButton:function(){return new AT.RoundedBox({cls:this.dropdownButtonCls,straightBorder:"left"})},createDateButton:function(a,b){return new AT.DateButton({format:this.buttonTextFormat,minValue:new Date(1970,0,1),weekStartDay:SystemSettings.weekStartDay-
1,scheduleCalculator:b,icoSrc:imgPath(this.calendarIcoSrc),name:a})},fireChangeEvent:function(){this.fireEvent("change",this)},selectState:function(a){this.updateState(a);a.custom||this.updateButtons(a.range.getFromDate(),a.range.getToDate(),a.title)},selectStateById:function(a){this.selectState(this.getRangeTypeById(a))},refreshMenu:function(){for(var a=[],b=0;b<this.menuStates.length;++b)a.push(this.menuStates[b].createItem(this.currentState));this.menu=new Ext.menu.Menu({items:a,cls:"at-dropdown-list-btn-menu rangesListMenu"});
this.menu.on("hide",this.hideMenu,this)},updateState:function(a){this.statusElement.removeClass("errorStatus");this.statusElement.el.dom.innerHTML=a.title;this.currentState=a;this.errorMessageKey=null},errorState:function(a){this.statusElement.addClass("errorStatus");this.statusElement.el.dom.innerHTML=messageResource.getMessage(a);this.errorMessageKey=a},getErrorMessageKey:function(){return this.errorMessageKey},updateButtons:function(a,b){this.fromDateButton.setValue(a);this.toDateButton.setValue(b)},
animateCustom:function(){if(!this.hideFromDateButton)var a=this.fromDateButton.el;var b=this.toDateButton.el,c=this;(function(){c.hideFromDateButton||a.toggleClass("buttonAnimated");b.toggleClass("buttonAnimated")}).defer(500);(function(){c.hideFromDateButton||a.toggleClass("buttonAnimated");b.toggleClass("buttonAnimated")}).defer(1250)},itemClicked:function(a){a.state.custom&&this.animateCustom();a.state!==this.currentState&&(this.selectState(a.state),this.fireChangeEvent(),this.onChangeCallBack())},
dateOver:function(){this.mouseOut();this.overDate=!0},dateOut:function(){this.overDate=!1},mouseOver:function(){this.overDate||this.addClass("active")},mouseOut:function(){this.menuShown||this.removeClass("active")},clickableAreaOver:function(){this.mouseOver();this.overClickableArea=!0},clickableAreaOut:function(a){this.isClickableArea(a.getRelatedTarget())||(this.overClickableArea=!1,this.mouseOut())},isClickableArea:function(a){return isSameOrParentOf(a,this.buttonsPane.el.dom)||isSameOrParentOf(a,
this.dropdownCtn.el.dom)},getMenuAlign:function(){return"t-b?"},getElementToShowMenu:function(){return this.el.child("table:first")},toggleMenu:function(){if(!this.overDate||this.menuShown){if(this.menuShown=!this.menuShown)this.refreshMenu(),this.menu.show(this.getElementToShowMenu(),this.getMenuAlign(),null);this.overClickableArea||this.mouseOut()}},hideMenu:function(){this.menuShown=!1;this.overClickableArea||this.mouseOut()},getRangeTypeId:function(){return this.currentState.id},getRangeType:function(){return this.currentState},
getRangeTypeById:function(a){for(var b=0;b<this.menuStates.length;b++)if(this.menuStates[b].id==a)return this.menuStates[b]},getFromDate:function(){return this.fromDateButton.getValue()},getToDate:function(){return this.toDateButton.getValue()},getFormattedFromDate:function(){return this.dateFormat.formatDate(this.fromDateButton.getValue())},getFormattedToDate:function(){return this.dateFormat.formatDate(this.toDateButton.getValue())},verifyRangeSize:function(){var a=null,b=this.getFromDate().clearTime(),
c=this.getToDate().clearTime();b>c?a=this.rangeReverseMessageKey:b&&1970>b.getFullYear()||c&&1970>c.getFullYear()?a=this.dateTooOldMessageKey:-1!=this.rangeMinDays&&b.add(Date.DAY,this.rangeMinDays-1).clearTime()>c?a=this.rangeTooSmallMessageKey:-1!=this.rangeMaxDays&&b.add(Date.DAY,this.rangeMaxDays-1).clearTime()<c&&(a=this.rangeTooLongMessageKey);return a?(this.errorState(a),!1):!0},adjustRangeType:function(){this.currentState===this.customState||areDatesEqual(this.currentState.range.getFromDate(),
this.getFromDate())&&areDatesEqual(this.currentState.range.getToDate(),this.getToDate())||(this.currentState=this.customState)},getDateRangeSelectorState:function(){return{fromDate:this.getFromDate(),toDate:this.getToDate(),dateRangeStateId:this.getRangeTypeId()}},isDateRangeChanged:function(){return!areDatesEqual(this.dateRangeInitState.toDate,this.getToDate())||!this.hideFromDateButton&&!areDatesEqual(this.dateRangeInitState.fromDate,this.getFromDate())}});Ext.reg("at_date_range_selector",AT.DateRangeSelector);
AT.DateRangeSelector.makeDate=function(a,b,c){return 0>a||0>b||0>c?null:createDate(a,b,c)};function DateRangeSelectorUtil(){}DateRangeSelectorUtil.submitForm=function(a,b){a.adjustRangeType();b["dateRangeSelector.fromDate.internalText"].value=a.getFormattedFromDate();b["dateRangeSelector.toDate.internalText"].value=a.getFormattedToDate();b["dateRangeSelector.dateRangeState"].value=a.getRangeTypeId();b.submit()};DateRangeSelectorUtil.checkAndSubmitDateRangeSelector=function(a,b){a.verifyRangeSize()&&a.isDateRangeChanged()&&DateRangeSelectorUtil.submitForm(a,b)};Ext.namespace("AT");AT.UserTreeNodeHelper=Ext.extend(AT.TreeNodeHelper,{constructor:function(a){this.userHelper=new AT.ComplicateUsersAndGroupsSelectionHelper({propertiesController:a.propertiesController,accessRight:a.accessRight,checkEmail:a.checkEmail});AT.UserTreeNodeHelper.superclass.constructor.call(this,a)},getStatusSuffix:function(a){var b=this.getDisabledSuffix(a);a=this.userHelper.getListDescriptionItemStatus(a);return concatStr(b,a," ")}});Ext.namespace("AT");AT.AccessRightsUserTreeNodeHelper=Ext.extend(AT.UserTreeNodeHelper,{accessRight:null,getTooltipMessage:function(a){var b=null;this.tooltipMessageParams&&(b=this.hasRight(a)?AT.AccessRightsUserTreeNodeHelper.superclass.getTooltipMessage.call(this,a):this.getSingleTooltipMessage(a,"accessRight"));return b},isActive:function(a){return AT.AccessRightsUserTreeNodeHelper.superclass.isActive.call(this,a)&&this.hasRight(a)},hasRight:function(a){return this.accessRight.isGranted(this.propertiesController.getAccessRights(a))}});function TTUsersSelector(){BaseUsersSelector.call(this)}
TTUsersSelector.prototype=_.create(BaseUsersSelector.prototype,{init:function(a,b,c,d,e,f,g,h,k){BaseUsersSelector.prototype.init.call(this,a,b,c,d,e,f,g,h,k);this.$userSelectorTd=$(".userSelectorTd").addClass("showSelector");this.$selectedUserButton=$(".userSelectorButton");var m=this._getLoggedInUserId();this.hasSubmitMyTTRight=!_.isUndefined(_.find(a,function(a){return a.id==m}));$(".backToMyTTImg").click(_.bind(this.onUserSelect,this,m));$(".backToMyTtText").click(_.bind(this.onUserSelect,this,
m));this.$selectedUserButton.click(_.bind(this.expandSelectorList,this));this.spinnerPlaceholder=this.$userSelectorTd.find(".userSelectorSpinnerPlaceholder");_.isUndefined(this.spinnerPlaceholder)||(this.spinner=new SpinnerController);this.updateUI()},leaveAndShowAnimationSpinner:function(){this.spinner&&this.spinner.spinInElement(this.spinnerPlaceholder);this.usersCombo.setEditable(!1);this.usersCombo.disabled=!0;this.usersCombo.blur()},expandSelectorList:function(){this.$userSelectorTd.find(".x-form-trigger").click()},
formatUserName:function(a,b){return this._getLoggedInUserId()==a?messageResource.getMessage("usersselector.me"):b.formatNameLFM()},getData:function(){var a=BaseUsersSelector.prototype.getData.call(this);a.push({name:"isRequiresTTApproval",mapping:"isRequiresTTApproval"});return a},formatHighlightedUserName:function(a){var b=!a.isRequiresTTApproval&&EnabledFeatures.TTA;a="<span class='userName"+(b?" autoApproved":"")+"'>"+BaseUsersSelector.prototype.formatHighlightedUserName.call(this,a)+"</span>";
b&&(a+="<span class='autoApprovedText'>"+messageResource.getMessage("usersselector.auto")+"</span>");return a},isLoggedInUserId:function(a){return this._getLoggedInUserId()==a},updateUI:function(){this.$userSelectorTd.toggleClass("backToMySheetShown",this.usersCombo.getValue()!=this._getLoggedInUserId()&&this.hasSubmitMyTTRight);var a=_.isUndefined(this.usersCombo.lastSelectionText)?this.usersCombo.emptyText:this.usersCombo.lastSelectionText;this.$selectedUserButton.find(".dashedLink").html(escapeHtmlSymbols(a));
this.$userSelectorTd.toggleClass("showSelector",this.needToRenderSelector())},_getLoggedInUserId:function(){},needToRenderSelector:function(){return!0}});function SubmitTTUsersSelector(a){this._loggedInUserId=a;BaseUsersSelector.call(this)}SubmitTTUsersSelector.prototype=_.create(TTUsersSelector.prototype,{_getLoggedInUserId:function(){return this._loggedInUserId}});function CustomerWithoutCheckboxNodeRenderer(a,b,c,d){CustomerNodeRenderer.call(this,a,b,c);this.selectionHelper=d}CustomerWithoutCheckboxNodeRenderer.prototype=_.create(CustomerNodeRenderer.prototype);CustomerWithoutCheckboxNodeRenderer.prototype.TOGGLE_DELAY_AFTER_EXPAND=250;
CustomerWithoutCheckboxNodeRenderer.prototype.generateContent=function(a,b){var c=document.createElement("table"),d=document.createElement("tbody"),e=document.createElement("tr"),f=document.createElement("td"),g=document.createElement("td"),h=this.generateExpandCollapseButton(a,!0,"normalExpandCollapseButton",null),k=this.generateExpandCollapseButton(a,!1,"disabledExpandCollapseButtonWithTitle",this.getExpandCollapseButtonTitle(a)),m=this.generateExpandCollapseButton(a,!1,"disabledExpandCollapseButtonWithoutTitle",
null);c.appendChild(d);d.appendChild(e);e.appendChild(f);e.appendChild(g);g.appendChild(h);g.appendChild(k);g.appendChild(m);d=document.createElement("div");d.className="spacer";d.innerHTML="<b></b>";b.appendChild(c);b.appendChild(d);c=document.createElement("a");c.className="titleNode";c.hidefocus="true";var l=this;f.ondblclick=function(){l.expandCollapseCallback(function(){var b=l.tree.getExpandController(),c=l.tree.getSelectionController();b.isCollapsed(a)?(b.expandAndScrollIfNeeded(a),setTimeout(function(){c.toggle(a)},
l.TOGGLE_DELAY_AFTER_EXPAND)):(b.scrollToIfNeeded(a),c.toggle(a))})};disableTextSelection(c);d=document.createElement("span");d.className="ellipsisLabel";this.generateLabel(a,d);f.appendChild(c);c.appendChild(d);this.tree.getUIObjectForNode(a).cbEl=c;this.tree.getUIObjectForNode(a).labelEl=d};
CustomerWithoutCheckboxNodeRenderer.prototype.updateUI=function(a){var b="ellipsisLabel";this.tree.getSelectionController().containsSelectedChildren(a)&&(b+=" checked");this.tree.getUIObjectForNode(a).labelEl.className=b;SelectionTreeNodeRenderer.prototype.updateUI.call(this,a)};function CustomerProjectSelectorTree(a,b,c){TriStateSelectorTree.call(this,a,b,c)}CustomerProjectSelectorTree.prototype=_.create(TriStateSelectorTree.prototype);CustomerProjectSelectorTree.prototype.isSelectionChanged=function(){return HierarchySelectorUtil.isSelectionChanged(this)};CustomerProjectSelectorTree.prototype.getLowLevelEntities=function(a){var b=[];_.each(this.getAllNodes(),function(c){c.getType()==TreeNode.TYPE_PROJECT&&a(c.getValue())&&b.push(c.getValue())});return b};function PermissionsSection(){}PermissionsSection.prototype=new BaseUserDataSection;PermissionsSection.sectionShownFirstTime=!0;
PermissionsSection.prototype.init=function(a,b,c,d,e,f){BaseUserDataSection.prototype.init.call(this,a,d,f);a=b.viewerSettings.enabledFeatures;this._findSectionElements();this._createRightToChBoxMap();this._setEventOnChBoxes();this._setGenerateTimeAndMoneyChBoxesText(a);this._setAvailableReportsNote(a);this.manageGeneralSettingsNote.title=this._createManageGeneralSettingsToolTip(a);PermissionsSection.sectionShownFirstTime&&(this._makeUnselectableChBoxLabels(),PermissionsSection.sectionShownFirstTime=
!1);c=this.createRightsMapFromArray(c);this._preselectChBoxes(c);this._hideChBoxesAccordingToFeatures(a);(this.editedUserIsLoggedIn=e)?(this.sectionEl.className="permissionsTemplatesEditPopup editedUserIsLoggedIn",this.manageAccountsChBox.disabled=!0):(this.sectionEl.className="permissionsTemplatesEditPopup",this.manageAccountsChBox.disabled=!1);return this};
PermissionsSection.prototype.updateCheckboxesByArrayOfPermissions=function(a,b){var c=this.createRightsMapFromArray(a),d=this.rightToChBoxMap,e;for(e in d){var f=c.hasOwnProperty(e);d[e].checked=f;this._onRightChanged(e,f,b)}};
PermissionsSection.prototype._createManageGeneralSettingsToolTip=function(a){var b=a.hasOwnProperty(UserManagementConstants.BTYFeature),c=a.hasOwnProperty(UserManagementConstants.LVTFeature);a=a.hasOwnProperty(UserManagementConstants.CLTFeature);b=b?messageResource.getMessage("userlist.userdata.settings.billingType")+" ":"";c=c&&a?messageResource.getMessage("userlist.userdata.settings.leaveType")+" ":"";a=a?messageResource.getMessage("userlist.userdata.settings.notifications")+" ":"";return messageResource.getMessage("userlist.userdata.settings.note",
[b,c,a])};
PermissionsSection.prototype._hideChBoxesAccordingToFeatures=function(a){a.hasOwnProperty(UserManagementConstants.URAFeature)||a.hasOwnProperty(UserManagementConstants.BTYFeature)?this.generateMoneyReportRightContainer.style.visibility="visible":this.generateMoneyReportRightContainer.style.visibility="hidden";a.hasOwnProperty(UserManagementConstants.PTOFeature)||a.hasOwnProperty(UserManagementConstants.SDBFeature)?this.ptoRightContainer.style.display="table-row":this.ptoRightContainer.style.display="none";
a.hasOwnProperty(UserManagementConstants.LTTFeature)?this.lockTimeTrackContainer.style.display="table-row":this.lockTimeTrackContainer.style.display="none"};
PermissionsSection.prototype._findSectionElements=function(){this.sectionEl=this.getElementBySubId("permissionsSection");this.manageGeneralSettingsNote=this.getElementBySubId("manageGeneralSettingsNote");this.submitTimeTrackChBox=this.getElementBySubId("submitTimeTrackChBox");this.submitOtherUserTimeTrackChBox=this.getElementBySubId("submitOtherUserTimeTrackChBox");this.lockTimeTrackChBox=this.getElementBySubId("lockTimeTrackChBox");this.lockTimeTrackContainer=this.getElementBySubId("lockTTRightContainer");
this.manageCustomerProjectChBox=this.getElementBySubId("manageCustomersProjectsChBox");this.manageTaskChBox=this.getElementBySubId("manageTasksChBox");this.generateTimeReportsChBox=this.getElementBySubId("generateTimeReportsChBox");this.generateTimeReportsLabel=this.getElementBySubId("generateTimeReportsLabel");this.generateMoneyReportsChBox=this.getElementBySubId("generateMoneyReportsChBox");this.generateMoneyReportsLabel=this.getElementBySubId("generateMoneyReportsLabel");this.managePTOAndSickChBox=
this.getElementBySubId("ptoSettingsChBox");this.manageAccountsChBox=this.getElementBySubId("manageAccountsChBox");this.manageGeneralSettingsChBox=this.getElementBySubId("manageGeneralSettingsChBox");this.availableTimeReportsNote=this.getElementBySubId("availableTimeReportsNote");this.availableMoneyReportsNote=this.getElementBySubId("availableMoneyReportsNote");this.generateMoneyReportRightContainer=this.getElementBySubId("generateMoneyReportRightContainer");this.cantRevokeManageUsersRightNote=this.getElementBySubId("cantRevokeManageUsersRightNote");
this.ptoRightContainer=this.getElementBySubId("ptoRightContainer")};
PermissionsSection.prototype._createRightToChBoxMap=function(){this.rightToChBoxMap={};this.rightToChBoxMap[window.__GENERATED_CONSTANTS__.AccessRight.SUBMIT_TIME_TRACK]=this.submitTimeTrackChBox;this.rightToChBoxMap[window.__GENERATED_CONSTANTS__.AccessRight.SUBMIT_OTHER_USER_TIME_TRACK]=this.submitOtherUserTimeTrackChBox;this.rightToChBoxMap[window.__GENERATED_CONSTANTS__.AccessRight.LOCK_TIME_TRACK]=this.lockTimeTrackChBox;this.rightToChBoxMap[window.__GENERATED_CONSTANTS__.AccessRight.MANAGE_CUSTOMERS_PROJECTS]=this.manageCustomerProjectChBox;
this.rightToChBoxMap[window.__GENERATED_CONSTANTS__.AccessRight.MANAGE_TASKS]=this.manageTaskChBox;this.rightToChBoxMap[window.__GENERATED_CONSTANTS__.AccessRight.GENERATE_TIME_REPORTS]=this.generateTimeReportsChBox;this.rightToChBoxMap[window.__GENERATED_CONSTANTS__.AccessRight.GENERATE_MONEY_REPORTS]=this.generateMoneyReportsChBox;this.rightToChBoxMap[window.__GENERATED_CONSTANTS__.AccessRight.MANAGE_PTO_AND_SICK]=this.managePTOAndSickChBox;this.rightToChBoxMap[window.__GENERATED_CONSTANTS__.AccessRight.MANAGE_USERS]=
this.manageAccountsChBox;this.rightToChBoxMap[window.__GENERATED_CONSTANTS__.AccessRight.MANAGE_GENERAL_SETTINGS]=this.manageGeneralSettingsChBox};PermissionsSection.prototype._setEventOnChBoxes=function(){var a=this.rightToChBoxMap,b=this,c;for(c in a)(function(c){a[c].onclick=function(){b._onRightChanged(c,a[c].checked,!1)}})(c)};
PermissionsSection.prototype.removeChangeDetectingAndEnableManageUsersChBox=function(){var a=this,b=this.rightToChBoxMap,c;for(c in b)(function(c,e){b[e].onclick=function(){a._onRightChanged(e,b[e].checked,!0)};e==window.__GENERATED_CONSTANTS__.AccessRight.MANAGE_USERS&&c.editedUserIsLoggedIn&&($(c.sectionEl).removeClass("editedUserIsLoggedIn"),c.manageAccountsChBox.disabled=!1)})(this,c)};PermissionsSection.prototype._makeUnselectableChBoxLabels=function(){var a=this.rightToChBoxMap,b;for(b in a)this.makeUnselectable(a[b].parentNode.parentNode)};
PermissionsSection.prototype._setGenerateTimeAndMoneyChBoxesText=function(a){var b="",c="",b=a.hasOwnProperty(UserManagementConstants.BTYFeature)||a.hasOwnProperty(UserManagementConstants.URAFeature)?messageResource.getMessage("access_rights.generate_time_reports"):messageResource.getMessage("access_rights.generate_reports");a.hasOwnProperty(UserManagementConstants.BTYFeature)&&a.hasOwnProperty(UserManagementConstants.URAFeature)?c=messageResource.getMessage("access_rights.generate_money_reports"):
a.hasOwnProperty(UserManagementConstants.BTYFeature)?c=messageResource.getMessage("access_rights.generate_money_reports_only_billing_plural"):a.hasOwnProperty(UserManagementConstants.URAFeature)&&(c=messageResource.getMessage("access_rights.generate_money_reports_only_cost"));this.generateTimeReportsLabel.innerHTML=b;this.generateMoneyReportsLabel.innerHTML=c};
PermissionsSection.prototype._setAvailableReportsNote=function(a){this.availableTimeReportsNote.title=this.createAvailableByFeatureTimeReportsMsg(a);this.availableMoneyReportsNote.title=this.createAvailableByFeatureMoneyReportsMsg(a)};
PermissionsSection.prototype.createAvailableByFeatureTimeReportsMsg=function(a){msg="";msg+=UserManagementConstants.REPORT_TO_REPORT_NAME_MAP.STAFF_PERFORMANCE+", "+UserManagementConstants.REPORT_TO_REPORT_NAME_MAP.OVERTIME+", ";a.hasOwnProperty(UserManagementConstants.LVTFeature)&&a.hasOwnProperty(UserManagementConstants.CLTFeature)&&(msg+=UserManagementConstants.REPORT_TO_REPORT_NAME_MAP.LEAVE_TIME+", ");a.hasOwnProperty(UserManagementConstants.TTCFeature)&&(msg+=UserManagementConstants.REPORT_TO_REPORT_NAME_MAP.TIME_TRACK_IN_DETAIL+
", ");a.hasOwnProperty(UserManagementConstants.ESTFeature)&&(msg+=UserManagementConstants.REPORT_TO_REPORT_NAME_MAP.ESTIMATED_VS_ACTUAL+", ");return msg.substring(0,msg.length-2)};
PermissionsSection.prototype.createAvailableByFeatureMoneyReportsMsg=function(a){msg="";a.hasOwnProperty(UserManagementConstants.BTYFeature)&&(msg+=UserManagementConstants.REPORT_TO_REPORT_NAME_MAP.BILLING_SUMMARY+", ");a.hasOwnProperty(UserManagementConstants.BRAFeature)&&(msg+=UserManagementConstants.REPORT_TO_REPORT_NAME_MAP.INVOICING+", ");a.hasOwnProperty(UserManagementConstants.URAFeature)&&(msg+=UserManagementConstants.REPORT_TO_REPORT_NAME_MAP.COST_OF_WORK+", ");a.hasOwnProperty(UserManagementConstants.URAFeature)&&
a.hasOwnProperty(UserManagementConstants.BRAFeature)&&(msg+=UserManagementConstants.REPORT_TO_REPORT_NAME_MAP.PROFIT_LOSS+", ");return msg.substring(0,msg.length-2)};PermissionsSection.prototype._onRightChanged=function(a,b,c){c||this.changesDetected()};PermissionsSection.prototype.getSelectedRights=function(){var a=[],b=this.rightToChBoxMap,c;for(c in b)b[c].checked&&a.push(c);return a};
PermissionsSection.prototype._preselectChBoxes=function(a){var b=this.rightToChBoxMap,c;for(c in b)b[c].checked=a.hasOwnProperty(c)};PermissionsSection.prototype.createRightsMapFromArray=function(a){for(var b={},c=0;c<a.length;c++)b[a[c]]=!0;return b};PermissionsSection.prototype.getFirstChBox=function(){return this.rightToChBoxMap[window.__GENERATED_CONSTANTS__.AccessRight.SUBMIT_TIME_TRACK]};PermissionsSection.prototype.getLastChBox=function(){return this.rightToChBoxMap[window.__GENERATED_CONSTANTS__.AccessRight.MANAGE_GENERAL_SETTINGS]};
PermissionsSection.prototype.getSectionEl=function(){return this.sectionEl};PermissionsSection.prototype.disableCheckboxes=function(){for(var a in this.rightToChBoxMap)this.rightToChBoxMap.hasOwnProperty(a)&&(this.rightToChBoxMap[a].disabled=!0)};
PermissionsSection.prototype.enableCheckboxes=function(a){for(var b in this.rightToChBoxMap)this.rightToChBoxMap.hasOwnProperty(b)&&(a&&b==window.__GENERATED_CONSTANTS__.AccessRight.MANAGE_USERS&&this.editedUserIsLoggedIn?(this.rightToChBoxMap[b].disabled=!0,this.rightToChBoxMap[b].checked=!0,$(this.sectionEl).addClass("editedUserIsLoggedIn")):this.rightToChBoxMap[b].disabled=!1)};function WorkScheduleAndOvertimeSection(){}WorkScheduleAndOvertimeSection.prototype=new WorkScheduleSection;
WorkScheduleAndOvertimeSection.prototype.init=function(a,b,c,d,e,f,g,h){WorkScheduleSection.prototype.init.call(this,a,b,c,d,e,f,g,h);a=this.getElementBySubId("overtimeSelectorPlaceholder");this.preloadOvertimeLevel=d.overtimeLevel;c=c.viewerSettings.enabledFeatures;g&&c.hasOwnProperty(UserManagementConstants.OVRFeature)?(a.innerHTML="",this._overtimeSelector=this.createOvertimeSelector(this.preloadOvertimeLevel,a),g="userlist.userdata.schedule.work_schedule_and_overtime"):g="userlist.userdata.schedule.work_schedule";
this.getElementBySubId("sectionHeaderPlaceholder").innerHTML=messageResource.getMessage(g);this._hideElementsAccordingToFeatures(c);return this};WorkScheduleSection.prototype._getSectionEl=function(){return this.getElementBySubId("workScheduleAndOvertimeSection")};
WorkScheduleAndOvertimeSection.prototype.createOvertimeSelector=function(a,b){var c=SystemSettings.defaultOvertimeLevel,d=" "+messageResource.getMessage("userlist.js.overtime_selector.default"),c=[{text:messageResource.getMessage("userlist.js.overtime_off")+(c==UserManagementConstants.OVERTIME_OFF?d:""),value:UserManagementConstants.OVERTIME_OFF},{text:messageResource.getMessage("userlist.js.overtime_auto_hidden")+(c==UserManagementConstants.OVERTIME_AUTO_HIDDEN?d:""),value:UserManagementConstants.OVERTIME_AUTO_HIDDEN},
{text:messageResource.getMessage("userlist.js.overtime_auto")+(c==UserManagementConstants.OVERTIME_AUTO?d:""),value:UserManagementConstants.OVERTIME_AUTO},{text:messageResource.getMessage("userlist.js.overtime_manual")+(c==UserManagementConstants.OVERTIME_MANUAL?d:""),value:UserManagementConstants.OVERTIME_MANUAL}],c=new ListSelector({menuCls:"overtimeSelectorMenu",renderTo:b,value:a,listItems:c,scrollableContainer:this._getSectionEl().parentNode,listeners:{menushow:function(a,b){$(b.el.dom).on(ScrollUtils.getWheelEventName(),
function(a){a.preventDefault()})}}}),e=this;c.on("change",function(a,b){e.changesDetected()});return c};WorkScheduleAndOvertimeSection.prototype.getOvertimeTrackingLevel=function(){return this._overtimeSelector?this._overtimeSelector.getSelectedItem().value:this.preloadOvertimeLevel};WorkScheduleAndOvertimeSection.prototype.setOvertimeTrackingLevelCallback=function(a){if(this._overtimeSelector)this._overtimeSelector.on("change",function(b,c){a(c.value)})};
WorkScheduleAndOvertimeSection.prototype._hideElementsAccordingToFeatures=function(a){var b=this.getElementBySubId("scheduleOvertimeTable");a.hasOwnProperty(UserManagementConstants.OVRFeature)?b.style.display="block":b.style.display="none"};WorkScheduleAndOvertimeSection.prototype.hideOpenedExtJSSelector=function(){this._overtimeSelector&&this._overtimeSelector.hideMenuOnScrollOrResize();this._workdayDurationsTable&&"function"===typeof this._workdayDurationsTable.hideOpenedExtJSSelector&&this._workdayDurationsTable.hideOpenedExtJSSelector()};function LoadTasksFromCSVPopup(){DHTMLPopupWithMoire.call(this,"loadTasksFromCSVPopup")}function _DropzoneStrategy(a,b){this.contentEl=a;this.dropzone=b}_DropzoneStrategy.prototype.removeAllFiles=function(){this.isReloadState=!1;this.dropzone.removeAllFiles();this.dropzone.multipleFileLoad=!1};_DropzoneStrategy.prototype.reloadFile=function(){this.isReloadState=!0;var a=this.dropzone.getAcceptedFiles()[0];a||(a=this.dropzone.getRejectedFiles()[0]);this.dropzone.uploadFile(a)};
_DropzoneStrategy.prototype.removeImportedFile=function(){this.dropzone.removeAllFiles()};_DropzoneStrategy.prototype.getSelectedFilesNumber=function(){return this.dropzone.files.length};function _DropzoneFallbackStrategy(a,b,c){this.reloadCallback=a;this.uploadCallback=b;this.container=c;this.fileSelected=!0}_DropzoneFallbackStrategy.prototype.removeAllFiles=function(){this.fileSelected=this.isReloadState=!1;this.container.empty();this.reloadCallback()};
_DropzoneFallbackStrategy.prototype.removeImportedFile=function(){this.fileSelected=!1};_DropzoneFallbackStrategy.prototype.getSelectedFilesNumber=function(){return this.fileSelected?1:0};_DropzoneFallbackStrategy.prototype.reloadFile=function(){this.isReloadState=!0;this.container.empty();this.uploadCallback()};
LoadTasksFromCSVPopup.prototype=_.create(DHTMLPopupWithMoire.prototype,{hideOnMouseDown:_.constant(!1),hideOnResize:_.constant(!1),hideOnEscape:_.constant(!0),innerId:function(a){return"#"+this.popupId+a},innerElement:function(a){return $(this.innerId(a))},init:function(a,b,c,d,e){this.popupEl=this.innerElement("");this.choseFileContent=this.innerElement("_fileContent");this.resultContent=this.innerElement("_resultContent");var f=_.bind(this.hide,this);$("#closeLoadTasksFromCSVPopupButton").click(f);
this.innerElement("_cancelBtn").click(f);this.completeImportCallback=c;this.importButton=this.innerElement("_commitBtn");this.importButton.click(_.bind(this.completeImport,this));this.innerContent=this.innerElement("_innerContent");this.dropZoneEl=this.innerElement("_dropzone");this.slideWrapper=this.innerElement("_slideWrapper");this.successLinkContainer=$("#successLinkContainer");this.failsLinkContainer=$("#failsLinkContainer");this.importPreviewSection=$("#importPreviewSection");this.buttonsSection=
this.innerElement("_buttonsSection");this.importingProgressBarContainer=this.innerElement("_importingProgressBarContainer");this.dynamicProgressBar=this.importingProgressBarContainer.find(".dynamicProgressBar");this.importingProgressText=this.importingProgressBarContainer.find(".improtingProgressText");this.fallbackInput=$("#dropzoneFailbackSelector");this.initDropzone(a,b);this.innerElement("_startNewImport").click(_.bind(this.restartImport,this));this.modificationsMade=!1;this.successTaskCreationCallback=
d;this.fileRemovedCallback=e;this.infoPopup=(new InfoPopup("loadTasksFromCSVInfoPopup")).init(this);$("#infoLink").click(this.wrapEventHandler(_.bind(this.infoPopup.show,this.infoPopup)));return this},wrapEventHandler:function(a){return _.bind(function(b){if(!1!==this.renderingComplete)return a(b)},this)},startRendering:function(){this.renderingTimeOutId&&(window.clearTimeout(this.renderingTimeOutId),this.finishRenderingBinded());this.renderingComplete=!1},finishRendering:function(){this.renderingComplete=
!0;this.renderingTimeOutId=null},removeLoadingMoire:function(){this.innerContent.removeClass("renderingInProgress")},removeReloadingMoire:function(){this.innerContent.removeClass("reloadingInProgress");this.slideWrapper.find(".reloadCSVMoire").removeClass("animate")},finishRenderingDeferred:function(a){this.finishRenderingBinded=_.bind(function(){this.finishRendering();a.call(this)},this);this.renderingTimeOutId=setTimeout(this.finishRenderingBinded,50)},switchToResult:function(){this.dropzoneStrategy.removeImportedFile();
this.choseFileContent.hide();this.resultContent.show();this.toggleImportingProcessScreen(!1);this.modificationsMade=!0},switchToImportFile:function(){this.choseFileContent.show();this.resultContent.hide()},toggleImportEnabled:function(a){this.importEnabled=a;this.importButton.toggleClass("disabled",!a)},completeImport:function(){if(this.importEnabled){var a=this;this.toggleImportingProcessScreen(!0);this.completeImportCallback(_.bind(this.switchToResult,this),function(){a.toggleImportingProcessScreen(!1);
return!1},_.bind(this.progressFrame,this))}},restartImport:function(){this.removeAllFiles();this.switchToImportFile()},showInnerContent:function(a){this.failsLinkContainer.toggle(a);this.successLinkContainer.toggleClass("showTableLinks",a);this.importPreviewSection.addClass("visible");this.buttonsSection.addClass("visible")},hideInnerContent:function(){this.failsLinkContainer.hide();this.importPreviewSection.removeClass("visible");this.buttonsSection.removeClass("visible")},toggleImportingProcessScreen:function(a){this.importingInProgress=
a;this.popupEl.toggleClass("importingInProgress",a);this.innerContent.toggleClass("importingInProgress",a);a||this.progressFrame(0)},initDropzone:function(a,b){var c=this;this.onCSVLoadSuccessCallback=b;var d=messageResource.getMessage("common.multiple_upload_error"),e=JQUERY_RPC_ERROR_MESSAGES.NETWORK_ERROR,f=document.querySelector("#dropzoneTemplate").innerHTML;this.dropzone=new Dropzone(this.innerId("_dropzone"),{previewTemplate:f,url:a,sending:function(a,b,c){c.append(window.__GENERATED_CONSTANTS__.RequestVerification.FORM_INPUT_NAME,
window.__GENERATED_CONSTANTS__.RequestVerification.FORM_INPUT_VALUE)},maxFilesize:10,createImageThumbnails:!1,maxFiles:1,dictMaxFilesExceeded:d,dictResponseError:e,clickable:"#dropzoneClickableArea",success:_.bind(c.dropzoneSuccess,c),accept:function(a,b){1==this.files.length?b():b(d)},error:function(a,b){if(b==d)$(".dz-details").hide(),this.multipleFileLoad||alert(d),this.multipleFileLoad=!0,this.removeFile(a),$(".dz-details").show();else if(b==e)c.dropzoneStrategy.isReloadState?(alert(messageResource.getMessage("import_csv_tasks.error.connection_error")),
c.innerContent.removeClass("reloadingInProgress"),c.slideWrapper.find(".reloadCSVMoire").removeClass("animate")):(alert(e),c.removeAllFiles());else{var f=c.dropzoneStrategy.isReloadState&&0<b.indexOf("Stream ended unexpectedly")?"import_csv_tasks.error.reload_failed":"import_csv_tasks.error.loading_failed";alert(messageResource.getMessage(f));c.removeAllFiles()}},fallback:_.bind(this.dropzoneFallback,this,a,b,f)});this.dropzone.on("addedfile",_.bind(this.setDropzoneTemplateHandlers,this));this.dropzone.on("removedfile",
function(){c.dropzone.setupEventListeners()})},processBigData:function(a){a&&(this.hidingInProgress?this.fileRemovedCallback():a())},dropzoneSuccess:function(a,b){if(!this.hidingInProgress){this.dropzone.removeEventListeners();var c=JSON.parse(b),c=this.onCSVLoadSuccessCallback(c),d=c.success,e=c.handler;d||this.removeAllFiles();if(this.dropzoneStrategy.isReloadState)this.startRendering(),this.processBigData(e),this.finishRenderingDeferred(this.removeReloadingMoire);else if(d){var f=this;if(e){this.startRendering();
this.dropZoneEl.removeClass("fileLoading collapsing").addClass("fileSelected");var g=new Spinner({length:5,width:2,radius:4,lines:10,color:"#aaaaaa",trail:60}),c=document.getElementById("bigDataSpinner");g.spin(c);this.innerContent.addClass("renderingInProgress");this.setInnerContent(a);setTimeout(function(){f.processBigData(e);g.stop();f.finishRenderingDeferred(f.removeLoadingMoire)},50)}else this.renderingComplete=!0,this.dropZoneElAnimated=this.dropZoneEl.atAnimation(),this.dropZoneElAnimated.oneAnimationEnd(function(a){f.dropZoneEl.removeClass("fileLoading collapsing").addClass("fileSelected");
a.stopPropagation()}),this.dropZoneEl.addClass("collapsing"),this.setInnerContent(a)}}},setInnerContent:function(a){this.slideWrapper.addClass("visible");this.importingProgressText[0].innerHTML=escapeHtmlSymbols(messageResource.getMessage("import_csv_tasks.importing_from",[a.name]))},animateMoireOverTable:function(){this.innerContent.addClass("reloadingInProgress");this.slideWrapper.find(".reloadCSVMoire").addClass("animate")},reloadFile:function(){this.animateMoireOverTable();this.dropzone.setupEventListeners();
this.dropzoneStrategy.reloadFile()},dropzoneFallback:function(a,b,c){var d=this.dropZoneEl;d.addClass("fallback");var e=$("#dropzoneFailbackFileContainer"),f=this.fallbackInput;f[0].innerHTML="<input name='file' type='file' />";var g=f.find("input[type=file]"),f=$('<form action="'+a+'" method="post" enctype="multipart/form-data" target="iframe-name"></form>');f.append('<input type="hidden" name="'+window.__GENERATED_CONSTANTS__.RequestVerification.FORM_INPUT_NAME+'" value="'+window.__GENERATED_CONSTANTS__.RequestVerification.FORM_INPUT_VALUE+
'"/>');g.before('<iframe name="iframe-name" src="#" style="display:none;"></iframe>').wrap(f).delay(1500);_.isUndefined(this.fallbackSpinner)&&(this.fallbackSprinner=new Spinner({length:5,width:2,radius:4,lines:10,color:"#aaaaaa",trail:60}));var h=this,k=document.getElementById("dropzoneFailbackSelectorSpinner"),m=function(){var f=$(this).val();if(f){var p=!_.isUndefined(h.dropzoneStrategy)&&h.dropzoneStrategy.isReloadState;p?h.animateMoireOverTable():d.addClass("fileLoading");h.fallbackSprinner.spin(k);
var t=g.parent();t.submit();t.prev().one("load",function(){h.fallbackSprinner.stop();var a=$(this).next()[0];h.hideCallback=function(){a.reset()};if(!h.hidingInProgress){try{var c=$(this).contents().find("body").html()}catch(e){alert(JQUERY_RPC_ERROR_MESSAGES.NETWORK_ERROR);h.innerContent.removeClass("reloadingInProgress");h.removeAllFiles();return}h.innerContent.removeClass("reloadingInProgress");var c=b(JSON.parse(c)),f=c.handler;c.success?(h.renderingComplete=!1,h.processBigData(f),d.removeClass("fileLoading").addClass("fileSelected"),
h.innerContent.removeClass("reloadingInProgress"),h.slideWrapper.addClass("visible"),h.renderingComplete=!0):h.removeAllFiles()}});e.append(c);f=f.replace(/^.*[\\\/]/,"");e.find(".dz-filename")[0].innerHTML=escapeHtmlSymbols(f);h.importingProgressText[0].innerHTML=escapeHtmlSymbols(messageResource.getMessage("import_csv_tasks.importing_from",[f]));e.find(".dz-progress").addClass("dz-complete");p||(h.dropzoneStrategy=new _DropzoneFallbackStrategy(function(){h.dropzoneFallback(a,b,c)},_.bind(m,this),
e));h.setDropzoneTemplateHandlers()}};g.off().change(m);this.fallbackInput.removeClass("fileSelected fileLoading")},progressFrame:function(a){100>=a&&this.dynamicProgressBar.width(a+"%")},setDropzoneTemplateHandlers:function(){_.isUndefined(this.dropzoneStrategy)&&(this.dropzoneStrategy=new _DropzoneStrategy(this.innerContent,this.dropzone));1<this.dropzoneStrategy.getSelectedFilesNumber()||(this.dropZoneEl.addClass("fileLoading"),this.dropZoneEl.find(".dz-remove").click(_.bind(this.removeAllFiles,
this)),this.dropZoneEl.find(".dz-reload").click(_.bind(this.reloadFile,this)))},removeAllFiles:function(){this.dropzoneStrategy&&this.dropzoneStrategy.removeAllFiles();this.fileRemovedCallback();this.hideInnerContent();this.innerContent.removeClass("reloadingInProgress");this.dropZoneEl.find(".dz-upload").width(0);this.dropZoneEl.removeClass("fileSelected fileLoading");this.slideWrapper.removeClass("visible");this.fallbackInput.removeClass("fileSelected");this.importingInProgress=!1},show:function(){this.hidingInProgress=
!1;this.removeAllFiles();this.hideInnerContent();ExitConfirmationHandlersManager.setUpExitConfirmation(messageResource.getMessage("import_csv_tasks.error.confirm_close"),_.bind(this.isFileSelected,this),!1);DHTMLPopupWithMoire.prototype.show.call(this);this.dropzone&&this.dropzone.setupEventListeners()},isModified:function(){return this.modificationsMade},isFileSelected:function(){return this.renderingComplete&&!_.isUndefined(this.dropzoneStrategy)&&0<this.dropzoneStrategy.getSelectedFilesNumber()},
hide:function(){if(!(this.importingInProgress||this.infoPopup.isShowed||this.isFileSelected()&&!confirm(messageResource.getMessage("import_csv_tasks.error.confirm_close")))){this.hidingInProgress=!0;this.fileRemovedCallback();ExitConfirmationHandlersManager.restoreExitConfirmation();this.dropzone&&(this.dropzone.removeEventListeners(),this.dropzone.removeAllFiles());if(this.innerContent)this.innerContent.on(AtAnimation.getAnimationEndEventName(),stopEventPropagation);DHTMLPopupWithMoire.prototype.hide.call(this);
this.modificationsMade&&this.successTaskCreationCallback();this.toggleImportingProcessScreen(!1);this.innerContent.removeClass("reloadingInProgress");this.hideCallback&&this.hideCallback()}},onHideAnimationEnd:function(){this.innerContent&&this.innerContent.off(AtAnimation.getAnimationEndEventName())}});function InfoPopup(a,b){DHTMLPopupWithMoire.call(this,a)}
InfoPopup.prototype=_.create(DHTMLPopupWithMoire.prototype,{hideOnResize:_.constant(!1),hideOnMouseDown:_.constant(!1),hideOnEscape:_.constant(!0),init:function(a){this.popupEl=$("#"+this.popupId);this.parent=a;$("#infoPopupCloseButton").click(_.bind(this.hide,this));return this},show:function(){this.parent.isShowed&&(DHTMLPopupWithMoire.prototype.show.call(this),_.isUndefined(this.verticalScroll)&&(this.verticalScroll=ScrollUtils.addVerticalScroll($("#importCSVTaskInfoContainer"))))},centrePopup:function(){}});function LeaveTypeDefaultRatePopup(){}
LeaveTypeDefaultRatePopup.prototype.init=function(a,b,c){var d=this;this.container=$("#"+a);this.numberSettings=b;this.dialog=new DropdownDialog({wrapperClass:"leaveTypeDefaultRatePopup",dialogDiv:this.container,hideButtons:!0,hideOnResize:!0,showEmptyTitleBar:!1,isWithBeak:!1,onClose:function(){d.afterCloseHandler&&d.afterCloseHandler()}});this.rateCoeffFieldEl=this.container.find(".inputDiv");this.rateCoeffFieldEl.on("blur",function(){d.newValue!=d.rateCoeffField.getValue()&&d.hasError&&d.hideError()});
this.rateCoeffField=new DecimalField(this.rateCoeffFieldEl,!0,5,2,this.numberSettings.decimalSeparator,!1,this.numberSettings.digitGroupingSymbol,void 0,!0,this.numberSettings.rateMaxNumber);this.applyButton=this.container.find(".applyButton");this.applyButton.on("click",function(){d.newValue=trim(d.rateCoeffField.getValue());d.container.removeClass("longError");""==d.newValue?d.showError(messageResource.getMessage("leave_type.error.rate_coefficient_required")):d.rateCoeffField.isValid()?c(d.leaveType.id,
d.rateCoeffField.getValueAsNumber(),function(){d.dialog.hide()}):(d.showError(messageResource.getMessage("leave_type.error.invalid_rate_coefficient",[d.numberSettings.decimalSeparator,d.numberSettings.ptoMaxNumber])),d.container.addClass("longError"))});this.cancelButton=this.container.find(".cancelButton");this.cancelButton.on("click",function(){d.dialog.hide()});return this};LeaveTypeDefaultRatePopup.prototype.setLeaveType=function(a){this.leaveType=a;this.rateCoeffField.setValueAsNumber(a.rateCoefficient)};
LeaveTypeDefaultRatePopup.prototype.show=function(a,b,c,d){c&&c();this.afterCloseHandler=d;this.hideError();this.dialog.showAt(a,b)};LeaveTypeDefaultRatePopup.prototype.showError=function(a){this.container.find(".errorPlaceholder").text(a);this.container.addClass("error");this.hasError=!0};LeaveTypeDefaultRatePopup.prototype.hideError=function(){this.container.removeClass("error");this.hasError=!1};function LeaveTypeDefaultRateCellRenderer(){this.constructor=LeaveTypeDefaultRateCellRenderer}LeaveTypeDefaultRateCellRenderer.prototype=_.create(TableCellRenderer.prototype);LeaveTypeDefaultRateCellRenderer.prototype.init=function(a,b,c){TableCellRenderer.call(this);this.coefficientsFormatter=a;this.numberSettings=b;this.onEditLeaveTypeDefaultRateCallback=c;return this};LeaveTypeDefaultRateCellRenderer.prototype.getCellClassName=function(a){return["leaveTypeDefaultRateCell"]};
LeaveTypeDefaultRateCellRenderer.prototype.generateContent=function(a){var b=this,c=document.createElement("span");c.className="leaveTypeInfoText";$(c).html("<span style='font-weight:bold'>"+this.coefficientsFormatter.format(a.getValue().rateCoefficient)+"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x &nbsp;&nbsp;"+messageResource.getMessage("leave_type.list.rate_coefficient_cell.text"));a.getCellEl().onclick=function(){var c=a.getTable();c.defaultRatePopup||(c.defaultRatePopup=(new LeaveTypeDefaultRatePopup).init("LeaveTypeDefaultRatePopup",
b.numberSettings,b.onEditLeaveTypeDefaultRateCallback));c.defaultRatePopup.setLeaveType(a.value);c.defaultRatePopup.show($(a.getCellEl()),{my:"left top",at:"left top",offset:"1px -1px"},function(){a.getRow().addOpenPopupClass()},function(){a.getRow().removeOpenPopupClass()})};a.getCellEl().appendChild(c)};function LeaveTypeATListTableRenderer(){this.constructor=LeaveTypeATListTableRenderer}LeaveTypeATListTableRenderer.prototype=_.create(LeaveTypeListTableRenderer.prototype);LeaveTypeATListTableRenderer.prototype.getTableClasses=function(){return this.getBaseTableClasses()};function LeaveTypeATListTableController(){this.constructor=LeaveTypeATListTableController}LeaveTypeATListTableController.prototype=_.create(LeaveTypeListTableController.prototype);LeaveTypeATListTableController.prototype.init=function(a){this.isPtoEnabled=a.isPtoEnabled;this.isSickEnabled=a.isSickEnabled;this.isUserRatesEnabled=a.isUserRatesEnabled;LeaveTypeListTableController.prototype.init.call(this,a);return this};LeaveTypeATListTableController.prototype.getLeaveTypeListTableRenderer=function(){return new LeaveTypeATListTableRenderer};
LeaveTypeATListTableController.prototype.render=function(){LeaveTypeListTableController.prototype.render.call(this);(this.isPtoEnabled||this.isSickEnabled)&&this.setupTableHeaderEventHandlers()};
LeaveTypeATListTableController.prototype.addCellsToRow=function(a,b){a.addCellObj(this.createLeaveTypeChangeOrderCell(b,a));a.addCellObj(this.createLeaveTypeImageCell(b,a));a.addCellObj(this.createLeaveTypeNameCell(b,a));(this.isPtoEnabled||this.isSickEnabled)&&a.addCellObj(this.createLeaveTypeAffectedBalanceCell(b,a));this.isUserRatesEnabled&&a.addCellObj(this.createLeaveTypeDefaultRateCell(b,a));a.addCellObj(this.createLeaveTypeStatusCell(b,a));a.addCellObj(this.createLeaveTypeDeleteCell(b,a))};
LeaveTypeATListTableController.prototype.createLeaveTypeDefaultRateCell=function(a){a=new TableCell(a);a.setRenderer((new LeaveTypeDefaultRateCellRenderer).init(this.coefficientsFormatter,this.numberSettings,this.handlersMap.setRateCoefficient));return a};function LeaveTypeATListPageController(){this.constructor=LeaveTypeATListPageController}LeaveTypeATListPageController.prototype=_.create(LeaveTypeListPageController.prototype);
LeaveTypeATListPageController.prototype.init=function(a,b,c,d,e,f,g){this.isPtoEnabled=e;this.isSickEnabled=f;this.isUserRatesEnabled=g;LeaveTypeListPageController.prototype.init.call(this,a,c,d);this.tableHeaderTooltipsOffsetParams="-66px 4px";this.leaveTypeListTableController=(new LeaveTypeATListTableController).init({tHeadEl:this.tHeadEl,containerEl:this.containerEl,leaveTypeRecords:a,handlersMap:this.handlersMap,arrowImagesPaths:b,numberSettings:this.numberSettings,isPtoEnabled:this.isPtoEnabled,
isSickEnabled:this.isSickEnabled,isUserRatesEnabled:this.isUserRatesEnabled,iconSelectorPanel:this.iconSelectorPanel});return this};LeaveTypeATListPageController.prototype.initializeHandlersMap=function(){var a=this;this.handlersMap=this.createBaseHandlersMap();this.handlersMap.setRateCoefficient=function(b,c,d){a.setRateCoefficient(b,c,d)}};
LeaveTypeATListPageController.prototype.createAndInitLeaveTypeLightBox=function(){return(new LeaveTypeATLightBox).init(this.numberSettings,this.iconSelectorPanel,this.isPtoEnabled,this.isSickEnabled,this.isUserRatesEnabled)};
LeaveTypeATListPageController.prototype.leaveTypeServiceResultHandler=function(a,b){if(!LeaveTypeListPageController.prototype.leaveTypeServiceResultHandler.call(this,a,b)){PageOverlayTipsManager.getInstance().refreshDynamicTips(!1);var c=a.featuresInfo.ptoEnabled,d=a.featuresInfo.sickEnabled,e=a.featuresInfo.userRatesEnabled;this.isPtoEnabled!=c?(c=c?messageResource.getMessage("leave_type.warning.pto_feature_enabled"):messageResource.getMessage("leave_type.warning.pto_feature_disabled"),alert(c),
window.location.reload()):this.isSickEnabled!=d?(c=d?messageResource.getMessage("leave_type.warning.sdb_feature_enabled"):messageResource.getMessage("leave_type.warning.sdb_feature_disabled"),alert(c),window.location.reload()):this.isUserRatesEnabled!=e&&(c=e?messageResource.getMessage("leave_type.warning.ura_feature_enabled"):messageResource.getMessage("leave_type.warning.ura_feature_disabled"),alert(c),window.location.reload());PageOverlayTipsManager.getInstance().refreshDynamicTips()}};
LeaveTypeATListPageController.prototype.leaveTypeServiceErrorHandler=function(a,b,c,d){LeaveTypeListPageController.prototype.leaveTypeServiceErrorHandler.call(this,a,b,c,d);if("com.actimind.actitime.services.FeatureIsDisabledException"==c.exception)return alert(messageResource.getMessage("leave_type.error.lvt_feature_disabled")),ExitConfirmationHandlersManager.resetExitConfirmation(),window.location.reload(),!0};
LeaveTypeATListPageController.prototype.createAndInitIconSelectorPanel=function(){return(new LeaveTypeIconSelectorPanel).init("leaveTypeIconSelectorPanel",!1)};LeaveTypeATListPageController.prototype.setRateCoefficient=function(a,b,c){this.callLeaveTypeServiceMethod("LeaveTypeService.setRateCoefficient",[a,b],!0,c)};function LeaveTypeATLightBox(){}LeaveTypeATLightBox.CREATE_POPUP_DEFAULT_RATE_COEFF=1;LeaveTypeATLightBox.prototype=_.create(LeaveTypeLightBox.prototype);LeaveTypeATLightBox.prototype.init=function(a,b,c,d,e){var f=NoBalancesEditPanelController;c&&d?f=LeaveTypeBalancesEditPanelController:c?f=PtoBalanceEditPanelController:d&&(f=SickDaysBalanceEditPanelController);LeaveTypeLightBox.prototype.init.call(this,a,b,f);this.isPtoEnabled=c;(this.isUserRatesEnabled=e)&&this.initUserRateField();return this};
LeaveTypeATLightBox.prototype.initUserRateField=function(){var a=this;this.rateCoeffFieldEl=this.getElementBySubId("rateCoefficient");this.rateCoeffField=new DecimalField(this.rateCoeffFieldEl,!0,5,2,this.numberSettings.decimalSeparator,!1,this.numberSettings.digitGroupingSymbol,void 0,!0,this.numberSettings.rateMaxNumber);this.rateCoeffFieldEl.onblur=function(){a.checkRateCoeffOnChange();var b=a.rateCoeffField.getValueAsNumber();b!=a.rateCoeffOldValue&&(a.rateCoeffOldValue=b,a.changesCallback())};
this.rateCoeffInvalidErrorEl=this.getElementBySubId("rateCoeffInvalidError");this.rateCoeffInvalidErrorEl.innerHTML=messageResource.getEscapedMessage("leave_type.error.invalid_rate_coefficient",[this.numberSettings.decimalSeparator,this.numberSettings.rateMaxNumber])};LeaveTypeATLightBox.prototype.setRateCoeffFieldValue=function(a){this.rateCoeffField.setValueAsNumber(a);this.rateCoeffOldValue=a};
LeaveTypeATLightBox.prototype.isRateCoeffValid=function(a){return this.isCoeffValid(this.rateCoeffField,this.rateCoeffFieldEl,LeaveTypeLightBox.RATE_COEFF_EMPTY,LeaveTypeLightBox.RATE_COEFF_INVALID,a)};LeaveTypeATLightBox.prototype.checkRateCoeffOnChange=function(){this.isRateCoeffValid(!0);this.updateErrors(!1)};LeaveTypeATLightBox.prototype.initAsCreatePopup=function(){LeaveTypeLightBox.prototype.initAsCreatePopup.call(this);this.isUserRatesEnabled&&this.setRateCoeffFieldValue(LeaveTypeATLightBox.CREATE_POPUP_DEFAULT_RATE_COEFF)};
LeaveTypeATLightBox.prototype.performSpecificCheck=function(){return(!this.isPtoEnabled||(this.balancesEditPanel.isAsPTOChecked()?!this.balancesEditPanel.checkEmpty()&&this.balancesEditPanel.validate():1))&(!this.isUserRatesEnabled||this.isRateCoeffValid(!1))};
LeaveTypeATLightBox.prototype.getDataToCommit=function(){return[{id:this.leaveTypeId,name:this.getLeaveTypeName(),iconId:this.iconSelector.getIconId(),active:this.getStatus(),balanceType:this.balancesEditPanel.getBalanceType(),balanceCoefficient:this.balancesEditPanel.getBalanceCoefficient(),rateCoefficient:this.isUserRatesEnabled?this.rateCoeffField.getValueAsNumber():null}]};function _UnsupportedHistoryControllerState(){}_UnsupportedHistoryControllerState.prototype.saveState=function(a,b){};_UnsupportedHistoryControllerState.prototype.updateState=function(a,b){};_UnsupportedHistoryControllerState.prototype.getState=function(){return null};function _HistoryControllerState(){}_HistoryControllerState.prototype.init=function(a){window.addEventListener("popstate",a,!0);return this};
_HistoryControllerState.prototype.saveState=function(a,b){b?window.history.pushState(a,"",b):window.history.pushState(a,"")};_HistoryControllerState.prototype.updateState=function(a,b){b?window.history.replaceState(a,"",b):window.history.replaceState(a,"")};_HistoryControllerState.prototype.getState=function(){return window.history.state};function HistoryController(){}
HistoryController.prototype.init=function(a){this.state=this.isSupported()?(new _HistoryControllerState).init(a.onPopstate):new _UnsupportedHistoryControllerState;this.getState()||this.updateState(a.initState);return this};HistoryController.prototype.isSupported=function(){return!!window.history.pushState};HistoryController.prototype.saveState=function(a){this.state.saveState(a,this.url)};HistoryController.prototype.updateState=function(a){this.state.updateState(a,this.url)};
HistoryController.prototype.setUrlParam=function(a,b){this.url=window.location.pathname+b;this.updateState(a)};HistoryController.prototype.getState=function(){this.url||(this.url=window.location.href);var a=this.state.getState();a&&this.updateState(a);return a};function InvoiceReportMediator(){this.constructor=InvoiceReportMediator}InvoiceReportMediator.prototype=new OldReportMediator;InvoiceReportMediator.prototype.init=function(a){OldReportMediator.prototype.init.call(this,a);registerChangeHandlers();var b=this;this.exportEnabled=!1;this.exportToPDFButton=$("#createPDFInvoiceButton");this.exportToPDFButton.click(function(){b.exportInvoiceToPDF()});setExitHandler(function(){return b.isFieldsChanged()});return this};
InvoiceReportMediator.prototype.getReportType=function(){return ReportType.INVOICING};InvoiceReportMediator.prototype.isFieldsChanged=function(){return this.fieldsWasChanged};InvoiceReportMediator.prototype.initEditConfigController=function(a){var b=this;return(new InvoiceEditResultConfigController).init({reportParameters:a.reportParameters,cpList:a.cpList,customersWithMaIds:a.customersWithMaIds,projectsWithMaIds:a.projectsWithMaIds,changeCallback:function(){b.changeParametersCallback()}})};
InvoiceReportMediator.prototype.exportInvoiceToPDF=function(){this.exportEnabled&&submitForm(!0,this.reportConfigId)&&this.setChangesFieldDetected(!1)};InvoiceReportMediator.prototype.onDateRangeChanged=function(){this.restoreDateRangeSelector||this.validateFieldsAndConfirmation()?this.restoreDateRangeSelector?this.restoreDateRangeSelector=!1:ReportMediator.prototype.onDateRangeChanged.call(this):(this.restoreDateRangeSelector=!0,this.dateRangeSelector.setSelectedRangeJSON(this.reportParameters))};
InvoiceReportMediator.prototype.registerFieldsWasChanged=function(){this.registerChanges();this.setChangesFieldDetected(!0)};InvoiceReportMediator.prototype.editConfigApplied=function(){ReportMediator.prototype.editConfigApplied.call(this,$.proxy(this.validateFieldsAndConfirmation,this))};InvoiceReportMediator.prototype.setChangesFieldDetected=function(a){this.fieldsWasChanged=a;setChangesDetected(a)};
InvoiceReportMediator.prototype._resetReport=function(a){if(this.validateFieldsAndConfirmation())return ReportMediator.prototype._resetReport.call(this,a)};InvoiceReportMediator.prototype.commonSuccessSaveHandler=function(a){this.setChangesFieldDetected(!1);ReportMediator.prototype.commonSuccessSaveHandler.call(this,a)};InvoiceReportMediator.prototype.validateFieldsAndConfirmation=function(){return!this.isFieldsChanged()||confirm(this.getConfitmThatDataWasChanged())};
ReportMediator.prototype.onReportLoadingError=function(){this.saveConfigControl.disableEditConfig()};InvoiceReportMediator.prototype.updateInvoiceReportPageAfterReportGeneration=function(a,b,c,d,e,f){init(a,b,c,d,e,f)};InvoiceReportMediator.prototype.getConstructorSaveManager=function(){return new InvoiceSaveReportManager};InvoiceReportMediator.prototype.getConfitmThatDataWasChanged=function(){return messageResource.getMessage("report.common.lost_modifications")};
InvoiceReportMediator.prototype.generateReport=function(a){var b=this;this.exportToPDFButton.addClass("disabled");this.exportEnabled=!1;this.baseGenerateReport(a,function(){b.exportToPDFButton.removeClass("disabled");b.exportEnabled=!0;b.saveConfigControl.enableEditConfig()});this.setChangesFieldDetected(!1)};InvoiceReportMediator.prototype.generateReportFromHistory=function(){this.validateFieldsAndConfirmation()&&ReportMediator.prototype.generateReportFromHistory.call(this)};
InvoiceReportMediator.prototype._createPrintableHeaders=function(){};InvoiceReportMediator.prototype._createPrintableDateRangeHeader=function(){};var ATReportsStore={userGroupsEnabled:!1,timeZoneGroupsEnabled:!1,visibleUsers:null,userGroups:null,timeZoneGroups:null,cpList:null,manageableUserIds:[],projectsWithMaIds:[],reportAuthorizationInfo:{},setReportAuthorizationInfo:function(a){this.reportAuthorizationInfo=a},getReportAuthorizationInfo:function(){return this.reportAuthorizationInfo},setManageableUserIds:function(a){this.manageableUserIds=a},getManageableUserIds:function(){return this.manageableUserIds},setProjectsWithMaIds:function(a){this.projectsWithMaIds=
a},getProjectsWithMaIds:function(){return this.projectsWithMaIds},getCPList:function(){return this.cpList},setCPList:function(a){this.cpList=a},getVisibleUsers:function(){return this.visibleUsers},getUserGroups:function(){return this.userGroups},getTimeZoneGroups:function(){return this.timeZoneGroups},setVisibleUsers:function(a){this.visibleUsers=a},setUserGroups:function(a){this.userGroups=a},setTimeZoneGroups:function(a){this.timeZoneGroups=a},getUserGroupsEnabled:function(){return EnabledFeatures.UGR},
getTimeZoneGroupsEnabled:function(){return EnabledFeatures.TZG}};function EVAReport(){};EVAReport.Store={reportData:null,usersMap:null,projectsMap:null,projectNamesMap:null,taskNamesMap:null,tasksMap:null,customersMap:null,reportParams:null,groupingLevels:null,typesOfWorkMap:null,timeFormat:null,convertedData:null,groupingPresentationFlags:null,generatedPDF:null,fileName:"file.pdf",printParametersForSave:{paperOrientation:"PORTRAIT",paperSize:"A4",showHeaderOnEachPage:!1,showLogoInHeader:!0},printParametersForGenerate:null,setConvertedData:function(a){this.convertedData=a},getConvertedData:function(){return this.convertedData},
setGroupingPresentationFlags:function(a){this.groupingPresentationFlags=a},getGroupingPresentationFlags:function(){return this.groupingPresentationFlags},getGeneratedPDF:function(){return this.generatedPDF},setGeneratedPDF:function(a){this.generatedPDF=a;$(this).trigger("generatedPDFChange")},getPDFFileName:function(){return this.fileName},setPDFFileName:function(a){this.fileName=a},getPrintParametersForSave:function(){return this.printParametersForSave},setPrintParametersForSave:function(a){this.printParametersForSave=
a;$(this).trigger("printParametersForSaveChange")},getPrintParametersForGenerate:function(){return this.printParametersForGenerate},setPrintParametersForGenerate:function(a){this.printParametersForGenerate=a},getGroupingLevels:function(){return this.groupingLevels},setReportData:function(a,b,c,d,e,f,g,h){this.reportData=a;this.customersMap=b;this.projectsMap=c;this.tasksMap=d;this.projectNamesMap=f;this.taskNamesMap=g;this.usersMap=e;this.typesOfWorkMap=h},getCustomers:function(){return this.customersMap},
getProjects:function(){return this.projectsMap},getTasks:function(){return this.tasksMap},getProjectNames:function(){return this.projectNamesMap},getTaskNames:function(){return this.taskNamesMap},getUsers:function(){return this.usersMap},getTypesOfWork:function(){return this.typesOfWorkMap},getTypeOfWork:function(a){return this.typesOfWorkMap[a]},getCustomer:function(a){return this.customersMap[a]},getTask:function(a){return this.tasksMap[a]},getTaskName:function(a){return this.taskNamesMap[a]},getUser:function(a){return this.usersMap[a]},
getProject:function(a){return this.projectsMap[a]},getProjectName:function(a){return this.projectNamesMap[a]},getReportData:function(){return this.reportData},getReportParams:function(){return this.reportParams},getTimeFormat:function(){return this.timeFormat},setReportParams:function(a){this.reportParams=a;this.timeFormat=a.timeFormat;var b=[];b.push(a.firstGroupingLevel);b.push(a.secondGroupingLevel);b.push(a.thirdGroupingLevel);b.push(a.fourthGroupingLevel);this.groupingLevels=b}};function EVACSVJsonConverter(){}
EVACSVJsonConverter.prototype=_.create(BaseCSVJsonConverter.prototype,{init:function(a,b,c,d,e,f,g,h,k,m){BaseCSVJsonConverter.prototype.init.call(this);this.customersMap=a;this.customers=_.values(a);this.projectsMap=b;this.projects=_.values(b);this.tasksMap=c;this.usersMap=d;this.projectNamesMap=e;this.taskNamesMap=f;this.typesOfWorkMap=g;this.printableHeadersBuilder=h;this.groupingPresentationFlags=k;this.store=m;return this},addGroupingInfo:function(a,b,c){a==ReportGroupingLevel.PROJECT?c.Project=
EVAReport.FormatUtils.formatProject(b,this.groupingPresentationFlags):a==ReportGroupingLevel.TASK?c.Task=EVAReport.FormatUtils.formatTask(b,this.groupingPresentationFlags,!0):GroupingUtils.addGroupingInfo(a,b,c)},addDataToTable:function(a,b){b.totalSpentTime=this.formatTime(a.totalSpentTime);this.includeNotEstimated&&(b.spentTimeForNotEstimated=this.formatTime(a.spentTimeForNotEstimated),b.spentTimeForEstimated=this.formatTime(a.spentTimeForEstimated));var c=null!=a.estimatedTime&&1E-4>a.estimatedTime;
b.estimatedTime=this.formatTime(a.estimatedTime);b.varianceTime=this.formatVarianceTime(a.varianceTime);b.varianceTimeInPercentage=this.formatVariancePercent(c?null:a.varianceTimeInPercentage)},addOtherColumnNames:function(a,b,c,d){b.push("totalSpentTime");a.totalSpentTime=messageResource.getMessage("report.budgeted_vs_actual.spent_time.total");this.includeNotEstimated&&(b.push("spentTimeForNotEstimated"),a.spentTimeForNotEstimated=messageResource.getMessage("report.budgeted_vs_actual.spent_time.nonbudgeted"),
b.push("spentTimeForEstimated"),a.spentTimeForEstimated=messageResource.getMessage("report.budgeted_vs_actual.spent_time.budgeted"));b.push("estimatedTime");a.estimatedTime=messageResource.getMessage("report.budgeted_vs_actual.budgeted");b.push("varianceTime");a.varianceTime="Variance (mh)";b.push("varianceTimeInPercentage");a.varianceTimeInPercentage="Variance (%)"},getIdentity:function(a,b){switch(b){case ReportGroupingLevel.USER:return this.usersMap[a.id];case ReportGroupingLevel.CUSTOMER:return this.customersMap[a.id];
case ReportGroupingLevel.PROJECT:return this.store?this.store.getProject(a.id):this.projectsMap[a.id];case ReportGroupingLevel.TASK:return this.tasksMap[a.id];case ReportGroupingLevel.BILLING_TYPE:return this.typesOfWorkMap[a.id];case ReportGroupingLevel.TASK_NAME:return this.taskNamesMap[a.id];case ReportGroupingLevel.PROJECT_NAME:return this.projectNamesMap[a.id]}return a.id},preprocess:function(a,b){this.includeNotEstimated=a.includeNotEstimated;this.date=a.dateSelection},processParamsBuilder:function(a,
b,c){c=new ATReportParamsStringBuilder({data:{cpList:ATReportsStore.getCPList(),projectsWithMaIds:ATReportsStore.getProjectsWithMaIds()}});var d={tasksConfig:b.tasksConfig,includeNotEstimated:!!b.includeNotEstimated,includeNotStarted:!!b.includeNotStarted};a.addCPParam(b.customersProjectsSelection,c);a.addEvATasksParam(d,b.dateSelection,c);a.parameters.push([messageResource.getMessage("report.budgeted_vs_actual.date_label"),c.getEvaDateCSVString(b.dateSelection)])},formatTime:function(a){return null==
a?"":ConverterFormatUtils.numberFormatter.format(a/60)},formatVarianceTime:function(a){return null==a?"":ConverterFormatUtils.varianceNumberFormatter.format(a/60)},formatVariancePercent:function(a){return null==a?"":ConverterFormatUtils.varianceNumberFormatter.format(a)+"%"},generateCSVName:function(a){var b=[],c=new DateFormat(SystemSettings.dateFormat);b.push(c.formatDate(new Date(a.dateSelection.date)));a=messageResource.getMessage("common.eva.reports.csv.file_name",b);isOldIE()&&(a=a.replace(/\//g,
"_"));return a},convertTotal:function(a,b){var c=[];this.generateTableHeader(b,a,{},c);var d={};this.addDataToTable(b,d);c[0]="Total";d.Total="Total:";return{columns:c,table:[{},d]}},getJsons:function(a,b){return[this.convertTitle(a),this.convertLinearTable(a,b),this.convertTotal(a,b)]}});EVAReport.FormatUtils=_.create(BaseReportFormatUtils,{});EVAReport.ConvertUtils={getGroupingLevels:function(a){return[a.firstGroupingLevel,a.secondGroupingLevel,a.thirdGroupingLevel,a.fourthGroupingLevel]},getGroupingType:function(a,b){var c=this.getGroupingIndex(a,b);return null!=c?b[c]:null},getGroupingIndex:function(a,b){for(var c=function(a,b){for(;a<b.length&&b[a]==ReportGroupingLevel.NONE;)a++;return a},d=c(0,b);d<b.length&&0<a;)d=c(d+1,b),a--;return d<b.length?d:null},getGroupingLevelsCollapsed:function(a){return _.filter(a,function(a){return a!=
ReportGroupingLevel.NONE})}};EVAReport.Table=function(a,b){TemplateView.call(this,a);this.store=b};
EVAReport.Table.prototype=_.create(TemplateView.prototype,{html:"<table class='display-for-print report-table' border='0' cellpadding='4' id='report-table'></table>",updateOnInit:!1,update:function(){var a=this.store.getReportData(),b=this.store.getReportParams();EVAReport.Store.setConvertedData((new EVAReportTableDataConverter(a,b)).convert());EVAReport.Store.setGroupingPresentationFlags(EVAReport.FormatUtils.makeGroupingPresentationFlags(this.store.getGroupingLevels()));a=EVAReport.Store.getConvertedData();
this.$el.empty();this.rowInsertProcessor&&this.rowInsertProcessor.pause();this.rowInsertProcessor=(new ChunkIterator(a,20,function(a){var d=_.clone(a),e=b.includeNotEstimated,f=this.store;switch(a.type){case RowType.HEADER:e?(new EVAReport.Table.HeaderRowFull(this.$el,f.getGroupingLevels())).init():(new EVAReport.Table.HeaderRowParticle(this.$el,f.getGroupingLevels())).init();break;case RowType.TOTALS:(new EVAReport.Table.DataRow(this.$el,d,f,e,"root")).init();break;case RowType.FIRST_LEVEL:(new EVAReport.Table.DataRow(this.$el,
d,f,e,"level1")).init();break;case RowType.SECOND_LEVEL:(new EVAReport.Table.DataRow(this.$el,d,f,e,"level2")).init();break;case RowType.THIRD_LEVEL:(new EVAReport.Table.DataRow(this.$el,d,f,e,"level3")).init();break;case RowType.FORTH_LEVEL:(new EVAReport.Table.DataRow(this.$el,d,f,e,"details")).init()}},this)).start()}});EVAReport.Table.DataRow=function(a,b,c,d,e){TemplateView.call(this,a);this.config=b;this.store=c;this.includeNotEstimated=d;this.levelClass=e};
EVAReport.Table.DataRow.prototype=_.create(TemplateView.prototype,{html:"<tr class='dataRow <%=rowClass%>' >  <td class='titleCell <%=levelShift%>'>    <div style='width:99%'>      <div style='float: left'><%-title%></div>      <div class='<%=noteStyles%>' style='float:right; white-space: nowrap; padding-left: 5px' align='right'><%=titleNote%></div>    </div>  </td>  <td class='totalSpentCell' style='padding-left: 4px'><%=totalSpent%></td>  <td class='timeNotEstimateCell' style='padding-left: 4px'><%=timeNotEstimate%></td>  <td class='estimate totalSpent' style='padding-left: 4px'><%=estimateTotalSpentTime%></td>  <td class='estimate estimatedTime' style='padding-left: 4px'><%=estimatedTime%></td>  <td class='estimate varianceHour' style='padding-left: 4px'><%=varianceHour%></td>  <td class='estimate variancePercentage' style='padding-left: 4px'><%=variancePercent%></td></tr>",afterRender:function(){this.includeNotEstimated||
($(".totalSpentCell").hide(),$(".timeNotEstimateCell").hide())},templateModel:function(){var a=this.config,b=this.store.getTimeFormat(),b={title:this.title(a.id,a.type,a.groupingType),noteStyles:this.noteStyles(a.id,a.groupingType),titleNote:this.titleNoteCell(a.id,a.type,a.groupingType),totalSpent:this.createTypeCell(a.totalSpentTime,EVAReport.Table.DataRow.CellType.TIME,b),timeNotEstimate:this.createTypeCell(a.spentTimeForNotEstimated,EVAReport.Table.DataRow.CellType.TIME,b),estimateTotalSpentTime:this.createTypeCell(a.spentTimeForEstimated,
EVAReport.Table.DataRow.CellType.TIME,b),estimatedTime:this.createTypeCell(a.estimatedTime,EVAReport.Table.DataRow.CellType.TIME,b),varianceHour:this.createTypeCell(a.varianceTime,EVAReport.Table.DataRow.CellType.TIME,b),variancePercent:this.createTypeCell(a.varianceTimeInPercentage,EVAReport.Table.DataRow.CellType.PERCENT,b),rowClass:"new_report_"+this.levelClass+"_row",levelShift:"new_report_real_level"+a.level},c=this.createCell("-",""),d=this.createCell("-",this.stylesForCell(-1)),e=this.createCell("",
"");switch(a.groupingType){case ReportGroupingLevel.USER:b.varianceHour=e;b.variancePercent=e;b.estimatedTime=e;_.isUndefined(a.spentTimeForEstimated)&&(b.estimateTotalSpentTime=c);_.isUndefined(a.spentTimeForNotEstimated)&&(b.timeNotEstimate=c);break;case ReportGroupingLevel.TASK:EVAReport.Store.getTask(a.id).estimated||(b.estimatedTime=this.createCell(messageResource.getMessage("report.budgeted_vs_actual.not_budgeted"),"time not_budgeted"),b.varianceHour=c,b.variancePercent=c,b.estimateTotalSpentTime=
c);_.isUndefined(a.spentTimeForEstimated)&&(b.estimateTotalSpentTime=c);_.isUndefined(a.spentTimeForNotEstimated)&&(b.timeNotEstimate=c);break;case ReportGroupingLevel.PROJECT:case ReportGroupingLevel.CUSTOMER:case ReportGroupingLevel.TASK_NAME:case ReportGroupingLevel.PROJECT_NAME:case ReportGroupingLevel.BILLING_TYPE:_.isUndefined(a.estimatedTime)&&(b.estimatedTime=c,b.variancePercent=c,b.varianceHour=c)}a.groupingType!=ReportGroupingLevel.USER&&1E-4>a.estimatedTime&&(b.variancePercent=c,b.variancePercent=
d);return b},createTypeCell:function(a,b,c){return this.createCell(this.formatValue(a,b,c),this.stylesForCell(a,b))},formatValue:function(a,b,c){var d;switch(b){case EVAReport.Table.DataRow.CellType.TIME:d=EVAReport.FormatUtils.formatPureTime(a,c);break;case EVAReport.Table.DataRow.CellType.PERCENT:d=EVAReport.FormatUtils.formatPercent(a)}return d},stylesForCell:function(a,b){return b+(0>a?" negative_value":"")},createCell:function(a,b){return"<div align='right' class='"+b+"'><nobr>"+a+"</nobr></div>"},
noteStyles:function(a,b){return b!=ReportGroupingLevel.TASK||EVAReport.Store.getTask(a).estimated?"":"smalltext"},titleNoteCell:function(a,b,c){return b==RowType.TOTALS?messageResource.getMessage("report.total"):c!=ReportGroupingLevel.TASK||EVAReport.Store.getTask(a).estimated?"":messageResource.getEscapedMessage("report.budgeted_vs_actual.not_estimated_note")},title:function(a,b,c){return b==RowType.TOTALS?"":EVAReport.FormatUtils.getGroupingLevelTitle(c,a,this.store)}});
EVAReport.Table.DataRow.CellType={TIME:"time",PERCENT:"percent"};EVAReport.Table.HeaderRowFull=function(a,b){TemplateView.call(this,a);this.groupingLevels=b};
EVAReport.Table.HeaderRowFull.prototype=_.create(TemplateView.prototype,{html:"<tr class='new_report_header'>  <td rowspan='3' colspan='1'>     <span class='groupingLevel1'><%-firstLevelName%></span>     <span class='separatorGroupingLevel2'>/</span>     <span class='groupingLevel2'><%-secondLevelName%></span>     <span class='separatorGroupingLevel3'>/</span>     <span class='groupingLevel3'><%-thirdLevelName%></span>     <span class='separatorGroupingLevel4'>/</span>     <span class='groupingLevel4'><%-fourthLevelName%></span>  </td>  <td class='data_column_header timeSpentColumn' rowspan='3'><%-timeSpent%></td>  <td class='data_column_header timeForNotEstimateColumn' rowspan='3'><%-timeForNotEstimate%></td>  <td class='data_column_superheader' rowspan='1' colspan='4'><%-estimatedTasks%></td></tr><tr class='new_report_header'>    <td rowspan='2' class='data_column_header subheader' valign='middle' style='padding-top:6px'><%-spentTime%></td>    <td rowspan='2' class='data_column_header subheader' valign='middle' style='padding-top:6px'><%-estimatedTime%></td>    <td colspan='2' class='data_column_superheader subheader' nowrap=''>        <%-variance%><br><span class='header_note'>(<%-estimatedMinusSpent%>)</span>    </td></tr><tr class='new_report_header'>    <td class='data_column_header subheader' style='font-size:10px;padding:2px'><%-mh%></td>    <td class='data_column_header subheader' style='font-size:10px;padding:2px' ><%-percent%></td></tr>",messageKeys:function(){return{mh:"report.budgeted_vs_actual.variance.mh",
percent:"report.budgeted_vs_actual.variance.percent",spentTime:"report.budgeted_vs_actual.spent_time",estimatedTime:"report.budgeted_vs_actual.budgeted",variance:"report.budgeted_vs_actual.variance",estimatedMinusSpent:"report.budgeted_vs_actual.budgeted_minus_spent",timeSpent:"report.budgeted_vs_actual.spent_time.total",timeForNotEstimate:"report.budgeted_vs_actual.spent_time.nonbudgeted",estimatedTasks:"report.budgeted_vs_actual.spent.budgeted_tasks"}},templateModel:function(){return{firstLevelName:EVAReport.FormatUtils.formatGroupingLevel(this.groupingLevels[0]),
secondLevelName:EVAReport.FormatUtils.formatGroupingLevel(this.groupingLevels[1]),thirdLevelName:EVAReport.FormatUtils.formatGroupingLevel(this.groupingLevels[2]),fourthLevelName:EVAReport.FormatUtils.formatGroupingLevel(this.groupingLevels[3])}},afterRender:function(){this.groupingLevels[1]==ReportGroupingLevel.NONE&&($(".separatorGroupingLevel2").hide(),$(".groupingLevel2").hide());this.groupingLevels[2]==ReportGroupingLevel.NONE&&($(".separatorGroupingLevel3").hide(),$(".groupingLevel3").hide());
this.groupingLevels[3]==ReportGroupingLevel.NONE&&($(".separatorGroupingLevel4").hide(),$(".groupingLevel4").hide())}});EVAReport.Table.HeaderRowParticle=function(a,b){TemplateView.call(this,a);this.groupingLevels=b};
EVAReport.Table.HeaderRowParticle.prototype=_.create(TemplateView.prototype,{html:"<tr class='new_report_header'>   <td rowspan='2' colspan='1' class='firstCell'>     <span class='groupingLevel1'><%-firstLevelName%></span>     <span class='separatorGroupingLevel2'>/</span>     <span class='groupingLevel2'><%-secondLevelName%></span>     <span class='separatorGroupingLevel3'>/</span>     <span class='groupingLevel3'><%-thirdLevelName%></span>     <span class='separatorGroupingLevel4'>/</span>     <span class='groupingLevel4'><%-fourthLevelName%></span>   </td>   <td rowspan='2' class='data_column_header'><%-spentTime%></td>   <td rowspan='2' class='data_column_header'><%-estimatedTime%></td>   <td colspan='2' class='data_column_superheader' nowrap=''>      <%-variance%><br><span class='header_note'>(<%-estimatedMinusSpent%>)</span>   </td></tr><tr class='new_report_header bottom'>    <td class='data_column_header'><%-mh%></td>    <td class='data_column_header'><%-percent%></td></tr>",messageKeys:function(){return{mh:"report.budgeted_vs_actual.variance.mh",
percent:"report.budgeted_vs_actual.variance.percent",spentTime:"report.budgeted_vs_actual.spent_time",estimatedTime:"report.budgeted_vs_actual.budgeted",variance:"report.budgeted_vs_actual.variance",estimatedMinusSpent:"report.budgeted_vs_actual.budgeted_minus_spent",timeSpent:"report.budgeted_vs_actual.spent_time.total",timeForNotEstimate:"report.budgeted_vs_actual.spent_time.nonbudgeted",estimatedTasks:"report.budgeted_vs_actual.spent.budgeted_tasks"}},templateModel:function(){return{firstLevelName:EVAReport.FormatUtils.formatGroupingLevel(this.groupingLevels[0]),
secondLevelName:EVAReport.FormatUtils.formatGroupingLevel(this.groupingLevels[1]),thirdLevelName:EVAReport.FormatUtils.formatGroupingLevel(this.groupingLevels[2]),fourthLevelName:EVAReport.FormatUtils.formatGroupingLevel(this.groupingLevels[3])}},afterRender:function(){this.groupingLevels[1]==ReportGroupingLevel.NONE&&($(".separatorGroupingLevel2").hide(),$(".groupingLevel2").hide());this.groupingLevels[2]==ReportGroupingLevel.NONE&&($(".separatorGroupingLevel3").hide(),$(".groupingLevel3").hide());
this.groupingLevels[3]==ReportGroupingLevel.NONE&&($(".separatorGroupingLevel4").hide(),$(".groupingLevel4").hide())}});function OvertimeReport(){};OvertimeReport.Table=function(a,b){TemplateView.call(this,a);this.store=b};
OvertimeReport.Table.prototype=_.create(TemplateView.prototype,{html:"<table class='overtimeReportTable display-for-print' cellspacing='0' cellpadding='0'></table>",updateOnInit:!1,update:function(){var a=this.store.getReportData(),b=this.store.getReportParams(),a=(new OvertimeReportTableDataConverter(a,b)).convert();this.store.setConvertedData(a);this.cancelRendering();this.$el.empty();this.rowInsertProcessor=(new ChunkIterator(a,20,function(a){switch(a.type){case RowType.HEADER:(new OvertimeReport.Table.HeaderRow(this.$el,
b.firstGroupingLevel,b.secondGroupingLevel,a.hasTimeBalance,a.hasOvertime,b.showWorkingAndLeaveTime)).init();break;case RowType.TOTALS:(new OvertimeReport.Table.TotalsRow(this.$el,this.store,a,b.timeFormat)).init();break;case RowType.FIRST_LEVEL:(new OvertimeReport.Table.FirstLevelRow(this.$el,this.store,b.firstGroupingLevel,a.identity,a,b.timeFormat)).init();break;case RowType.SECOND_LEVEL:(new OvertimeReport.Table.SecondLevelRow(this.$el,this.store,b.secondGroupingLevel,a.identity,a,b.timeFormat)).init()}},
this)).start();this.$el.toggleClass("noSecondGroupingLevel",!b.secondGroupingLevel||b.secondGroupingLevel===ReportGroupingLevel.NONE);this.$el.toggleClass("onlyOneColumnGroup",b.columnsConfig!==ColumnsConfig.TIME_BALANCE_AND_OVERTIME)},cancelRendering:function(){this.rowInsertProcessor&&this.rowInsertProcessor.pause()}});OvertimeReport.Table.HeaderRow=function(a,b,c,d,e,f){TemplateView.call(this,a);this.firstGroupingLevel=b;this.secondGroupingLevel=c;this.hasTimeBalance=d;this.hasOvertime=e;this.showWorkingAndLeaveTime=f};
OvertimeReport.Table.HeaderRow.prototype=_.create(TemplateView.prototype,{html:"<tr class='headerRow top'>  <td class='listtblcolheader firstCell' rowspan='2'><%-firstLevelName%><span class='secondLevel'> / <%-secondLevelName%></span></td></tr><tr class='headerRow bottom'></tr>",afterRender:function(){this.$topRow=this.$el.eq(0);this.$bottomRow=this.$el.eq(1);this.hasTimeBalance&&this._addTimeBalance(this.showWorkingAndLeaveTime);this.hasOvertime&&this._addOvertime()},templateModel:function(){return{firstLevelName:OvertimeReportFormatUtils.formatGroupingLevel(this.firstGroupingLevel),
secondLevelName:OvertimeReportFormatUtils.formatGroupingLevel(this.secondGroupingLevel)}},_addTimeBalance:function(a){this.$topRow.append("<td class='separator' rowspan='2'></td>");(new OvertimeReport.Table.HeaderRow.TimeBalanceCellTop(this.$topRow,a)).init();a?(new OvertimeReport.Table.HeaderRow.TimeBalanceCellBottomFull(this.$bottomRow)).init():(new OvertimeReport.Table.HeaderRow.TimeBalanceCellBottomParticle(this.$bottomRow)).init()},_addOvertime:function(){this.$topRow.append("<td class='separator' rowspan='2'></td>");
(new OvertimeReport.Table.HeaderRow.OvertimeCellTop(this.$topRow)).init();(new OvertimeReport.Table.HeaderRow.OvertimeCellBottom(this.$bottomRow)).init()}});OvertimeReport.Table.HeaderRow.OvertimeCellBottom=function(a){TemplateView.call(this,a)};OvertimeReport.Table.HeaderRow.OvertimeCellBottom.prototype=_.create(TemplateView.prototype,{html:"<td class='listtblcolheader'><%=reported%><span class='asterisk'>*</span></td><td class='listtblcolheader'><%=auto%><span class='asterisk'>**</span></td>",messageKeys:function(){return{reported:"report.overtime.overtime.reported_by_user",auto:"report.overtime.overtime.auto_calculated"}}});OvertimeReport.Table.HeaderRow.OvertimeCellTop=function(a){TemplateView.call(this,a)};OvertimeReport.Table.HeaderRow.OvertimeCellTop.prototype=_.create(TemplateView.prototype,{html:"<td class='listtblcolheader' colspan='2'><%=title%></td>",messageKeys:function(){return{title:"report.overtime.overtime"}}});OvertimeReport.Table.HeaderRow.TimeBalanceCellBottomFull=function(a){TemplateView.call(this,a)};
OvertimeReport.Table.HeaderRow.TimeBalanceCellBottomFull.prototype=_.create(TemplateView.prototype,{html:"<td class='listtblcolheader'><%=scheduled%></td><td class='listtblcolheader'><%=reported%></td><td class='listtblcolheadersmallnormal withoutBorderLeft'><%=working%></td><td class='listtblcolheadersmallnormal withoutBorderLeft'><%=leave%></td><td class='listtblcolheader'><%=difference%></td>",messageKeys:function(){return{scheduled:"report.overtime.time_balance.scheduled",reported:"report.overtime.time_balance.total_reported",
difference:"report.overtime.time_balance.difference",working:"report.overtime.time_balance.working_time",leave:"report.overtime.time_balance.leave_time"}}});OvertimeReport.Table.HeaderRow.TimeBalanceCellBottomParticle=function(a){TemplateView.call(this,a)};OvertimeReport.Table.HeaderRow.TimeBalanceCellBottomParticle.prototype=_.create(TemplateView.prototype,{html:"<td class='listtblcolheader'><%=scheduled%></td><td class='listtblcolheader'><%=reported%></td><td class='listtblcolheader'><%=difference%></td>",messageKeys:function(){return{scheduled:"report.overtime.time_balance.scheduled",reported:"report.overtime.time_balance.reported",difference:"report.overtime.time_balance.difference"}}});OvertimeReport.Table.HeaderRow.TimeBalanceCellTop=function(a,b){TemplateView.call(this,a);this.showWorkingAndLeaveTime=b};OvertimeReport.Table.HeaderRow.TimeBalanceCellTop.prototype=_.create(TemplateView.prototype,{html:"<td class='listtblcolheader' colspan='<%=colspan%>'><%=title%></td>",messageKeys:function(){return{title:"report.overtime.time_balance"}},templateModel:function(){return{colspan:this.showWorkingAndLeaveTime?5:3}}});OvertimeReport.Table.DataRow=function(a,b,c,d,e,f,g){TemplateView.call(this,a);this.store=b;this.level=c;this.groupingLevel=d;this.identity=e;this.data=f;this.timeFormat=g};
OvertimeReport.Table.DataRow.prototype=_.create(TemplateView.prototype,{html:"<tr class='dataRow <%=rowClass%>'>  <td class='<%=titleLevelClass%> titleCell'><%-title%><span class='corporateDayOffLabel'> <%=corporateDayOffLabel%></span></td></tr>",afterRender:function(){this.data.hasTimeBalance&&this._addTimeBalance();this.data.hasOvertime&&this._addOvertime();this.groupingLevel==ReportGroupingLevel.DATE&&(this.$el.toggleClass("dayOff",this.store.getDateInfo(this.data.id).dayOff),this.$el.toggleClass("corporateDayOff",
this.store.getDateInfo(this.data.id).corporateDayOff))},templateModel:function(){return{rowClass:this.rowClass(),title:this._title(),titleLevelClass:"reportrow"+this.level,levelClass:"reportrow"+this.level+"num"}},messageKeys:function(){return{corporateDayOffLabel:"common.corporate_day_off_text"}},rowClass:function(){},_title:function(){return OvertimeReportFormatUtils.getGroupingLevelTitle(this.groupingLevel,this.data.id,this.store)},_addTimeBalance:function(){this.$el.append("<td class='separator'></td>");
(new OvertimeReport.Table.TimeCell(this.$el,this.level,this.data.scheduledTime,this.timeFormat)).init();this.store.getReportParams().showWorkingAndLeaveTime?((new OvertimeReport.Table.TimeCell(this.$el,this.level,this.data.reportedTime,this.timeFormat)).init(),(new OvertimeReport.Table.TimeCell(this.$el,this.level,this.data.workingTime,this.timeFormat,!0,"withoutBorderLeft")).init(),(new OvertimeReport.Table.TimeCell(this.$el,this.level,this.data.leaveTime,this.timeFormat,!0,"withoutBorderLeft")).init()):
(new OvertimeReport.Table.ReportedTimeCell(this.$el,this.level,this.data.reportedTime,this.data.workingTime,this.data.leaveTime,this.timeFormat)).init();(new OvertimeReport.Table.DifferenceTimeCell(this.$el,this.level,this.data.differenceTime,this.timeFormat)).init()},_addOvertime:function(){this.$el.append("<td class='separator'></td>");(new OvertimeReport.Table.TimeCell(this.$el,this.level,this.data.reportedOvertime,this.timeFormat)).init();var a=!0;GroupingUtils.hasUserGroupingLevel(BaseReport.ConvertUtils.getGroupingLevels(this.store.getReportParams()))&&
(GroupingUtils.isTimeGrouping(this.groupingLevel)||this.groupingLevel===ReportGroupingLevel.USER)&&(a=this.data.isEmployed);(new OvertimeReport.Table.TimeCell(this.$el,this.level,this.data.autoOvertime,this.timeFormat,a)).init()}});OvertimeReport.Table.TotalsRow=function(a,b,c,d){OvertimeReport.Table.DataRow.call(this,a,b,0,null,null,c,d)};OvertimeReport.Table.TotalsRow.prototype=_.create(OvertimeReport.Table.DataRow.prototype,{rowClass:function(){return"totalsRow"},_title:function(){return messageResource.getMessage("report.total")}});OvertimeReport.Table.FirstLevelRow=function(a,b,c,d,e,f){OvertimeReport.Table.DataRow.call(this,a,b,1,c,d,e,f)};OvertimeReport.Table.FirstLevelRow.prototype=_.create(OvertimeReport.Table.DataRow.prototype,{rowClass:function(){return"firstLevelRow"}});OvertimeReport.Table.SecondLevelRow=function(a,b,c,d,e,f){OvertimeReport.Table.DataRow.call(this,a,b,3,c,d,e,f)};OvertimeReport.Table.SecondLevelRow.prototype=_.create(OvertimeReport.Table.DataRow.prototype,{rowClass:function(){return"secondLevelRow"}});OvertimeReport.Table.TimeCell=function(a,b,c,d,e,f){TemplateView.call(this,a);this.level=b;this.time=c;this.timeFormat=d;this.isEmployed=e;this.className=f};
OvertimeReport.Table.TimeCell.prototype=_.create(TemplateView.prototype,{html:"<td class='<%=levelClass%> <%=notEmployedClass%> <%=className%>'><%-time%></td>",templateModel:function(){return{time:!1===this.isEmployed?messageResource.getMessage("report.overtime.not_employed"):OvertimeReportFormatUtils.formatPureTime(this.time,this.timeFormat),levelClass:"reportrow"+this.level+"num",notEmployedClass:!1===this.isEmployed?"not-employed":"",className:this.className}}});OvertimeReport.Table.DifferenceTimeCell=function(a,b,c,d){TemplateView.call(this,a);this.level=b;this.time=c;this.timeFormat=d};OvertimeReport.Table.DifferenceTimeCell.prototype=_.create(TemplateView.prototype,{html:"<td class='differenceTimeCell <%=levelClass%>'><%-time%></td>",afterRender:function(){0>this.time&&this.$el.addClass("negative")},templateModel:function(){return{time:OvertimeReportFormatUtils.formatDifferenceTime(this.time,this.timeFormat),levelClass:"reportrow"+this.level+"num"}}});OvertimeReport.Table.ReportedTimeCell=function(a,b,c,d,e,f){TemplateView.call(this,a);this.level=b;this.reportedTime=c;this.workingTime=d;this.leaveTime=e;this.timeFormat=f};
OvertimeReport.Table.ReportedTimeCell.prototype=_.create(TemplateView.prototype,{html:"<td class='reportedTimeCell <%=levelClass%>'>  <div class='wrapper'>    <div class='value'><%-time%></div>  </div></td>",afterRender:function(){if(EnabledFeatures.LVT&&null!=this.reportedTime&&0<this.reportedTime){var a=this;this.$el.addClass("withTooltip");var b=OvertimeReport.Table.ReportedTimeTooltip.getInstance(),c=this.find(".wrapper");b.subscribeToMouseEvents(c,function(){b.updateBeforeShow(c,a.workingTime,
a.leaveTime,a.timeFormat)})}},templateModel:function(){return{time:OvertimeReportFormatUtils.formatPureTime(this.reportedTime,this.timeFormat),levelClass:"reportrow"+this.level+"num"}}});OvertimeReport.Table.ReportedTimeTooltip=function(a){Tooltip.call(this,a);this.autoFollowMouseCursor=!1};
OvertimeReport.Table.ReportedTimeTooltip.prototype=_.create(Tooltip.prototype,{html:"<div class='reportedTimeTooltip noprint'>  <div class='workingTime'>    <div class='label'><%=workingTimeLabel%>:</div>    <div class='value'></div>  </div>  <div class='leaveTime'>    <div class='label'><%=leaveTimeLabel%>:</div>    <div class='value'></div>  </div></div>",afterRender:function(){this.$workingTimeValue=this.find(".workingTime .value");this.$leaveTimeValue=this.find(".leaveTime .value")},messageKeys:function(){return{workingTimeLabel:"report.overtime.total_time_track",
leaveTimeLabel:"report.overtime.total_leave_time"}},updateBeforeShow:function(a,b,c,d){var e=a.offset(),f=a.outerWidth();a=a.outerHeight();this.$el.css("top",px(e.top+a+16));this.$el.css("left",px(e.left+(f-180)/2));this.$workingTimeValue.html(OvertimeReportFormatUtils.formatPureTime(b,d));this.$leaveTimeValue.html(OvertimeReportFormatUtils.formatPureTime(c,d));this.$el.toggleClass("workingTimeZero",0===b);this.$el.toggleClass("leaveTimeZero",0===c)}});
OvertimeReport.Table.ReportedTimeTooltip.getInstance=function(){OvertimeReport.Table.ReportedTimeTooltip.instance||(OvertimeReport.Table.ReportedTimeTooltip.instance=(new OvertimeReport.Table.ReportedTimeTooltip($("body"))).init());return OvertimeReport.Table.ReportedTimeTooltip.instance};function OvertimeCSVJsonConverter(){}
OvertimeCSVJsonConverter.prototype=_.create(BaseCSVJsonConverter.prototype,{init:function(a,b){BaseCSVJsonConverter.prototype.init.call(this);this.store=a;this.generalStore=b;this.formatUtils=OvertimeReportFormatUtils;return this},addGroupingInfo:function(a,b,c){GroupingUtils.addGroupingInfo(a,b,c)},addDataToTable:function(a,b){var c=this.store.getReportParams();c.columnsConfig!=ColumnsConfig.OVERTIME_ONLY&&(b.scheduledTimeBalance=this.formatTime(a.scheduled),b.reportedTimeBalance=this.formatTime(a.reported),
c.showWorkingAndLeaveTime&&(b.workingTimeBalance=this.formatTime(a.workingTime),b.leaveTimeBalance=this.formatTime(a.leaveTime)),b.timeBalanceDifference=this.formatTime(a.difference));c.columnsConfig!=ColumnsConfig.TIME_BALANCE_ONLY&&(b.reportedOvertime=this.formatTime(a.reportedOvertime),b.autoOvertime=!1===a.employed?messageResource.getMessage("report.overtime.not_employed"):this.formatTime(a.autoCalculatedOvertime))},addOtherColumnNames:function(a,b,c,d){c.columnsConfig!=ColumnsConfig.OVERTIME_ONLY&&
(b.push("scheduledTimeBalance"),a.scheduledTimeBalance=messageResource.getMessage("report.overtime.csv.time_balance.scheduled"),b.push("reportedTimeBalance"),c.showWorkingAndLeaveTime?(a.reportedTimeBalance=messageResource.getMessage("report.overtime.time_balance.total_reported"),b.push("workingTimeBalance"),a.workingTimeBalance=messageResource.getMessage("report.overtime.time_balance.working_time"),b.push("leaveTimeBalance"),a.leaveTimeBalance=messageResource.getMessage("report.overtime.time_balance.leave_time")):
a.reportedTimeBalance=messageResource.getMessage("report.overtime.csv.time_balance.reported"),b.push("timeBalanceDifference"),a.timeBalanceDifference=messageResource.getMessage("report.overtime.csv.time_balance.difference"));c.columnsConfig!=ColumnsConfig.TIME_BALANCE_ONLY&&(b.push("reportedOvertime"),a.reportedOvertime=messageResource.getMessage("report.overtime.csv.reported_by_user"),b.push("autoOvertime"),a.autoOvertime=messageResource.getMessage("report.overtime.csv.auto_calculated"))},getIdentity:function(a,
b){switch(b){case ReportGroupingLevel.USER:return this.store.getUser([a.id]);case ReportGroupingLevel.USER_GROUP:return this.store.getUserGroup([a.id]);case ReportGroupingLevel.TIME_ZONE_GROUP:return this.store.getTimeZoneGroup([a.id]);case ReportGroupingLevel.DATE:return this.store.getDateInfo([a.id]);case ReportGroupingLevel.WEEK:return this.store.getWeek([a.id]);case ReportGroupingLevel.MONTH:return this.store.getMonth([a.id])}return a.id},processParamsBuilder:function(a,b,c){c=new ATReportParamsStringBuilder({data:{users:this.generalStore.getVisibleUsers(),
userGroups:this.generalStore.getUserGroups(),timeZoneGroups:this.generalStore.getTimeZoneGroups(),manageableUserIds:this.generalStore.getManageableUserIds(),projectsWithMaIds:this.generalStore.getProjectsWithMaIds()},reportAuthorizationInfo:this.generalStore.getReportAuthorizationInfo()});a.addDateRangeParam(b.dateRangeSelection,c);a.addUsersParam(b.userSelection,c)},formatTime:function(a){return null==a?"":ConverterFormatUtils.numberFormatter.format(a/60)},formatVarianceTime:function(a){return null==
a?"":ConverterFormatUtils.varianceNumberFormatter.format(a/60)},generateCSVName:function(a){var b=[],c=new DateFormat(SystemSettings.dateFormat);b.push(c.formatDate(a.dateRangeSelection.fromDate));b.push(c.formatDate(a.dateRangeSelection.toDate));a=messageResource.getMessage(EnabledFeatures.OVR?"overtime_report.csv.file_name.time_and_overtime":"overtime_report.csv.file_name.time_only",b);isOldIE()&&(a=a.replace(/\//g,"_"));return a},convertTotal:function(a,b){var c=[];this.generateTableHeader(b,a,
{},c);var d={};this.addDataToTable(b,d,a);c[0]="Total";d.Total="Total:";return{columns:c,table:[{},d]}},getJsons:function(a,b){return[this.convertTitle(a),this.convertLinearTable(a,b),this.convertTotal(a,b)]}});Ext.namespace("AT.menu");AT.menu.CategoryItem=Ext.extend(Ext.menu.Item,{additionalCls:"",baseCls:"categoryItem",canActivate:!1,initComponent:function(){this.cls=this.baseCls+" "+this.additionalCls;AT.menu.CategoryItem.superclass.initComponent.call(this)},onClick:function(a){a.stopEvent()}});Ext.namespace("AT");
AT.CreateReportButton=Ext.extend(Ext.Container,{buttonText:"",createConfigCallback:Ext.emptyFn,menuCategories:[],autoEl:"div",layout:"table",buttonClass:"graphicButton button createNewReportButton",dropdownControlClass:"graphicButton dropdownButton createReportDropdownButton",menuCls:"createReportControlMenu",menuItems:[],menu:null,menuShown:!1,hideOnResize:!1,initComponent:function(){AT.CreateReportButton.superclass.initComponent.call(this);this.createMenu();0==this.menuItems.length&&(this.buttonClass+=
" withoutMenu",this.dropdownControlClass+=" hidden");this.baseButton=this.getBaseButton();this.dropdownButton=this.getDropdownButton();this.add(this.baseButton.button);this.add(this.dropdownButton.button)},createMenu:function(){this.menuItems=[];for(var a=0;a<this.menuCategories.length;a++)addAll(this.menuItems,this.menuCategories[a].createMenuItems());this.menu=new Ext.menu.Menu({cls:this.menuCls,items:this.menuItems});this.menu.on("show",this.menuShownHandler,this);this.menu.on("hide",this.menuHidden,
this)},menuShownHandler:function(){if(this.hideOnResize&&!this.resizeHandlerSet){var a=this;doOnceOnWindowResize(function(){a.menu.hide();a.resizeHandlerSet=!1});this.resizeHandlerSet=!0}},menuHidden:function(){this.dropdownButton.deactivate();this.menuShown=!1;this.mouseOut()},toggleMenu:function(){(this.menuShown=!this.menuShown)?(this.dropdownButton.activate(),this.menu.show(this.el.child("table:first"),"tl-bl",null)):(this.dropdownButton.deactivate(),this.menu.hide())},mouseOver:function(){this.baseButton.hover();
this.dropdownButton.hover()},mouseOut:function(){this.menuShown||this.dropdownButton.unhover();this.baseButton.reset()},afterRender:function(){this.baseButton.button.on("render",function(){this.baseButton.defineStandardEventHandlers(!1,!1,!0,!0);this.baseButton.button.el.on("mouseover",this.mouseOver,this);this.baseButton.button.el.on("mouseout",this.mouseOut,this);this.baseButton.button.el.on("click",this.baseButtonClick,this)},this);this.dropdownButton.button.on("render",function(){this.dropdownButton.button.el.on("mouseover",
this.mouseOver,this);this.dropdownButton.button.el.on("mouseout",this.mouseOut,this);this.dropdownButton.button.el.on("click",this.toggleMenu,this)},this)},baseButtonClick:function(){this.baseButton.deactivate();this.createConfigCallback(makeHandler(this.dialogHide,this))},dialogHide:function(){this.baseButton.reset();this.dropdownButton.unhover()},getBaseButton:function(){return new GraphicButton(new AT.RectangularBox({cls:this.buttonClass,items:[{xtype:"box",autoEl:{tag:"div",html:"<span unselectable='on'>"+
this.buttonText+"</span>"}}]}))},getDropdownButton:function(){return new GraphicButton(new AT.RectangularBox({cls:this.dropdownControlClass,items:[{xtype:"box",autoEl:{tag:"span",html:"<img src='"+imgPath("pixel.gif")+"' width='1' height='1'>"}}]}))}});Ext.namespace("AT");AT.RectangularBox=Ext.extend(Ext.Container,{onRender:function(a){this.el=this.template.append(a,[this.cls],!0)},getLayoutTarget:function(){return this.el.child(".i")},template:new Ext.Template('<div class="{0}" ><div class="i"></div></div>')});Ext.reg("at_rectangular_box",AT.RectangularBox);function ShowCommentsLightBox(){this.constructor=ShowCommentsLightBox}ShowCommentsLightBox.prototype=new BasicLightbox;ShowCommentsLightBox.superclass=BasicLightbox.prototype;ShowCommentsLightBox.prototype.exist_invalid_fields_message_key="";ShowCommentsLightBox.prototype.close_tab_confirmation_message_key="";
ShowCommentsLightBox.prototype.init=function(a,b,c){BasicLightbox.prototype.init.call(this,b,"closeCommentsLightboxBtn");this.userCommentsLightBox=$("#"+b);this.tableEl=this.userCommentsLightBox.find(".tableContentContainer").find("table");this.titleDiv=this.userCommentsLightBox.find(".lightBoxTitle");this.tableRenderer=(new CommentsTableRender).init(this.tableEl,a.userComments,c);this._initTitle(a);this.tableRenderer.render();return this};
ShowCommentsLightBox.prototype._initTitle=function(a){a=messageResource.getMessage("report_comments.comments_made_by_user",[escapeHtmlSymbols(a.userFullName)]);this.titleDiv.empty();this.titleDiv.append(a)};ShowCommentsLightBox.prototype.show=function(){ShowCommentsLightBox.superclass.show.call(this);this._resetScroll();this._initCellsWidth()};
ShowCommentsLightBox.prototype._initCellsWidth=function(){var a=this.userCommentsLightBox.find(".commentsCell.data");a.addClass("breakWord");var b=a.width();a.removeClass("breakWord");a.css("max-width",b);this._initHeaderCells()};
ShowCommentsLightBox.prototype._initHeaderCells=function(){var a=this.userCommentsLightBox.find(".tableContentContainer"),b=this.userCommentsLightBox.find(".tableHeaderContainer");this.userCommentsLightBox.find(".identityCell.header").find(".identityText").text(this._getHeaderIdentityDescription());for(var c=[".identityCell",".dateCell",".timeCell"],d=0;d<c.length;d++){var e=b.find(c[d]+".header"),f=a.find(c[d]+".data");e.innerWidth(f.innerWidth())}};ShowCommentsLightBox.prototype._resetScroll=function(){this.userCommentsLightBox.find(".tableContentContainer").scrollTop(0)};
ShowCommentsLightBox.prototype._getHeaderIdentityDescription=function(){var a=messageResource.getMessage("common.Customer"),a=a+" / "+messageResource.getMessage("common.Project"),a=a+" / ";return a+=messageResource.getMessage("common.Task")};function CommentsTableRender(){this.constructor=CommentsTableRender}
CommentsTableRender.prototype.init=function(a,b,c){this.timeformat=c;this.tableEl=a;this.tbodyEl=a.find("tbody").first();this.rowTemplate=this.tableEl.find("tbody.templates").find("tr.commentsReportRow");this.tooltip=(new TableTooltip).init("reportCommentsPopupTooltip");this.tooltipTextPlaceholder=$("#reportCommentsPopupTooltip_textPlaceholder");this.userComments=b;this.numberFormatter=new NumberFormatter(SystemSettings.decimalSeparator,SystemSettings.digitGroupingSymbol,2,!1);return this};
CommentsTableRender.prototype.render=function(){this.tbodyEl.empty();for(var a=0;a<this.userComments.length;a++){var b=this.newRow(this.userComments[a]);this.tbodyEl.append(b)}};CommentsTableRender.prototype.newRow=function(a){var b=this.rowTemplate.clone();this._initIdentityCell(b,a.customer,a.project,a.task);this._initDateCell(b,a.date);this._initTimeCell(b,a.time);this._initCommentCell(b,a.comments);return b};
CommentsTableRender.prototype._initIdentityCell=function(a,b,c,d){a=a.find(".identityCell");a.append(escapeHtmlSymbols(b+" / "+c+" / "+d));this._initTooltip(a)};CommentsTableRender.prototype._initDateCell=function(a,b){a.find(".dateCell").append((new DateFormat(SystemSettings.dateFormat)).formatDate(new Date.parseJSONDate(b)))};
CommentsTableRender.prototype._initTimeCell=function(a,b){var c=a.find(".timeCell"),d;d=this.timeformat==TimeFormat.TIME?UserTime.formatTime(b):this.numberFormatter.format(b/60);c.append(d)};CommentsTableRender.prototype._initCommentCell=function(a,b){var c=a.find(".commentsCell"),d=escapeHtmlSymbols(b);c.append(d);this._initTooltip(c)};CommentsTableRender.prototype._initTooltip=function(a){var b=this;a.hover(function(a){b._showTooltip(a)},function(){b._hideTooltip()});a.mousemove(function(a){b._moveTooltip(a)})};
CommentsTableRender.prototype._showTooltip=function(a){$(a.target).outerWidth()<a.target.scrollWidth&&(this.tooltip.show(),this.tooltipTextPlaceholder.text($(a.target).text()),this.tooltip.move(calculateTooltipOffset(this.tooltip,a)))};CommentsTableRender.prototype._hideTooltip=function(){this.tooltip.hide()};CommentsTableRender.prototype._moveTooltip=function(a){this.tooltip.move(calculateTooltipOffset(this.tooltip,a))};function SendNotificationsNowManager(a,b){RpcControlManager.call(this);this.statesManager=a;this.states=b}SendNotificationsNowManager.prototype=new RpcControlManager;SendNotificationsNowManager.prototype.getService=function(){return jsonrpc.SendNotificationsNowService};SendNotificationsNowManager.prototype.getMethods=function(){return["SendNotificationsNowService.sendNotifications"]};
SendNotificationsNowManager.prototype.handleSpecificError=function(a){return a?(this.setState(this.states.error),!0):!1};SendNotificationsNowManager.prototype.getTimeoutMsg=function(){return messageResource.getMessage("mail_notifications.form.send_now.timeout_confirmation_message")};SendNotificationsNowManager.prototype.makeRemoteCall=function(a){return this.getService().sendNotifications(a)};SendNotificationsNowManager.prototype.beginSavingData=function(){this.setState(this.states.sending)};
SendNotificationsNowManager.prototype.endSavingData=function(a){RpcControlManager.isRpcBusy()&&this.setState(this.states.timeout)};SendNotificationsNowManager.prototype.onDataSavingComplete=function(a){this.setState(this.states.success)};SendNotificationsNowManager.prototype.setState=function(a){this.statesManager.setState(a)};AT.CustomDropdownButton=Ext.extend(AT.DropdownButton,{template:new Ext.Template('<table class="'+this.cls+'" cellspacing="0" cellpadding="0" border="0" width="100%">',"<tr>",'<td class="middle-left-cell contents customRightPart">',"<span>{0}</span>","</td>",'<td class="middle-right-cell customLeftPart"><div class="arrow"></div></td>',"</tr>","</table>"),initComponent:function(){AT.DropdownButton.superclass.initComponent.call(this)}});Ext.reg("custom_dropdown_button",AT.CustomDropdownButton);Ext.namespace("AT");
AT.DateRangeDropdownSelector=Ext.extend(Ext.Container,{autoEl:"div",layout:"table",rangeTypeValue:null,menuStates:[],radioGroup:"dateRange",initComponent:function(){AT.DateRangeDropdownSelector.superclass.initComponent.call(this);this.dateRangeInitState={dateRangeStateValue:this.rangeTypeValue};this.createDropdown();this.setItemsMap();this.addEvents("change");this.setMenuItems()},createDropdown:function(){this.dropdownCtn=new AT.CustomDropdownButton;this.add(this.dropdownCtn)},defineDropdownEvents:function(){this.dropdownCtn.on("render",
function(){this.dropdownCtn.el.on("mousedown",this.toggleMenu,this);this.dropdownCtn.el.dom.style.cursor="pointer"},this)},setMenuItems:function(){for(var a=0;a<this.menuStates.length;++a){var b=this.menuStates[a];b.radioGroup=this.radioGroup;b.clickHandler=this.itemClicked;b.handlerScope=this;b.custom&&(this.customState=b);this.rangeTypeValue==b.value&&this.updateState(b)}},afterRender:function(){this.defineDropdownEvents();this.menuShown=!1},fireChangeEvent:function(){this.fireEvent("change",this)},
setItemsMap:function(){this.itemsMap={};for(var a=0;a<this.menuStates.length;++a){var b=this.menuStates[a];this.itemsMap[b.value]=b}},refreshMenu:function(){for(var a=[],b=0;b<this.menuStates.length;++b)a.push(this.menuStates[b].createItem(this.currentState));this.menu=new Ext.menu.Menu({items:a,cls:"at-dropdown-list-btn-menu rangesListMenu"});this.menu.on("show",this.showMenuHandler,this);this.menu.on("hide",this.hideMenuHandler,this)},setCustomState:function(){this.updateState(this.customState)},
updateState:function(a){this.currentState=a;this.dropdownCtn.setText(a.title)},itemClicked:function(a){a.state!==this.currentState&&(this.updateState(a.state),this.fireChangeEvent());this.hideMenu()},hideMenu:function(){this.menuShown&&this.menu.hide()},mouseOver:function(){this.addClass("active")},mouseOut:function(){this.menuShown||this.removeClass("active")},getMenuAlign:function(){return"tl-bl?"},getElementToShowMenu:function(){return this.el.child("table:first")},toggleMenu:function(a){0===a.button&&
(this.menuShown=!this.menuShown)&&(this.refreshMenu(),this.menu.show(this.getElementToShowMenu(),this.getMenuAlign(),null),this.addClass("menuShown"))},hideMenuHandler:function(){this.menuShown=!1;this.removeClass("menuShown");this.restoreWindowKeyDownHandler()},showMenuHandler:function(){this.setWindowKeyDownHandler()},getRangeType:function(){return this.currentState},setRangeType:function(a){this.updateState(this.itemsMap[a])},setWindowKeyDownHandler:function(){this.escKeyMap||(this.escKeyMap=new Ext.KeyMap(Ext.getBody().parent(),
{key:Ext.EventObject.ESC,fn:function(a,b){this.menu&&this.menu.hide()},scope:this,stopEvent:!0}));this.escKeyMap.enable()},restoreWindowKeyDownHandler:function(){this.escKeyMap&&this.escKeyMap.disable()}});Ext.reg("date_range_dropdown_selector",AT.DateRangeDropdownSelector);function DataElementControl(){this.tooltip=this.value=this.disabledClassName=this.textElement=this.dataElement=null;this.tooltipEnabled=!1;this.tooltipText=null;this.invalidDataClass="invalid-data"}
DataElementControl.prototype.registerElements=function(a,b,c,d,e,f,g){this.dataElement=findChildById(a,b);var h=$(this.dataElement);d?h.attr("id",d):h.removeAttr("id");this.textElement=findChildById(a,b+c);a=$(this.textElement);e?a.attr("id",e):a.removeAttr("id");this.disabledClassName=f?f:"hidden";this.value=g?g:"";this.changeListeners=[]};DataElementControl.prototype.setDataElement=function(a){this.dataElement=a};DataElementControl.prototype.setTextElement=function(a){this.textElement=a};
DataElementControl.prototype.initTooltip=function(a){this.tooltip=new DhtmlTitle(a?a:"form-field-tooltip")};DataElementControl.prototype.setValidator=function(a){this.validator=a};DataElementControl.prototype.addChangeListener=function(a){this.changeListeners.push(a);addListener(this.dataElement,"change",a)};DataElementControl.prototype.notifyChangeListeners=function(){for(var a=0;a<this.changeListeners.length;a++)this.changeListeners[a]()};
DataElementControl.prototype.changeElementsState=function(a,b){addClass(b,this.disabledClassName);removeClass(a,this.disabledClassName)};DataElementControl.prototype.enableInput=function(){this.changeElementsState(this.dataElement,this.textElement)};DataElementControl.prototype.disableInput=function(){this.textElement.innerHTML=this.value;this.changeElementsState(this.textElement,this.dataElement)};DataElementControl.prototype.block=function(a){};DataElementControl.prototype.updateData=function(){};
DataElementControl.prototype.validate=function(){return!0};DataElementControl.prototype.init=function(a){this.value=a?a:"";this.dataElement.onblur=makeHandler(this.validate,this);this.dataElement.onmouseover=makeHandler(this.dataElementOnMouseOver,this);this.dataElement.onmouseout=makeHandler(this.dataElementOnMouseOut,this);this.textElement.onmouseover=makeHandler(this.textElementOnMouseOver,this);this.textElement.onmouseout=makeHandler(this.textElementOnMouseOut,this);this.initTooltip()};
DataElementControl.prototype.showTooltip=function(a,b,c){b=b?b:0;c=c?c:25;this.tooltipEnabled&&this.tooltip&&this.tooltip.showDelayedWithTimeout(this.getTooltipText(),a,b,c,500)};DataElementControl.prototype.dataElementOnMouseOver=function(){};DataElementControl.prototype.textElementOnMouseOver=function(){};DataElementControl.prototype.cancelShowTooltip=function(a){this.tooltip&&this.tooltip.cancelDelayedShow()};DataElementControl.prototype.dataElementOnMouseOut=function(){};
DataElementControl.prototype.textElementOnMouseOut=function(){};DataElementControl.prototype.getTooltipText=function(){return this.tooltipText};DataElementControl.prototype.setTooltipText=function(a){this.tooltipText=a};DataElementControl.prototype.setTooltipEnabled=function(a){this.tooltipEnabled=a};DataElementControl.prototype.setDisplayInputError=function(a,b){this.tooltipEnabled=a;this.tooltipText=b;a?addClass(this.dataElement,this.invalidDataClass):removeClass(this.dataElement,this.invalidDataClass)};
DataElementControl.prototype.focus=function(){focusElement(this.dataElement)};function InputControl(){DataElementControl.call(this)}InputControl.prototype=new DataElementControl;InputControl.prototype.registerElements=function(a,b,c,d,e,f,g){DataElementControl.prototype.registerElements.call(this,a,b,c,d,e,f,g);this.init()};InputControl.prototype.init=function(a){DataElementControl.prototype.init.call(this,a);this.dataElement.value=a;this.notifyChangeListeners()};InputControl.prototype.getValue=function(){return this.dataElement.value};
InputControl.prototype.enableInput=function(){this.dataElement.value=this.value;this.notifyChangeListeners();this.validate();DataElementControl.prototype.enableInput.call(this)};InputControl.prototype.disableInput=function(){DataElementControl.prototype.disableInput.call(this);this.dataElement.value=this.value;this.notifyChangeListeners()};InputControl.prototype.block=function(a){this.dataElement.disabled=a};InputControl.prototype.updateData=function(){this.validate();this.value=this.dataElement.value};
InputControl.prototype.dataElementOnMouseOver=function(){this.showTooltip(this.dataElement)};InputControl.prototype.dataElementOnMouseOut=function(){this.cancelShowTooltip()};InputControl.prototype.validate=function(){return!this.validator||this.validator.validate(this)};InputControl.prototype.setShowTextElement=function(a){this.textElement.style.display=a?"":"none"};IntegerInputControlValidator=function(a){IntegerNumbersValidator.call(this,a,void 0,"",!1)};
IntegerInputControlValidator.prototype=new IntegerNumbersValidator;IntegerInputControlValidator.prototype.validate=function(a){var b=function(){a.setDisplayInputError(!1)},c=function(){a.setDisplayInputError(!0,messageResource.getMessage("mail_notifications.form.input.invalid_data.positive_integer"))};return this.doCheckField(a.dataElement,!0,{onEmptyValue:b,onInvalidString:c,onGreaterThanMax:c,onLessThanMin:c,onOk:b})};
function TimeInputControl(){InputControl.call(this);this.setValidator(new TimeInputControlValidator)}TimeInputControl.prototype=new InputControl;TimeInputControl.prototype.updateData=function(){this.validate()};TimeInputControl.prototype.init=function(a){DataElementControl.prototype.init.call(this,a);this.dataElement.value="undefined"===typeof a?"":UserTime.formatTime(a);this.notifyChangeListeners()};TimeInputControl.prototype.enableInput=function(){this.notifyChangeListeners();this.validate();DataElementControl.prototype.enableInput.call(this)};
TimeInputControl.prototype.disableInput=function(){this.dataElement.value=UserTime.formatTime(this.value);this.textElement.innerHTML=this.dataElement.value;this.changeElementsState(this.textElement,this.dataElement);this.notifyChangeListeners()};TimeInputControlValidator=function(a){};
TimeInputControlValidator.prototype.validate=function(a){var b=a.dataElement.value,c=UserTime.parseTimeWithSystemSettings(b);if(""!==b&&spentTimeIsInvalid(c))return a.setDisplayInputError(!0,messageResource.getMessage("mail_notifications.form.input.invalid_data.positive_time",[SystemSettings.decimalSeparator])),a.value=-1,!1;if(""===b)return a.value="",a.setDisplayInputError(!1),!0;b=UserTime.formatTime(c);a.dataElement.value!==b&&(a.dataElement.value=b);a.value!==c&&(a.value=c);a.setDisplayInputError(!1);
return!0};function DropDownControl(){DataElementControl.call(this)}DropDownControl.prototype=new DataElementControl;DropDownControl.prototype.enableInput=function(){DataElementControl.prototype.enableInput.call(this)};DropDownControl.prototype.disableInput=function(){DataElementControl.prototype.disableInput.call(this)};DropDownControl.prototype.updateData=function(a){this.value=a;this.textElement.innerHTML=this.value};
DropDownControl.prototype.textElementOnMouseOver=function(){this.showTooltip(this.textElement,7,29)};DropDownControl.prototype.textElementOnMouseOut=function(){this.cancelShowTooltip(this.textElement)};function Rule(a,b){a&&this.init(a,b)}Rule.prototype.activeCls="active";Rule.prototype.stoppedCls="stopped";Rule.prototype.hoveredCls="hovered";Rule.prototype.normalCls="normal";Rule.prototype.editedCls="edited";Rule.prototype.hiddenCls="hidden";Rule.prototype.errorMessageCls="error-message";Rule.prototype.rpcDelay=300;
Rule.prototype.init=function(a,b){this.notificationType=a;this.addRuleButton=getElementById(String.format("addRule_{0}",this.notificationType));this.tooltip=new DhtmlTitle(String.format("tooltip_{0}",this.notificationType),!1,!0);this.timestamp=this.id=null;this.recipientsSelector=new UsersSelector;this.domEl=null;this.userSelectorLabelLength=68;this.usersInfo=b;return this};Rule.prototype.setInitialState=function(){this.ruleState.setInitialState()};
Rule.prototype.setDomEl=function(a,b){this.domEl=a;this.recipientsSelector.registerElements(this.domEl,String.format("recipientsSelector_{0}",this.notificationType),".text");this.registerInputs(b)};
Rule.prototype.registerInputs=function(){var a=NotificationNameByType[this.notificationType],b=$(this.domEl);this.removeButton=new IconButton(b.find(".remove-button."+a),makeHandlerNoPropagation(this.remove,this),this.tooltip,messageResource.getMessage("mail_notifications.form.tooltip.delete"));this.iconMessage=b.find(".iconMessage."+a)[0];this.iconMessage.mouseController=new MouseController;this.resumeButton=new IconButton(b.find(".resume-button."+a),makeHandlerNoPropagation(this.switchActiveState,
this),this.tooltip,messageResource.getMessage("mail_notifications.form.tooltip.pause"));this.saveButton=b.find(".saveButton."+a)[0];this.saveButton.onclick=makeHandlerNoPropagation(this.save,this);this.buttonMessage=b.find(".action-message."+a)[0];this.cancelButton=b.find(".cancelButton."+a)[0];this.cancelButton.onclick=makeHandlerNoPropagation(this.stopEdit,this);this.domEl.onmouseover=makeHandler(this.onMouseOver,this);this.domEl.onmouseout=makeHandler(this.onMouseOut,this);this.domEl.onclick=makeHandler(this.startEdit,
this)};Rule.prototype.initUI=function(a,b){this.recipientsSelector.init(a,NotificationTitle[this.notificationType],b,void 0);addClass(this.domEl,this.normalCls)};
Rule.prototype.initCPSelector=function(){this.cpSelectorMenu=window.customerProjectSelectorHolder.getMenu();this.cpSelectorButton=new AT.HierarchySelectorDropdownButton({renderTo:String.format(RuleFactory.CP_SELECTOR_BUTTON_ID,this.notificationType,this.index),labelCls:"hierarchySelectorButton",menu:this.cpSelectorMenu,tooltipObject:new DhtmlTitle("form-field-tooltip")});this.cpSelector=this.cpSelectorMenu.getSelectorPanel();this.cpSelectorButton.setTooltipEnabled(!1)};
Rule.prototype.enableCPSelector=function(){this.cpSelectorButton.setPlainTextMode(!1)};Rule.prototype.disableCPSelector=function(){this.cpSelectorButton.setPlainTextMode(!0);this.cpSelectorButton.setDisplayInputError(!1)};Rule.prototype.blockCPSelector=function(a){this.cpSelectorButton.setEnabled(!a);this.cpSelectorButton.setDisplayInputError(!1)};
Rule.prototype.onMouseOver=function(){!this.domEl||this.hovered||this.edited||(this.hovered=!0,removeClass(this.domEl,this.normalCls),addClass(this.domEl,this.hoveredCls))};Rule.prototype.onMouseOut=function(){try{if(!this.domEl||this.edited||Ext.isIE&&!isMouseOutElement(this.domEl,window.event))return}catch(a){}this.hovered=!1;removeClass(this.domEl,this.hoveredCls);addClass(this.domEl,this.normalCls)};Rule.prototype.switchActiveState=function(){this.stopped?this.resume():this.pause()};
Rule.prototype.resume=function(){this.id&&!RpcControlManager.isRpcBusy()&&(this.isValid()?(this.registerEventHandlers(),RpcControlManager.saveRpcControlBoundData(new RuleResumeManager(this),!1),this.displayMessage("common.resuming")):this.startEdit())};
Rule.prototype.pause=function(){if(this.id){if(RpcControlManager.isRpcBusy()&&this.ruleState.setParamsError){var a=this;window.setTimeout(function(){a.pause.call(a)},500)}else{if(RpcControlManager.isRpcBusy())return;this.registerEventHandlers();RpcControlManager.saveRpcControlBoundData(new RulePauseManager(this),!1)}this.displayMessage("common.pausing")}};
Rule.prototype.onPauseCompleted=function(){this.stopped=!0;if(this.domEl){addClass(this.domEl,this.stoppedCls);removeClass(this.domEl,this.activeCls);var a=messageResource.getMessage("mail_notifications.form.tooltip.resume");this.resumeButton.setTooltipMessage(a);this.displayMessage("mail_notifications.message.paused");this.switchIconMessageState(!0,a);this.ruleState.setParamsError=!1;PageOverlayTipsManager.getInstance().refreshDynamicTips()}};
Rule.prototype.switchIconMessageState=function(a,b){a?(this.iconMessage.onclick=makeHandlerNoPropagation(this.resume,this),this.iconMessage.onmouseover=makeHandler(function(){this.tooltip.showDelayedWithTimeoutNearMouse(b,this.iconMessage,this.iconMessage.mouseController,600)},this),this.iconMessage.onmouseout=makeHandler(function(){this.tooltip.cancelDelayedShow()},this),this.iconMessage.onmousemove=makeHandler(function(a){this.iconMessage.mouseController.update(a||window.event)},this)):(this.tooltip.immediateHide(),
this.iconMessage.onclick=Ext.emptyFn,this.iconMessage.onmouseover=Ext.emptyFn,this.iconMessage.onmousemove=Ext.emptyFn)};Rule.prototype.onResumeCompleted=function(){this.stopped=!1;this.domEl&&(addClass(this.domEl,this.activeCls),removeClass(this.domEl,this.stoppedCls),this.hideIconMessage(),this.resumeButton.setTooltipMessage(messageResource.getMessage("mail_notifications.form.tooltip.pause")),this.switchIconMessageState(!1,null),PageOverlayTipsManager.getInstance().refreshDynamicTips())};
Rule.prototype.onPauseEnd=function(){this.restoreEventHandlers();this.hideIconMessage();this.switchIconMessageState(!1,null)};Rule.prototype.onResumeEnd=function(){this.restoreEventHandlers();this.displayMessage("mail_notifications.message.paused");this.switchIconMessageState(!0,messageResource.getMessage("mail_notifications.form.tooltip.resume"))};Rule.prototype.onResumeBegin=function(){this.switchIconMessageState(!1,null)};
Rule.prototype.remove=function(){if(!RpcControlManager.isRpcBusy()&&confirm(messageResource.getMessage("mail_notifications.remove_confirmation")))if(this.id)this.registerEventHandlers(),RpcControlManager.saveRpcControlBoundData(new RuleDeleteManager(this),!1),this.displayMessage("common.removing");else this.onRemoved()};Rule.prototype.onRemoveEnd=function(){this.restoreEventHandlers();this.stopped?this.displayMessage("mail_notifications.message.paused"):this.hideIconMessage()};
Rule.prototype.onRemoved=function(){ruleFactory.removeRule(this)};Rule.prototype.displayButtons=function(a,b){this.displayControls(a,[this.saveButton,this.cancelButton],this.buttonMessage,b)};Rule.prototype.displayControls=function(a,b,c,d){d=d?messageResource.getMessage(d):"";for(var e=0;e<b.length;e++)this.displayElement(b[e],a);this.displayElement(c,!a);c.innerHTML=d};Rule.prototype.displayElement=function(a,b){b?removeClass(a,this.hiddenCls):addClass(a,this.hiddenCls)};
Rule.prototype.displayMessage=function(a){removeClass(this.iconMessage,this.hiddenCls);addClass(this.iconMessage,this.errorMessageCls);var b=messageResource.getMessage(a);this.iconMessage.innerHTML=b?b:a};Rule.prototype.hideIconMessage=function(){this.displayElement(this.iconMessage,!1)};
Rule.prototype.startEdit=function(a){!this.domEl||this.edited||RpcControlManager.isRpcBusy()||a&&(isTarget(this.resumeButton,a)||isTarget(this.removeButton,a)||isTarget(this.saveButton,a)||isTarget(this.cancelButton,a))||currentEditRule&&!currentEditRule.stopEdit()||(this.defineStateOfAllSelectors(),null!=this.id&&this.isValid(),this.registerEventHandlers(),removeClass(this.domEl,this.hiddenCls),this.edited=!0,currentEditRule=this,this.enableInputs(),removeClass(this.domEl,this.hoveredCls),removeClass(this.domEl,
this.normalCls),addClass(this.domEl,this.editedCls))};
Rule.prototype.stopEdit=function(){if(!this.domEl||this.saving)return!1;var a=this.id?"mail_notifications.discard_changes_confirmation":"mail_notifications.cancel_rule_creation_confirmation";if(this.isChanged()&&!confirm(messageResource.getMessage(a)))return this.scrollWindowIfNeeded(),!1;if(!this.id)this.onRemoved();this.restoreEventHandlers();this.edited=!1;currentEditRule=null;removeClass(this.addRuleButton,"disabled-link");removeClass(this.domEl,this.editedCls);addClass(this.domEl,this.normalCls);
this.ruleState.reset();this.disableInputs();return!0};Rule.prototype.saveAndCallBack=function(a,b){this.callBackFunction=a;this.callBackContext=b;this.save()};Rule.prototype.callBack=function(){this.callBackFunction&&this.callBackFunction.call(this.callBackContext);this.clearCallBack()};Rule.prototype.clearCallBack=function(){this.callBackContext=this.callBackFunction=null};Rule.prototype.isEdited=function(){return this.edited};Rule.prototype.scrollWindowIfNeeded=function(){return scrollToElementIfNeeded(this.domEl)};
Rule.prototype.disableInputs=function(){this.recipientsSelector.disable()};Rule.prototype.enableInputs=function(){this.recipientsSelector.enable()};Rule.prototype.defineStateOfAllSelectors=function(){this.recipientsSelector.defineState()};Rule.prototype.defineStateOfCustomerProjectSelector=function(){this.cpSelectorMenu.setCurrentParent(this.cpSelectorButton,!0);this.ruleState.setCPSelectorState(this.cpSelector,this.ruleState.cpSelectorKey)};Rule.prototype.focusFirstErroneousInput=function(){this.ruleState.focusFirstErroneousInput()};
Rule.prototype.save=function(){if(!this.isValid())return alert(messageResource.getMessage("mail_notifications.form.cannot_save.invalid_data")),this.scrollWindowIfNeeded(),this.clearCallBack(),this.focusFirstErroneousInput(),!1;var a=this.ruleState.checkRecipients();a&&alert(trim(messageResource.getMessage("mail_notifications.warning")+"\n"+a));a=this.savingManager?this.savingManager:new RulesSavingManager(this);RpcControlManager.saveRpcControlBoundData(a,!1);return!0};
Rule.prototype.isChanged=function(){this.updateState();return this.ruleState.isChanged()};Rule.prototype.isValid=function(){this.updateState();return this.ruleState.isValid()};Rule.prototype.updateState=function(){this.updateInputs();this.ruleState.getCurrentState()};Rule.prototype.getParams=function(){var a=this.ruleState.getCurrentState();a.javaClass=RuleJavaClassNames[this.notificationType];a.active=!this.stopped;a.id=this.id||null;a.lastChangeTimestamp=this.lastChangeTimestamp||null;return a};
Rule.prototype.setParams=function(a){this.ruleState.initState(a);this.active=a.active;this.id=a.id;this.lastChangeTimestamp=a.lastChangeTimestamp;if(this.active)this.ruleState.setParamsError&&this.pause();else this.onPauseCompleted()};Rule.prototype.setBlockInputs=function(a){this.recipientsSelector.block(a)};Rule.prototype.onBeginSaving=function(){this.displayButtons(!1,"common.saving");this.updateInputs();this.setBlockInputs(!0)};Rule.prototype.onEndSaving=function(){this.setBlockInputs(!1);this.displayButtons(!0)};
Rule.prototype.onSavingComplete=function(){this.ruleState.update();this.stopEdit();this.callBack()};Rule.prototype.onSavingErrorOccurred=function(){this.displayButtons(!0)};Rule.prototype.updateInputs=function(){this.recipientsSelector.update()};
Rule.prototype.registerEventHandlers=function(){var a=this;ScheduleButtonsControl.setIsEventProhibited(makeHandler(clickProhibited,this));KeyDownHandler.setOnKeyDownHandler(function(b){handleEscape(function(){a.stopEdit()},b);handleEnter(function(){a.save()},b);handleTab(function(){window.event.cancelBubble=!0},b)});this.oldDocumentMousedown=document.onmousedown;document.onmousedown=function(){getEventTarget(event);if(!a.isStopEditEvent(event)||isTarget(a.domEl,event))isTarget(a.domEl,event)&&a.saving&&
stopEventPropagation(event);else if(a.edited){var b=(new Date).getTime(),c=findPosY(a.domEl);a.stopEdit()?(b+100<(new Date).getTime()||!a.id&&c<calculateCoords(event).y)&&fireMouseEvent(event,"click",!1):stopEventPropagation(event)}};this.initDescendantEventsListener($(a.domEl),{"dropdown.menuHide":function(){a.menuShown=!1},"dropdown.menuShow":function(){a.menuShown=!0}})};Rule.prototype.isRuleTarget=function(a){return hasParentWithClassName(getEventTarget(a),"rule")};
Rule.prototype.restoreEventHandlers=function(){KeyDownHandler.restoreOnKeyDownHandler();ScheduleButtonsControl.restoreIsEventProhibited();document.onmousedown=this.oldDocumentMousedown};
Rule.prototype.isStopEditEvent=function(a){var b=a?a:window.event;a=["x-menu","disabled-link"];var c=getEventTarget(b);if("left"!=whichButtonPressed(b)||"html"==c.nodeName.toLowerCase())return!1;if(RpcControlManager.isRpcBusy())return!0;for(b=0;b<a.length;b++)if(hasParentWithClassName(c,a[b]))return!1;return this.menuShown?!1:!0};_.extend(Rule.prototype,DescendantEventsListenerMixin);function PersonalTTRule(){}PersonalTTRule.prototype=_.create(Rule.prototype);
PersonalTTRule.prototype.init=function(a){Rule.prototype.init.call(this,NotificationType.PERSONAL_TT,a);this.ttLimit=new TTLimit;this.ruleState=new PersonalTTRuleState(this);return this};PersonalTTRule.prototype.initUI=function(){Rule.prototype.initUI.call(this,MailNotificationsUserSelectorCache.SELECTOR_USERS_WITH_ENTER_TT_RIGHT,this.userSelectorLabelLength)};
PersonalTTRule.prototype.registerInputs=function(a){Rule.prototype.registerInputs.call(this);this.ttLimit.init(this.domEl,NotificationType.PERSONAL_TT,a)};PersonalTTRule.prototype.enableInputs=function(){Rule.prototype.enableInputs.call(this);this.ttLimit.enable()};PersonalTTRule.prototype.disableInputs=function(){Rule.prototype.disableInputs.call(this);this.ttLimit.disable()};PersonalTTRule.prototype.updateInputs=function(){Rule.prototype.updateInputs.call(this);this.ttLimit.update()};
PersonalTTRule.prototype.setBlockInputs=function(a){Rule.prototype.setBlockInputs.call(this,a);this.ttLimit.block(a)};function UnsubmittedTTRule(){}UnsubmittedTTRule.prototype=_.create(Rule.prototype);UnsubmittedTTRule.prototype.init=function(a){Rule.prototype.init.call(this,NotificationType.UNSUBMITTED_TT,a);this.ttUsersSelector=new UsersSelector;this.ttLimit=new TTLimit;this.ruleState=new UnsubmittedTTRuleState(this);return this};
UnsubmittedTTRule.prototype.registerInputs=function(a){Rule.prototype.registerInputs.call(this);this.ttLimit.init(this.domEl,NotificationType.UNSUBMITTED_TT,a);this.ttUsersSelector.registerElements(this.domEl,String.format("ttUsersSelector_{0}",NotificationType.UNSUBMITTED_TT),".text")};
UnsubmittedTTRule.prototype.initUI=function(){Rule.prototype.initUI.call(this,MailNotificationsUserSelectorCache.SELECTOR_USERS_WITH_ACCESS_TO_MANAGER_SCOPES);this.ttUsersSelector.init(MailNotificationsUserSelectorCache.SELECTOR_USERS_WITH_ENTER_TT_RIGHT_NO_EMAIL_CHECK,null,this.userSelectorLabelLength)};UnsubmittedTTRule.prototype.enableInputs=function(){Rule.prototype.enableInputs.call(this);this.ttLimit.enable();this.ttUsersSelector.enable()};
UnsubmittedTTRule.prototype.defineStateOfAllSelectors=function(){Rule.prototype.defineStateOfAllSelectors.call(this);this.ttUsersSelector.defineState()};UnsubmittedTTRule.prototype.disableInputs=function(){Rule.prototype.disableInputs.call(this);this.ttLimit.disable();this.ttUsersSelector.disable()};UnsubmittedTTRule.prototype.updateInputs=function(){Rule.prototype.updateInputs.call(this);this.ttLimit.update()};
UnsubmittedTTRule.prototype.setBlockInputs=function(a){Rule.prototype.setBlockInputs.call(this,a);this.ttLimit.block(a);this.ttUsersSelector.block(a)};function RuleWithUsersAndProjectsFilter(){}RuleWithUsersAndProjectsFilter.prototype=_.create(Rule.prototype);
RuleWithUsersAndProjectsFilter.prototype.onSavingComplete=function(){Rule.prototype.onSavingComplete.call(this);0<this.additionalData.notAssignedProjects.length&&0<this.additionalData.notAssignedCustomers.length?alert(messageResource.getMessage("mail_notifications.warning.projects.no_recipients",[messageResource.getMessage("mail_notifications.warning.projects.no_recipients.customers_projects")])):0<this.additionalData.notAssignedProjects.length?alert(messageResource.getMessage("mail_notifications.warning.projects.no_recipients",
[messageResource.getMessage("mail_notifications.warning.projects.no_recipients.projects")])):0<this.additionalData.notAssignedCustomers.length&&alert(messageResource.getMessage("mail_notifications.warning.projects.no_recipients",[messageResource.getMessage("mail_notifications.warning.projects.no_recipients.customers")]))};function DeadlineRule(){}DeadlineRule.prototype=_.create(RuleWithUsersAndProjectsFilter.prototype);
DeadlineRule.prototype.init=function(a){Rule.prototype.init.call(this,NotificationType.DEADLINE,a);this.deadlineCondition=new DeadlineCondition;this.ruleState=new DeadlineRuleState(this);return this};DeadlineRule.prototype.initUI=function(){Rule.prototype.initUI.call(this,MailNotificationsUserSelectorCache.SELECTOR_USERS_WITH_EDIT_HIERARCHY_RIGHT)};
DeadlineRule.prototype.registerInputs=function(a){Rule.prototype.registerInputs.call(this);this.initCPSelector();this.deadlineCondition.init(this.domEl,this.notificationType,a)};DeadlineRule.prototype.enableInputs=function(){Rule.prototype.enableCPSelector.call(this);Rule.prototype.enableInputs.call(this);this.deadlineCondition.enable()};DeadlineRule.prototype.disableInputs=function(){Rule.prototype.disableCPSelector.call(this);Rule.prototype.disableInputs.call(this);this.deadlineCondition.disable()};
DeadlineRule.prototype.defineStateOfAllSelectors=function(){Rule.prototype.defineStateOfAllSelectors.call(this);this.defineStateOfCustomerProjectSelector()};DeadlineRule.prototype.updateInputs=function(){Rule.prototype.updateInputs.call(this);this.deadlineCondition.update()};DeadlineRule.prototype.setBlockInputs=function(a){Rule.prototype.setBlockInputs.call(this,a);this.blockCPSelector(a);this.deadlineCondition.block(a)};function EstimateRule(){}EstimateRule.prototype=_.create(RuleWithUsersAndProjectsFilter.prototype);
EstimateRule.prototype.init=function(a){Rule.prototype.init.call(this,NotificationType.ESTIMATE,a);this.ruleState=new EstimateRuleState(this);this.additionalTextSelectedClassname="no-input-static-text unselectable additionalTextSelected";this.additionalTextClassname="no-input-static-text unselectable additionalText";return this};EstimateRule.prototype.initUI=function(){Rule.prototype.initUI.call(this,MailNotificationsUserSelectorCache.SELECTOR_USERS_WITH_EDIT_HIERARCHY_RIGHT)};
EstimateRule.prototype.registerInputs=function(a){Rule.prototype.registerInputs.call(this);this.initCPSelector();this.estimateInput=new InputControl;a=String.format("notification[{0}].estimatePercent",this.notificationType);this.estimateInput.registerElements(this.domEl,a,".text");this.estimateInput.setValidator(new IntegerInputControlValidator(1));this.additionalText=findChildById(this.domEl,a+".additionalText")};
EstimateRule.prototype.enableInputs=function(){Rule.prototype.enableCPSelector.call(this);Rule.prototype.enableInputs.call(this);this.estimateInput.enableInput();this.additionalText.className=this.additionalTextSelectedClassname};EstimateRule.prototype.disableInputs=function(){Rule.prototype.disableCPSelector.call(this);Rule.prototype.disableInputs.call(this);this.estimateInput.disableInput();this.additionalText.className=this.additionalTextClassname};
EstimateRule.prototype.defineStateOfAllSelectors=function(){Rule.prototype.defineStateOfAllSelectors.call(this);this.defineStateOfCustomerProjectSelector()};EstimateRule.prototype.updateInputs=function(){Rule.prototype.updateInputs.call(this);this.estimateInput.updateData()};EstimateRule.prototype.setBlockInputs=function(a){Rule.prototype.setBlockInputs.call(this,a);this.blockCPSelector(a);this.estimateInput.block(a)};function ProjectBudgetRule(){}ProjectBudgetRule.prototype=_.create(RuleWithUsersAndProjectsFilter.prototype);
ProjectBudgetRule.prototype.init=function(a){Rule.prototype.init.call(this,NotificationType.PROJECT_BUDGET,a);this.moneyCondition=new MoneyCondition;this.ruleState=new ProjectBudgetRuleState(this);return this};ProjectBudgetRule.prototype.initUI=function(){Rule.prototype.initUI.call(this,MailNotificationsUserSelectorCache.SELECTOR_USERS_WITH_GENERATE_MONEY_REPORTS_RIGHT)};
ProjectBudgetRule.prototype.registerInputs=function(a){Rule.prototype.registerInputs.call(this);this.initCPSelector();this.moneyCondition.init(this.domEl,this.notificationType,a)};ProjectBudgetRule.prototype.enableInputs=function(){Rule.prototype.enableCPSelector.call(this);Rule.prototype.enableInputs.call(this);this.moneyCondition.enable()};ProjectBudgetRule.prototype.disableInputs=function(){Rule.prototype.disableCPSelector.call(this);Rule.prototype.disableInputs.call(this);this.moneyCondition.disable()};
ProjectBudgetRule.prototype.defineStateOfAllSelectors=function(){Rule.prototype.defineStateOfAllSelectors.call(this);this.defineStateOfCustomerProjectSelector()};ProjectBudgetRule.prototype.updateInputs=function(){Rule.prototype.updateInputs.call(this);this.moneyCondition.update()};ProjectBudgetRule.prototype.setBlockInputs=function(a){Rule.prototype.setBlockInputs.call(this,a);this.blockCPSelector(a);this.moneyCondition.block(a)};function PersonalEarningsRule(){}PersonalEarningsRule.prototype=_.create(Rule.prototype);
PersonalEarningsRule.prototype.init=function(a){Rule.prototype.init.call(this,NotificationType.PERSONAL_EARNINGS,a);this.moneyCondition=new MoneyCondition;this.ttUsersSelector=new UsersSelector;this.ruleState=new PersonalEarningsRuleState(this);return this};
PersonalEarningsRule.prototype.registerInputs=function(a){Rule.prototype.registerInputs.call(this);this.moneyCondition.init(this.domEl,this.notificationType,a);this.ttUsersSelector.registerElements(this.domEl,String.format("ttUsersSelector_{0}",NotificationType.PERSONAL_EARNINGS),".text")};
PersonalEarningsRule.prototype.initUI=function(){Rule.prototype.initUI.call(this,MailNotificationsUserSelectorCache.SELECTOR_USERS_WITH_GENERATE_MONEY_REPORTS_RIGHT);this.ttUsersSelector.init(MailNotificationsUserSelectorCache.SELECTOR_ALL_USERS_NO_EMAIL_CHECK,null,this.userSelectorLabelLength,null,new AT.ComplicateUsersAndGroupsSelectionHelper({userSelectorGroupsStrategy:getUserSelectorFeatureStrategy(),accessRight:null,maxLength:this.userSelectorLabelLength,checkEmail:!1}))};
PersonalEarningsRule.prototype.enableInputs=function(){Rule.prototype.enableInputs.call(this);this.moneyCondition.enable();this.ttUsersSelector.enable()};PersonalEarningsRule.prototype.defineStateOfAllSelectors=function(){Rule.prototype.defineStateOfAllSelectors.call(this);this.ttUsersSelector.defineState()};PersonalEarningsRule.prototype.disableInputs=function(){Rule.prototype.disableInputs.call(this);this.moneyCondition.disable();this.ttUsersSelector.disable()};
PersonalEarningsRule.prototype.updateInputs=function(){Rule.prototype.updateInputs.call(this);this.moneyCondition.update()};PersonalEarningsRule.prototype.setBlockInputs=function(a){Rule.prototype.setBlockInputs.call(this,a);this.moneyCondition.block(a);this.ttUsersSelector.block(a)};function RuleFactory(a,b,c){this.PROTOTYPE_ID="rulePrototype_{0}";this.INSERT_MARKER_ID="addRule_{0}";this.MAIN_TABLE_ID="rulesTable";RuleFactory.CP_SELECTOR_BUTTON_ID="cpSelectorButton_{0}_{1}";a={users:a,userGroups:b,timeZoneGroups:c};this.creators=[];this.creators[NotificationType.PERSONAL_TT]=(new PersonalTTRuleCreator).init(a);this.creators[NotificationType.UNSUBMITTED_TT]=(new UnsubmittedTTRuleCreator).init(a);this.creators[NotificationType.DEADLINE]=(new DeadlineRuleCreator).init(a);this.creators[NotificationType.ESTIMATE]=
(new EstimateRuleCreator).init(a);this.creators[NotificationType.PROJECT_BUDGET]=(new ProjectBudgetRuleCreator).init(a);this.creators[NotificationType.PERSONAL_EARNINGS]=(new PersonalEarningsRuleCreator).init(a);this.rules={};for(var d in NotificationType)this.rules[NotificationType[d]]=[]}RuleFactory.prototype.isEdited=function(){for(var a in this.rules)for(var b=0;b<this.rules[a].length;b++)if(null!=this.rules[a][b]&&this.rules[a][b].isEdited())return!0;return!1};
RuleFactory.prototype.isEmpty=function(){for(var a in this.rules)for(var b=0;b<this.rules[a].length;b++)if(null!=this.rules[a][b])return!1;return!0};RuleFactory.prototype.getAddingRule=function(a){a=this.rules[a];for(var b=0;b<a.length;b++){var c=a[b];if(c&&!c.id)return c}return null};
RuleFactory.prototype.addRule=function(a,b){if(!(rulesLoadCompleted&&RpcControlManager.isRpcBusy()||null!=this.getAddingRule(a))){var c=this.createRule(a);if(c){this.rules[a].push(c);c.index=this.rules[a].length-1;var d=this.createRuleRow(a,c.index);d.id=String.format("ruleRow_{0}_{1}",a,c.index);c.setDomEl(d,String.format("ruleFactory.rules[{0}][{1}]",a,c.index));c.initUI();b?c.setParams(b):(addClass(document.getElementById(String.format(this.INSERT_MARKER_ID,a)),"disabled-link"),addClass(d,c.hiddenCls),
c.setInitialState(),c.startEdit());PageOverlayTipsManager.getInstance().refreshDynamicTips();return c}}};RuleFactory.prototype.createRule=function(a){return this.creators[a].createRule()};
RuleFactory.prototype.createRuleRow=function(a,b){var c=document.getElementById(String.format(this.PROTOTYPE_ID,a)),d=document.getElementById(String.format(this.INSERT_MARKER_ID,a)),e=document.getElementById(this.MAIN_TABLE_ID),f=$(c).find(".cpSelectorButton")[0];f&&(f.id=String.format(RuleFactory.CP_SELECTOR_BUTTON_ID,a,b));c=c.cloneNode(!0);c.id=null;this.creators[a].beforeInsertRow(c);e.insertBefore(c,d);return c};
RuleFactory.prototype.removeRule=function(a){a.id?setTimeout(_.bind(this.removeRuleDOM,this,a),350):this.removeRuleDOM(a);this.rules[a.notificationType][a.index]=null;this.creators[a.notificationType].removeRule()};RuleFactory.prototype.removeRuleDOM=function(a){a.domEl.parentNode.removeChild(a.domEl);PageOverlayTipsManager.getInstance().refreshDynamicTips()};function RuleCreator(){this.counter=0}RuleCreator.prototype.init=function(a){this.usersInfo=a;return this};
RuleCreator.prototype.getTypeId=function(){return-1};RuleCreator.prototype.doCreateRule=function(){return null};RuleCreator.prototype.createRule=function(){var a=this.doCreateRule();this.counter++;return a};RuleCreator.prototype.removeRule=function(){this.counter--};RuleCreator.prototype.beforeInsertRow=function(a){};function PersonalTTRuleCreator(){}PersonalTTRuleCreator.prototype=new RuleCreator;PersonalTTRuleCreator.prototype.getTypeId=function(){return NotificationType.PERSONAL_TT};
PersonalTTRuleCreator.prototype.doCreateRule=function(){return(new PersonalTTRule).init(this.usersInfo)};function UnsubmittedTTRuleCreator(){}UnsubmittedTTRuleCreator.prototype=new RuleCreator;UnsubmittedTTRuleCreator.prototype.getTypeId=function(){return NotificationType.UNSUBMITTED_TT};UnsubmittedTTRuleCreator.prototype.doCreateRule=function(){return(new UnsubmittedTTRule).init(this.usersInfo)};function DeadlineRuleCreator(){}DeadlineRuleCreator.prototype=new RuleCreator;
DeadlineRuleCreator.prototype.getTypeId=function(){return NotificationType.DEADLINE};DeadlineRuleCreator.prototype.doCreateRule=function(){return(new DeadlineRule).init(this.usersInfo)};function EstimateRuleCreator(){}EstimateRuleCreator.prototype=new RuleCreator;EstimateRuleCreator.prototype.getTypeId=function(){return NotificationType.ESTIMATE};EstimateRuleCreator.prototype.doCreateRule=function(){return(new EstimateRule).init(this.usersInfo)};function ProjectBudgetRuleCreator(){}
ProjectBudgetRuleCreator.prototype=new RuleCreator;ProjectBudgetRuleCreator.prototype.getTypeId=function(){return NotificationType.PROJECT_BUDGET};ProjectBudgetRuleCreator.prototype.doCreateRule=function(){return(new ProjectBudgetRule).init(this.usersInfo)};function PersonalEarningsRuleCreator(){}PersonalEarningsRuleCreator.prototype=new RuleCreator;PersonalEarningsRuleCreator.prototype.getTypeId=function(){return NotificationType.PERSONAL_EARNINGS};
PersonalEarningsRuleCreator.prototype.doCreateRule=function(){return(new PersonalEarningsRule).init(this.usersInfo)};Ext.namespace("AT");
AT.UsersForApproveTTPageSelectorPanel=Ext.extend(AT.ThreePositionUserSelectorPanel,{groupBySettingCookieName:"approveTTPageUserSelectorGroupBySetting",collapsedCookiesKey:"approveTTPageUserSelector",allItemsOptionLabelKey:"approve_tt.users_selector.all_users",customOptionLabelKey:"approve_tt.users_selector.selected_users",showShowInactiveCheckbox:!1,closeButtonLabelKey:"approve_tt.users_selector.apply_and_close.button.caption",cancelButtonLabelKey:"common.cancel",allItemsOptionValue:!0,customOptionValue:!1,
initComponent:function(){AT.UsersForApproveTTPageSelectorPanel.superclass.initComponent.call(this);if(this.customOnChangeHandler)this.on("change",this.customOnChangeHandler,this)},createFooterButtons:function(){this.resetButton=new AT.FlatButton({icon:atImgPath("undo.gif"),text:messageResource.getMessage(this.resetButtonLabelKey)});this.closeButton=new AT.GradientButton({text:messageResource.getMessage(this.closeButtonLabelKey),minWidth:60,cls:"greyButton close-button"});this.cancelButton=new AT.GradientButton({text:messageResource.getMessage(this.cancelButtonLabelKey),
minWidth:60,cls:"greyButton close-button cancel-button"})},getFooterSection:function(){return[this.cancelButton,this.closeButton,this.resetButton]},saveCurrentState:function(){var a=this.getSelectedUsers();this.setPredefinedParameters({optionValue:a.allUsers,selection:this.createUsersSelection(a.selectedUserIds),showInactive:!1});this.groupTypeInit=this.groupType},canExpandCollapseNodes:function(){return this.userGroupsEnabled||this.timeZoneGroupsEnabled},isSelectionChanged:function(){return this.selectorTree.isSelectionChanged()},
resetState:function(a,b){this.hideNonSelectedButtonChecked&&!b&&this._toggleHideNonSelected();AT.UsersForApproveTTPageSelectorPanel.superclass.resetState.call(this,a)},fullResetState:function(a,b){this.beforeResetAction();this.resetState(a,b);this.afterResetAction()},loadState:function(a,b){b||this.setGroupType(a.groupType);this.setInitialOptionValue(this.getOptionValueByStateValue(a.optionValue));this.loadPermanentState(a);this.setSelection(a.selection);this.updateState()},initHideUserGroupsStrategy:function(){return new HideUserGroupsStrategy},
initShowUserGroupsStrategy:function(){return new ShowUserGroupsStrategy},getSelectedUsers:function(){return{allUsers:this.getStateValueByOptionValue(this.getCurrentOptionValue()),selectedUserIds:this.getSelectedUserIds()}},setAllUsersIfNoneSelected:function(){this.getSelectedNodeSet().isEmpty()&&this.isCustomOptionSelected()&&this.selectOption(this.allItemsOptionValue)},getSelection:function(a){return this.userSelectorGroupsStrategy.makeSelectionFromNodeSet(this.getSelectedNodeSet(),a,!0,this.groupType)},
getSelectedUserIds:function(){return this.getSelection(!1).getSecondLevel()},collectCurrentSettings:function(){return{allUsers:this.getStateValueByOptionValue(this.getCurrentOptionValue()),selectedUserIds:this.getSelectedUserIds(),searchString:this.filterWordsField?this.filterWordsField.getSearchString():null,hideNonSelectedButtonChecked:this.hideNonSelectedButtonChecked,optionValueInit:this.optionValueInit,initialSelection:this.userSelectorGroupsStrategy.makeSelectionFromNodeSet(this.selectorTree.getSelectionController().getInitiallySelectedNodeSet(),
!1,!0)}},setSettingsBeforeTreeRebuilding:function(a){this.loadState({optionValue:a.allUsers,selection:new TwoLevelSelection([],a.selectedUserIds)},!0);a.hideNonSelectedButtonChecked&&this.selectorFilter.setSelectedOnlyFromInitiallySelectedNodeSet();null!=a.searchString&&0<a.searchString.length&&this.selectorFilter.setSearchString(a.searchString)},createSelectionFilters:function(){},initialize:function(a,b,c,d,e,f,g){AT.UsersForApproveTTPageSelectorPanel.superclass.initialize.call(this,a,b,c,d,e);
this.loadState({optionValue:f,selection:this.createUsersSelection(g)});!f&&this.getSelectedNodeSet().isEmpty()&&this.setInitialOptionValue(this.getOptionValueByStateValue(this.allItemsOptionValue))},getDescription:function(a,b){return a.getDescription(this.getSelection(!0),b)},createUsersSelection:function(a){return null==a||0==a.length?TwoLevelSelection.emptySelection():new TwoLevelSelection([],a)},makeSelectionHelper:function(){this.selectionHelper=new AT.SimpleUsersAndGroupsSelectionHelper({itemNounSingularKey:this.labelItemNounSingularKey,
itemNounPluralKey:this.labelItemNounPluralKey,showInactiveCount:!0,showSingleItemInactiveText:!1,userSelectorGroupsStrategy:this.userSelectorGroupsStrategy,maxCharacters:this.labelMaxChars,pleaseSelectMessageKey:"approve_tt.users_selector.no_users_selected"})},createTree:function(){var a=AT.UsersForApproveTTPageSelectorPanel.superclass.createTree.call(this),b=new TriStateSelectionController(a);a.setSelectionController(b);return a},createEmptyMessageBuilder:function(){return new ApproveTTUsersSelectorEmptyMessageBuilder(this.userSelectorGroupsStrategy)},
getFilterWordsPopupCoordinates:function(){return this.userGroupsEnabled||this.timeZoneGroupsEnabled?AT.UsersForApproveTTPageSelectorPanel.superclass.getFilterWordsPopupCoordinates.apply(this,arguments):{x:-2,y:-4}}});function BaseRulesManager(a){this.rule=a}BaseRulesManager.prototype=new RpcControlManager;BaseRulesManager.prototype.getService=function(){return jsonrpc.MailNotificationsService};BaseRulesManager.prototype.getMethods=function(){return["MailNotificationsService.deleteRule","MailNotificationsService.pauseRule","MailNotificationsService.resumeRule","MailNotificationsService.saveRule","MailNotificationsService.saveSingleRule"]};
BaseRulesManager.prototype.isRuleChangedException=function(a){return a&&a.name&&0<=a.name.indexOf("RuleChangedException")};BaseRulesManager.prototype.isSingleRuleException=function(a){return a&&a.name&&0<=a.name.indexOf("SingleRuleException")};BaseRulesManager.prototype.isRuleDeletedException=function(a){return a&&a.name&&0<=a.name.indexOf("RuleDeletedException")};
BaseRulesManager.prototype.isValidationError=function(a){return a&&(a.name&&0<=a.name.indexOf("InvalidRuleException")||a.code&&a.code==JSONRpcClient.Exception.CODE_ERR_UNMARSHALL)};
BaseRulesManager.prototype.handleSpecificError=function(a){this.isRuleChangedException(a)?this.handleConcurrentChangeError("mail_notifications.form.js.rule_changed"):this.isRuleDeletedException(a)?this.handleConcurrentChangeError("mail_notifications.form.js.rule_deleted"):this.isValidationError(a)?this.handleValidationError(a):this.isSingleRuleException(a)?this.handleConcurrentChangeError("mail_notifications.form.js.single_rule"):this.handelUnexpectedRpcError(a);return!0};
BaseRulesManager.prototype.handelUnexpectedRpcError=function(a){a=new RpcErrorManager(a);window.setTimeout(RpcControlManager.saveRpcControlBoundData,500,a)};BaseRulesManager.prototype.handleConcurrentChangeError=function(a){alert(messageResource.getMessage(a));document.location.reload()};BaseRulesManager.prototype.handleValidationError=function(a){alert(messageResource.getMessage("mail_notifications.form.cannot_save.invalid_data"));this.rule.onSavingErrorOccurred()};
BaseRulesManager.prototype.getRpcErrorMsg=function(){return messageResource.getMessage("mail_notifications.form.error_message")};BaseRulesManager.prototype.getTimeoutMsg=function(){return messageResource.getMessage("mail_notifications.form.saving_timeout")};BaseRulesManager.prototype.endSavingData=function(){wait(this.rule.rpcDelay)};function RpcErrorManager(a){RpcControlManager.call(this);this.exception=a}RpcErrorManager.prototype=new RpcControlManager;RpcErrorManager.prototype.getService=function(){return jsonrpc.MailNotificationsService};
RpcErrorManager.prototype.getMethods=function(){return["MailNotificationsService.processUnexpectedException"]};RpcErrorManager.prototype.makeRemoteCall=function(a){this.getService().processUnexpectedException(a,this.getExceptionBean())};
RpcErrorManager.prototype.getExceptionBean=function(){var a={};a.javaClass=exceptionBeanClass;a.errorCode=this.exception.code;a.errorMessage=this.exception.msg;a.stackTrace=this.exception.trace;a.exceptionName=this.exception.name;a.hasErrorCode=null!=this.exception.code;return a};RpcErrorManager.prototype.onDataSavingComplete=function(a){document.forms[0].pageAction.value=rpcErrorRedirect;document.forms[0].submit()};function RulesSavingManager(a){BaseRulesManager.call(this,a)}
RulesSavingManager.prototype=new BaseRulesManager;RulesSavingManager.prototype.beginSavingData=function(){this.rule.saving=!0;this.rule.onBeginSaving()};RulesSavingManager.prototype.endSavingData=function(){BaseRulesManager.prototype.endSavingData.call(this);this.rule.saving=!1;this.rule.onEndSaving()};
RulesSavingManager.prototype.onDataSavingComplete=function(a){this.rule.id=a.id;this.rule.lastChangeTimestamp=Date.parseJSONTime(a.timestamp);this.rule.additionalData=a.additionalData?a.additionalData.map:null;this.rule.onSavingComplete()};RulesSavingManager.prototype.makeRemoteCall=function(a){this.getService().saveRule(a,this.rule.getParams())};function SingleRuleSavingManager(a){RulesSavingManager.call(this,a)}SingleRuleSavingManager.prototype=new RulesSavingManager;
SingleRuleSavingManager.prototype.makeRemoteCall=function(a){this.getService().saveSingleRule(a,this.rule.getParams())};function RulePauseManager(a){BaseRulesManager.call(this,a)}RulePauseManager.prototype=new BaseRulesManager;RulePauseManager.prototype.beginSavingData=function(){};RulePauseManager.prototype.endSavingData=function(){BaseRulesManager.prototype.endSavingData.call(this);this.rule.onPauseEnd()};RulePauseManager.prototype.onDataSavingComplete=function(){this.rule.onPauseCompleted()};
RulePauseManager.prototype.makeRemoteCall=function(a){this.getService().pauseRule(a,this.rule.id,this.rule.lastChangeTimestamp)};function RuleResumeManager(a){BaseRulesManager.call(this,a)}RuleResumeManager.prototype=new BaseRulesManager;RuleResumeManager.prototype.beginSavingData=function(){this.rule.onResumeBegin()};RuleResumeManager.prototype.endSavingData=function(){BaseRulesManager.prototype.endSavingData.call(this);this.rule.onResumeEnd()};RuleResumeManager.prototype.onDataSavingComplete=function(){this.rule.onResumeCompleted()};
RuleResumeManager.prototype.makeRemoteCall=function(a){this.getService().resumeRule(a,this.rule.id,this.rule.lastChangeTimestamp)};function RuleDeleteManager(a){BaseRulesManager.call(this,a)}RuleDeleteManager.prototype=new BaseRulesManager;RuleDeleteManager.prototype.beginSavingData=function(){};RuleDeleteManager.prototype.endSavingData=function(){BaseRulesManager.prototype.endSavingData.call(this);this.rule.onRemoveEnd()};RuleDeleteManager.prototype.onDataSavingComplete=function(){this.rule.onRemoved()};
RuleDeleteManager.prototype.makeRemoteCall=function(a){this.getService().deleteRule(a,this.rule.id,this.rule.lastChangeTimestamp)};ScheduleDhtmlPanel.prototype=new DhtmlPopup;
function ScheduleDhtmlPanel(a,b,c,d,e,f,g,h){DhtmlPopup.call(this,a);this.addEventDereferencer("mousedown");this.scheduleInputName=b;this.messageBoxId=c;this.saveButtonId=d;this.cancelButtonId=e;this.savingMessageId=f;this.formName=g?g:this.divId+"-form";this.scheduleInputIdPostfix=h?h:"-box";this.dataSavingCallBack=this.panelController=null;this.beforeShowHandler=ScheduleDhtmlPanel.prototype.beforeShowHandler;this.beforeHideHandler=ScheduleDhtmlPanel.prototype.beforeHideHandler;this.doSave=!1;this.hiddenElementCls=
"hidden"}ScheduleDhtmlPanel.prototype.setPanelController=function(a){this.panelController=a};ScheduleDhtmlPanel.prototype.getPanelController=function(){return this.panelController};ScheduleDhtmlPanel.prototype.setDataSavingCallBack=function(a){this.dataSavingCallBack=a};ScheduleDhtmlPanel.prototype.setFormName=function(a){this.formName=a};ScheduleDhtmlPanel.prototype.getScheduleInputs=function(){return document.forms[this.formName].elements[this.scheduleInputName]};
ScheduleDhtmlPanel.prototype.saveAndHide=function(){this.doSave=!0;this.hide()};ScheduleDhtmlPanel.prototype.save=function(){for(var a=this.getScheduleInputs(),b=[],c=0;c<a.length;c++)a[c].checked&&b.push({relativeDay:c,absoluteDay:parseInt(a[c].value)});this.panelController.saveSchedule(b)};ScheduleDhtmlPanel.prototype.cancelChanges=function(){this.doSave=!1;this.hide()};
ScheduleDhtmlPanel.prototype.setFormDisable=function(a,b){for(var c=this.getScheduleInputs(),d=0;d<c.length;d++)c[d].disabled=a;this.displayButtonsSection(b)};
ScheduleDhtmlPanel.prototype.displayButtonsSection=function(a){var b=getElementById(this.saveButtonId),c=getElementById(this.cancelButtonId),d=getElementById(this.savingMessageId);a?(addClass(b,this.hiddenElementCls),addClass(c,this.hiddenElementCls),d.innerHTML=a,removeClass(d,this.hiddenElementCls)):(removeClass(b,this.hiddenElementCls),removeClass(c,this.hiddenElementCls),addClass(d,this.hiddenElementCls))};
ScheduleDhtmlPanel.prototype.displayMessage=function(a){var b=getElementById(this.messageBoxId);b.style.display="block";b.innerHTML=a};ScheduleDhtmlPanel.prototype.onBeginSaving=function(a){this.setFormDisable(!0,a)};ScheduleDhtmlPanel.prototype.onEndSaving=function(){this.setFormDisable(!1)};ScheduleDhtmlPanel.prototype.onDataSavingComplete=function(){this.doSave=!1;this.hide();this.dataSavingCallBack&&(this.dataSavingCallBack(),this.dataSavingCallBack=null)};
ScheduleDhtmlPanel.prototype.handelError=function(a){this.setFormDisable(!1);this.displayMessage(a)};ScheduleDhtmlPanel.prototype.setUpForm=function(){for(var a=this.panelController.getScheduledDays(),b=this.getScheduleInputs(),c=0;c<a.length;c++)if(a[c][0]){b[c].checked=!0;var d=this.getMarkupElementByInput(b[c]);addClass(d,"scheduled")}};
ScheduleDhtmlPanel.prototype.cleanForm=function(){for(var a=this.getScheduleInputs(),b=0;b<a.length;b++){a[b].checked=!1;var c=this.getMarkupElementByInput(a[b]);removeClass(c,"scheduled")}};ScheduleDhtmlPanel.prototype.scheduledDayChanges=function(a){this.doSave=!0;var b=this.getMarkupElementByInput(a);a.checked?addClass(b,"scheduled"):removeClass(b,"scheduled")};
ScheduleDhtmlPanel.prototype.registerEventHandlers=function(){var a=this;KeyDownHandler.setOnKeyDownHandler(function(b){handleEscape(function(){a.cancelChanges()},b);handleEnter(function(){a.hide()},b);handleTab(function(){window.event.cancelBubble=!0},b)});this.oldDocumentMousedown=document.onmousedown;document.onmousedown=function(){var b=event.target||event.srcElement;null!=a.getOwner()&&a.getOwner()==b||a.hide()};this.getPopupDiv().onmousedown=function(a){window.event.cancelBubble=!0};this.oldWindowResize=
window.onresize;window.onresize=function(){a.hide()}};ScheduleDhtmlPanel.prototype.restoreEventHandlers=function(){KeyDownHandler.restoreOnKeyDownHandler();document.onmousedown=this.oldDocumentMousedown;window.onresize=this.oldWindowResize};ScheduleDhtmlPanel.prototype.getMarkupElementByInput=function(a){a=a.id.substr(0,a.id.indexOf(this.scheduleInputIdPostfix));return getElementById(a)};
ScheduleDhtmlPanel.prototype.beforeShowHandler=function(){this.cleanForm();this.setUpForm();getElementById(this.messageBoxId).style.display="none"};ScheduleDhtmlPanel.prototype.beforeHideHandler=function(){if(!this.doSave)return!0;this.save();return!1};ScheduleDhtmlPanel.prototype.toggleDay=function(a){a=getElementById(a);a.checked=!a.checked;this.scheduledDayChanges(a)};SchedulePanelController=function(a,b,c){this.type=a;this.scheduledDays=b;this.schedulePanel=c;this.newScheduledDays=null;this.isSaving=!1;this.rpcDelay=300};SchedulePanelController.prototype.saveSchedule=function(a){this.newScheduledDays=a;RpcControlManager.saveRpcControlBoundData(new ScheduleSavingManager(this))};SchedulePanelController.prototype.getScheduledDays=function(){return this.scheduledDays};
SchedulePanelController.prototype.getScheduledDaysString=function(){var a=this.scheduledDays.toString();if(-1==a.indexOf("false"))return messageResource.getMessage("mail_notifications.schedule_button.title.daily");if(-1==a.indexOf("true"))return messageResource.getMessage("mail_notifications.schedule_button.title.no-days");for(var a=new String,b=0;b<this.scheduledDays.length;b++)this.scheduledDays[b][0]&&(a+=this.scheduledDays[b][1]+", ");return a.substr(0,a.length-2)};
SchedulePanelController.prototype.getNotificationType=function(){return this.type};SchedulePanelController.prototype.getScheduleList=function(){for(var a=[],b=0;b<this.newScheduledDays.length;b++)a.push(this.newScheduledDays[b].absoluteDay);return{javaClass:"java.util.ArrayList",list:a}};SchedulePanelController.prototype.onBeginSaving=function(a){this.schedulePanel.onBeginSaving(a)};SchedulePanelController.prototype.onEndSaving=function(){this.schedulePanel.onEndSaving()};
SchedulePanelController.prototype.onDataSavingComplete=function(){var a;for(a=0;a<this.scheduledDays.length;a++)this.scheduledDays[a][0]=!1;for(a=0;a<this.newScheduledDays.length;a++)this.scheduledDays[this.newScheduledDays[a].relativeDay][0]=!0;this.newScheduledDays=null;this.schedulePanel.onDataSavingComplete()};SchedulePanelController.prototype.handelError=function(a){this.schedulePanel.handelError(a)};function ScheduleSavingManager(a){this.schedule=a}ScheduleSavingManager.prototype=new RpcControlManager;ScheduleSavingManager.prototype.getService=function(){return jsonrpc.MailNotificationsService};ScheduleSavingManager.prototype.getMethods=function(){return["MailNotificationsService.saveSchedule"]};ScheduleSavingManager.prototype.beginSavingData=function(){this.schedule.onBeginSaving(messageResource.getMessage("mail_notifications.schedule_popup.saving"))};
ScheduleSavingManager.prototype.endSavingData=function(){wait(this.schedule.rpcDelay);this.schedule.onEndSaving()};ScheduleSavingManager.prototype.onDataSavingComplete=function(){this.schedule.onDataSavingComplete()};ScheduleSavingManager.prototype.handleSpecificError=function(a){this.schedule.handelError(messageResource.getMessage("mail_notifications.schedule_popup.cannot_save"));return!0};ScheduleSavingManager.prototype.getRpcErrorMsg=function(){return"cannot save"};
ScheduleSavingManager.prototype.getTimeoutMsg=function(){return messageResource.getMessage("mail_notifications.schedule_popup.saving_timeout")};ScheduleSavingManager.prototype.makeRemoteCall=function(a){this.schedule.getNotificationType();this.schedule.getScheduleList();this.getService().saveSchedule(a,this.schedule.type,this.schedule.getScheduleList())};function SubmitTTErrors(){}SubmitTTErrors.getTTExceedsDayLimitMessage=function(a,b){return messageResource.getMessage("submit_tt.err_exceeds_day_limit",[calLayout[a],b])};
SubmitTTErrors.markDayTTAsInvalid=function(a){for(i=0;i<taskIds.length;i++){var b=document.forms.SubmitTTForm.elements["timeTrack["+taskIds[i]+"].spentStr["+a+"]"];b&&b.type&&"text"!=b.type&&(b=document.getElementById("complTask["+taskIds[i]+"].day["+a+"]"));!b||b.name&&fieldErrors[b.name]||(b.style.color=ClientSideErrors.errorHighlightColor,b.title=SubmitTTErrors.getTTExceedsDayLimitMessage(a,maxMinutesPerDayStr))}SubmitTTErrors.highlightDayTotal(a,ClientSideErrors.errorHighlightColor,SubmitTTErrors.getTTExceedsDayLimitMessage(a,
maxMinutesPerDayStr));SubmitTTErrors.registerDayError(a)};SubmitTTErrors.markDayLeaveInfoAsInvalid=function(a,b){LeaveButtons.markButtonAsInvalid(a,b);SubmitTTErrors.registerDayError(a)};
SubmitTTErrors.markDayAsValid=function(a){if(dayErrors[a]){for(i=0;i<taskIds.length;i++){var b=document.forms.SubmitTTForm.elements["timeTrack["+taskIds[i]+"].spentStr["+a+"]"];b&&b.type&&"text"!=b.type&&(b=document.getElementById("complTask["+taskIds[i]+"].day["+a+"]"));!b||b.name&&fieldErrors[b.name]||(b.style.color="",b.title="")}SubmitTTErrors.highlightDayTotal(a,"","");LeaveButtons.markButtonAsValid(a);SubmitTTErrors.unregisterDayError(a)}};
SubmitTTErrors.highlightDayTotal=function(a,b,c){if(a=document.getElementById("dayTotal["+a+"]"))a.style.color=b,a.title=c};SubmitTTErrors.registerDayError=function(a){dayErrors[a]=!0};SubmitTTErrors.unregisterDayError=function(a){dayErrors[a]&&delete dayErrors[a]};SubmitTTErrors.hideClientSideErrorMessageIfNoErrors=function(){SubmitTTErrors.hasErrors()||ClientSideErrors.hideClientSideErrorMessage()};SubmitTTErrors.hasErrors=function(){var a=0,b;for(b in dayErrors)dayErrors[b]&&a++;return 0<a||ClientSideErrors.hasErrors()};function SubmitTTChanges(){}SubmitTTChanges.registerChange=function(a){a&&(weekTTChanges[a]=!0)};SubmitTTChanges.unregisterChange=function(a){weekTTChanges[a]&&delete weekTTChanges[a]};SubmitTTChanges.hasChanges=function(){var a=0,b;for(b in weekTTChanges)a++;return 0<a};function CellButton(a,b,c,d,e,f,g){this.buttonTable=a;this.buttonExternalCell=b;this.className=c;this.outerClassName=d;this.errorCode="";this.pressed=this.hovered=this.invalid=!1;this.disabled=e;this.errorMessage="";this.titleElement=f;this.hint=g}CellButton.prototype.updateCssAndTooltip=function(){this.updateCssClass();this.updateTooltip()};CellButton.prototype.setTitle=function(a){this.titleElement.innerHTML=a};CellButton.prototype.setHint=function(a){this.hint=a;this.updateCssAndTooltip()};
CellButton.prototype.markAsInvalid=function(a,b){this.errorCode=a;this.errorMessage=b;this.invalid=!0;this.updateCssAndTooltip()};CellButton.prototype.markAsValid=function(){this.errorCode="";this.invalid=!1;this.updateCssAndTooltip()};CellButton.prototype.isDisabled=function(){return this.disabled};CellButton.prototype.isInvalid=function(){return this.invalid};CellButton.prototype.press=function(){this.pressed=!0;this.updateCssAndTooltip()};
CellButton.prototype.unpress=function(){this.pressed=!1;this.updateCssAndTooltip()};CellButton.prototype.hover=function(){this.disabled||(this.hovered=!0,this.updateCssClass())};CellButton.prototype.unhover=function(){this.hovered=!1;this.updateCssClass()};CellButton.prototype.getTableId=function(){return this.buttonTable.id};
CellButton.prototype.updateCssClass=function(){var a="";this.isDisabled()&&(a+=" disabled");this.pressed&&(a+=" pressed");this.hovered&&(a+=" hovered");this.buttonExternalCell&&(this.buttonExternalCell.className=this.outerClassName+a);this.invalid&&(a+=" invalid");this.buttonTable.className=this.className+a};CellButton.prototype.setDisabled=function(a){this.disabled=a;this.updateCssAndTooltip()};
CellButton.prototype.updateTooltip=function(){this.buttonTable.title=this.disabled?"":this.invalid?this.errorMessage:this.hint};function LockEventsListener(){}LockEventsListener.prototype=_.create(Object.prototype,{selectionRemoved:function(){},selectionFinished:function(a,b){},userDayClicked:function(a,b,c){}});function ViewCommentsListener(){}ViewCommentsListener.prototype=_.create(Object.prototype,{onViewComments:function(){},onCloseComments:function(){}});function LockMenu(a,b){this.menuItemSelected=!1;this.lockItem=new Ext.menu.Item(a);this.unlockItem=new Ext.menu.Item(b);var c=this;this.menu=new Ext.menu.Menu({cls:"lock-unlock-menu",items:[this.lockItem,this.unlockItem],listeners:{show:function(){c.menuItemSelected=!1},itemclick:function(){c.menuItemSelected=!0},hide:function(){c.menuItemSelected||c.cancelHandler.call(c.cancelHandlerScope)}}})}
LockMenu.prototype=_.create(Object.prototype,{setCancelHandler:function(a,b){this.cancelHandler=a;this.cancelHandlerScope=b},setLockEnabled:function(a){this.lockItem.setDisabled(!a)},setLockHandler:function(a,b){this.lockItem.setHandler(a,b)},setUnlockEnabled:function(a){this.unlockItem.setDisabled(!a)},setUnlockHandler:function(a,b){this.unlockItem.setHandler(a,b)},show:function(a,b){this.menu.showAt([a,b])},hide:function(){this.menu.hide()}});function BaseLockingManager(a,b,c,d){RpcControlManager.call(this);this.userIds=a;this.fromDateStr=b;this.toDateStr=c;this.selectionUpdater=d}
BaseLockingManager.prototype=_.create(RpcControlManager.prototype,{getService:function(){return jsonrpc.LockTTService},getMethods:function(){return["LockTTService.lock","LockTTService.unlock"]},beginSavingData:function(){this.selectionUpdater.beforeRpcCall()},endSavingData:function(a){this.selectionUpdater.afterRpcCall(a)},onDataSavingComplete:function(a){this.selectionUpdater.handleRpcCallResult(a)},handleSpecificError:function(a){return-1!=a.name.indexOf("TimeTrackChangedException")?(alert(messageResource.getMessage("lock_tt.table.selected_tt_modified")),
document.location.reload(),!0):-1!=a.name.indexOf("NoSuchUserException")?(1==this.userIds.length?alert(messageResource.getMessage("lock_tt.table.selected_user_deleted")):alert(messageResource.getMessage("lock_tt.table.one_of_selected_user_deleted")),document.location.reload(),!0):-1!=a.name.indexOf("CannotLockFutureException")?(alert(messageResource.getMessage("lock_tt.table.future_days_not_locked")),document.location.reload(),!0):!1},handleNoRightsError:function(a){return-1!=a.name.indexOf("com.actimind.actitime.services.NoRightsForRemoteCallException")?
(alert(messageResource.getMessage("error.js.json_rpc.no_rights")),document.location.reload(),!0):!1}});function LockUsersManager(a,b,c,d,e){BaseLockingManager.call(this,a,b,c,d);this.timestamp=e}LockUsersManager.prototype=_.create(BaseLockingManager.prototype,{makeRemoteCall:function(a){this.getService().lock(a,this.userIds,this.fromDateStr,this.toDateStr,this.timestamp)},getRpcErrorMsg:function(){return messageResource.getMessage("lock_tt.table.cannot_lock_users")},getTimeoutMsg:function(){return messageResource.getMessage("lock_tt.table.cannot_lock_users_for_10sec")}});function UnlockUsersManager(a,b,c,d){BaseLockingManager.call(this,a,b,c,d)}UnlockUsersManager.prototype=_.create(BaseLockingManager.prototype,{makeRemoteCall:function(a){this.getService().unlock(a,this.userIds,this.fromDateStr,this.toDateStr)},getRpcErrorMsg:function(){return messageResource.getMessage("lock_tt.table.cannot_unlock_users")},getTimeoutMsg:function(){return messageResource.getMessage("lock_tt.table.cannot_unlock_users_for_10sec")}});function ViewCommentsMessages(){this.TIMEOUT_DESCRIPTION_LOADING=messageResource.getMessage("view_comments.timeout_comments_loading");this.ERROR_DESCRIPTION_LOADING=messageResource.getMessage("view_comments.error_comments_loading")}function ViewCommentsUtil(){this.entityType="Task";this.VIEW_DESCRIPTION_POPUP_CAPTION=messageResource.getMessage("view_comments.popup_caption")}ViewCommentsUtil.prototype.Messages=_.create(ViewCommentsMessages.prototype);
ViewCommentsUtil.prototype.checkServiceAvailable=function(){return jsonrpc.TaskCommentService?!0:(document.location.reload(),!1)};ViewCommentsUtil.prototype.doLoadDescription=function(a,b,c){try{var d=this;isRpcReady(["TaskCommentService.getTimeCommentsForUser"])?this.checkServiceAvailable()&&jsonrpc.TaskCommentService.getTimeCommentsForUser(b,a.taskId,a.userId,a.dateStr):this.tid=window.setTimeout(function(){d.doLoadDescription(a,b,c)},200)}catch(e){c(e)}};
function ViewCommentsParameters(a,b,c){this.taskId=a;this.userId=b;this.dateStr=c}ViewCommentsParameters.prototype.toString=function(){return[this.taskId,this.userId,this.dateStr].join()};
function showViewCommentsPopup(a){if(!isBusyState()){var b=new ViewCommentsUtil;descriptionPopup.hide();descriptionState=new ViewDescriptionState(a,null,null,b);var c=getDescription(b.entityType,a);null==c?(descriptionState.setState("LOADING"),descriptionPopup.show(b.VIEW_DESCRIPTION_POPUP_CAPTION,messageResource.getMessage("common.popup.loading"),-100,15),loadDescription(a,b)):(descriptionState.setState("VIEW"),descriptionPopup.show(b.VIEW_DESCRIPTION_POPUP_CAPTION,c,-100,15))}};function DayLeaveInfo(a,b){this.leaveType=a;this.duration=null!=a?b:null}DayLeaveInfo.prototype.equals=function(a){return a?a.leaveType==this.leaveType&&a.duration==this.duration:!1};LeaveButton.prototype=new CellButton;LeaveButton.prototype.parentClass=CellButton;
function LeaveButton(a,b,c,d,e,f,g,h,k,m,l,p,t,x,u,y,v,r){this.parentClass(g,null,"leaveButton",null,x,h);this.needToReset=a;this.dayOfWeekNum=d;this.dayOfWeekName=e;this.isInFuture=f;this.textElementId=h;this.leaveTypeField=k;this.leaveDurationField=m;this.iconDiv=l;this.icon=p;this.onChangeHandler=t;this.changed=!1;this.isNonWorkingDay=y;this.maxLeaveDuration=v;this.isToday=r;this.disabledReason=u;this.dayLeaveInfo=new DayLeaveInfo(0<b?LeaveTypesList.getLeaveTypeById(b):null,0<b&&(0<c||-1==c)?c:
null);this.update()}LeaveButton.prototype.getDayLeaveInfo=function(){return this.dayLeaveInfo};LeaveButton.prototype.setDayLeaveInfo=function(a){if(this.needToReset||!this.getDayLeaveInfo().equals(a))if(this.needToReset=!1,this.dayLeaveInfo=a,this.leaveTypeField.value=null==a.leaveType?"0":a.leaveType.id,this.leaveDurationField.value=null==a.duration?"-1":a.duration,this.changed=!0,this.update(),this.onChangeHandler)this.onChangeHandler(this.dayOfWeekNum)};
LeaveButton.prototype.update=function(){var a;null==this.dayLeaveInfo.duration||this.isNonWorkingDay?(hideElement(this.iconDiv),a=this.isNonWorkingDay?messageResource.getMessage("submit_tt.leave.button.nonworking_day"):messageResource.getMessage("submit_tt.leave.button.workday")):(this.iconDiv.style.display="",null!=this.dayLeaveInfo.leaveType?(this.icon.src=this.dayLeaveInfo.leaveType.iconUrl,this.icon.alt=this.dayLeaveInfo.leaveType.name,document.isPNGFixing&&fixTransparencyForImage(this.icon)):
(this.icon.src=imgPath("pixel.gif"),this.icon.alt=""),this.icon.title=this.icon.alt,a=null!=this.dayLeaveInfo.duration&&-1!=this.dayLeaveInfo.duration?UserTime.formatTime(this.dayLeaveInfo.duration):escapeHtmlSymbols(messageResource.getMessage("submit_tt.leave.whole_day")));this.setTitle(a);this.updateCssAndTooltip()};LeaveButton.prototype.isChanged=function(){return this.changed};LeaveButton.prototype.setChanged=function(a){this.changed=a};LeaveButton.prototype.getDayOfWeekNum=function(){return this.dayOfWeekNum};
LeaveButton.prototype.updateCssClass=function(){CellButton.prototype.updateCssClass.call(this);var a=this.buttonTable.className,b,c;this.isToday?(b=" nonworking_today",c=" today"):(b=" nonworking",c="");null==this.dayLeaveInfo.leaveType||this.isNonWorkingDay?(this.buttonTable.style.backgroundColor="",a=this.isNonWorkingDay?a+b:a+c):(this.buttonTable.style.backgroundColor=this.dayLeaveInfo.leaveType.iconBackgroundColor,a+=b);this.buttonTable.className=a};
LeaveButton.prototype.updateTooltip=function(){var a;a="";this.isDisabled()?a=this.disabledReason:this.invalid?"submit_tt.leave.button.tooltip.error_time_exceeds_workday_duration"==this.errorCode?a=messageResource.getMessage(this.errorCode,[UserTime.formatTime(this.maxLeaveDuration)]):"submit_tt.leave.error_leave_type_unavailable"==this.errorCode&&(a=messageResource.getMessage(this.errorCode)):this.pressed||(a=this.dayLeaveInfo.leaveType?this.dayLeaveInfo.leaveType.name:messageResource.getMessage("submit_tt.leave.button.tooltip.click_to_enter"));
this.buttonTable.title=a};
var LeavePopup={init:function(a,b,c,d,e,f,g,h,k,m,l,p,t){LeavePopup.timeOffField=a;LeavePopup.leaveTypeSelect=(new SimpleListMenuButton({emptyListMessageKey:"submit_tt.leave.button.no_active_leave_types",emptySelectionMessageKey:"submit_tt.leave.button.please_select",extraClass:"withBoxStyle",itemHtmlCallback:function(a){return'<div class="item">'+escapeHtmlSymbols(a.name)+"</div>"},onSelect:function(){LeavePopup.onTimeOffFieldFocus();LeavePopup.onLeaveTypeChange()}})).init(b);LeavePopup.noTimeOffLabel=
g;LeavePopup.timeOffIcon=k;LeavePopup.noTimeOffElementsToChangeColor=h;LeavePopup.messageDiv=m;LeavePopup.messageTextDiv=l;LeavePopup.cancelButtonBlock=p;LeavePopup.MSG_NO_LEAVES_ENABLED=messageResource.getMessage("submit_tt.message.cannot_enter.no_enabled");LeavePopup.MSG_INCORRECT_TIME_TOOLTIP=messageResource.getMessage("submit_tt.error_invalid_tt",[SystemSettings.decimalSeparator]);LeavePopup.MSG_INCORRECT_TIME_LABEL=messageResource.getMessage("submit_tt.error_invalid_tt_for_label",[SystemSettings.decimalSeparator]);
LeavePopup.MSG_MISSING_LEAVE_TYPE_TOOLTIP=messageResource.getMessage("submit_tt.leave.error_leave_type_unavailable");LeavePopup.MSG_MISSING_TIME_NAME="submit_tt.leave.error_missing_time";LeavePopup.MSG_MISSING_LEAVE_TYPE_NAME="submit_tt.leave.error_leave_type_unavailable";LeavePopup.ERROR_INCORRECT_TIME="incorrect_time";LeavePopup.ERROR_MISSING_LEAVE_TYPE="missing_leave_type";LeavePopup.ERROR_MISSING_TIME="missing_time";LeavePopup.ERROR_TIME_EXCEEDS_WORKDAY="time_exceeds_workday";LeavePopup.leavePopup=
new OkCancelPopup("LeavePopup","leavePopupTable",e,f);LeavePopup.leavePopup.setOnOkClickHandler(LeavePopup.validateAndSave);LeavePopup.pressedButton=null;LeavePopup.errorMessageOuterElement=e;LeavePopup.errorMessageInnerElement=f;LeavePopup.maxLeaveDuration=480;LeavePopup.isNonWorkingDay=!1;LeavePopup.popupWidth=t;LeavePopup.NO_LEAVE_RADIO_BUTTON="LeavePopupRadio_NoLeave";LeavePopup.TIME_OFF_RADIO_BUTTON="LeavePopupRadio_TimeOff";LeavePopup.radioButtons={};LeavePopup.radioButtons[LeavePopup.NO_LEAVE_RADIO_BUTTON]=
c;LeavePopup.radioButtons[LeavePopup.TIME_OFF_RADIO_BUTTON]=d;LeavePopup.leavePopup.setAfterHideHandler(function(){LeavePopup.pressedButton.unpress();LeavePopup.pressedButton=null;KeyDownHandler.restoreOnKeyDownHandler()});LeavePopup.beforeShowHandler=null;LeavePopup.lastValidationResult="";LeavePopup.lastSelectedLeaveType=null},updateState:function(a){LeavePopup.isNonWorkingDay=a.isNonWorkingDay;LeavePopup.maxLeaveDuration=a.maxLeaveDuration;null!=a.getDayLeaveInfo().leaveType||0<a.getDayLeaveInfo().duration||
""!=a.errorCode?LeavePopup.radioButtons[LeavePopup.TIME_OFF_RADIO_BUTTON].checked=!0:LeavePopup.radioButtons[LeavePopup.NO_LEAVE_RADIO_BUTTON].checked=!0;LeavePopup.noTimeOffLabel.innerHTML=messageResource.getMessage("submit_tt.leave.radio.no_leave",[LeavePopup.pressedButton.dayOfWeekName]);null==a.getDayLeaveInfo().duration||-1==a.getDayLeaveInfo().duration?$(LeavePopup.timeOffField).pVal(""):$(LeavePopup.timeOffField).pVal(UserTime.formatTime(a.getDayLeaveInfo().duration))},getTimeExceedsWorkdayMessage:function(){return messageResource.getMessage(LeavePopup.isNonWorkingDay?
"submit_tt.leave.error_timeoff_exceeds_default_workday_duration":"submit_tt.leave.error_timeoff_exceeds_workday_duration",[UserTime.formatTime(LeavePopup.maxLeaveDuration)])},show:function(a){if(!LeavePopup.beforeShowHandler||LeavePopup.beforeShowHandler()){LeavePopup.leavePopup.isVisible()&&LeavePopup.leavePopup.hide();LeavePopup.lastValidationResult="";LeavePopup.pressedButton=a;LeavePopup.updateState(a);LeavePopup.leavePopup.setPositioningStrategy(new ElementRelativePositioning(a.getTableId()));
LeavePopup.unmarkInvalidFieldsAndHideErrorMessage();a.press();var b=getObjectHeight(a.getTableId());LeavePopup.leavePopup.show(-1,b,LeavePopup.popupWidth,null,!1);var c;c=LeavePopup.pressedButton.dayLeaveInfo;b=null!=c.leaveType?c.leaveType.id:LeavePopup.lastSelectedLeaveType&&LeavePopup.leaveTypeIsValid(LeavePopup.lastSelectedLeaveType)?LeavePopup.lastSelectedLeaveType.id:null;LeavePopup.fillActualLeaveTypes(b,null==c.leaveType&&0<c.duration||"submit_tt.leave.error_leave_type_unavailable"==a.errorCode);
0===LeavePopup.leaveTypeSelect.getItems().length&&null===b?(LeavePopup.setLeaveTypeInputsEnabled(!1),hideElement(LeavePopup.cancelButtonBlock),LeavePopup.showMessage(LeavePopup.MSG_NO_LEAVES_ENABLED)):(LeavePopup.setLeaveTypeInputsEnabled(!0),LeavePopup.hideMessage(),LeavePopup.cancelButtonBlock.style.display="");LeavePopup.updateTimeOffIcon();LeavePopup.validateSelectionAndShowErrors(!1)}},showMessage:function(a){LeavePopup.messageDiv.style.display="";LeavePopup.messageTextDiv.innerHTML=a},setLeaveTypeInputsEnabled:function(a){LeavePopup.leaveTypeSelect.setDisabled(!a);
LeavePopup.timeOffField.disabled=!a;LeavePopup.radioButtons[LeavePopup.TIME_OFF_RADIO_BUTTON].disabled=!a;if(null!=LeavePopup.noTimeOffElementsToChangeColor)for(var b=0;b<LeavePopup.noTimeOffElementsToChangeColor.length;b++)LeavePopup.noTimeOffElementsToChangeColor[b].className=a?"":"grayed";a||(LeavePopup.radioButtons[LeavePopup.NO_LEAVE_RADIO_BUTTON].checked=!0,$(LeavePopup.timeOffField).pVal(""))},hideMessage:function(){hideElement(LeavePopup.messageDiv)},validateSelection:function(){if(LeavePopup.radioButtons[LeavePopup.NO_LEAVE_RADIO_BUTTON].checked)return null;
var a=LeavePopup.getCurrentLeaveInfo(),b=LeavePopup.timeOffField;if(null==a.leaveType)return LeavePopup.ERROR_MISSING_LEAVE_TYPE;if(null==a.duration)return LeavePopup.ERROR_INCORRECT_TIME;var c=$(b).pVal();if(""!=trim(c)){var d=UserTime.formatTime(a.duration);d!=c&&$(b).pVal(d)}return 0>a.duration&&""!=trim(c)?LeavePopup.ERROR_INCORRECT_TIME:0==a.duration?LeavePopup.ERROR_MISSING_TIME:a.duration>LeavePopup.maxLeaveDuration?LeavePopup.ERROR_TIME_EXCEEDS_WORKDAY:null},validateSelectionAndShowErrors:function(a){var b=
LeavePopup.validateSelection();if(!a||b!=LeavePopup.lastValidationResult)if(LeavePopup.leaveTypeSelect.getEl().removeClass("invalid"),LeavePopup.unmarkInvalidFieldsAndHideErrorMessage(),LeavePopup.lastValidationResult=b)switch(b){case LeavePopup.ERROR_INCORRECT_TIME:ClientSideErrors.paintElementAsInvalid(LeavePopup.timeOffField,LeavePopup.MSG_INCORRECT_TIME_TOOLTIP);break;case LeavePopup.ERROR_MISSING_LEAVE_TYPE:LeavePopup.leaveTypeSelect.getEl().addClass("invalid").attr("title",LeavePopup.MSG_MISSING_LEAVE_TYPE_TOOLTIP);
break;case LeavePopup.ERROR_TIME_EXCEEDS_WORKDAY:ClientSideErrors.paintElementAsInvalid(LeavePopup.timeOffField,LeavePopup.getTimeExceedsWorkdayMessage())}},onTimeOffFieldChange:function(){LeavePopup.validateSelectionAndShowErrors(!0)},getSelectedLeaveType:function(){return LeavePopup.leaveTypeSelect.getSelectedItem()},updateTimeOffIcon:function(){var a;a=LeavePopup.getSelectedLeaveType();null!=a?(LeavePopup.timeOffIcon.style.display="",LeavePopup.timeOffIcon.src=a.iconUrl,document.isPNGFixing&&fixTransparencyForImage(LeavePopup.timeOffIcon)):
(LeavePopup.timeOffIcon.style.display="",LeavePopup.timeOffIcon.src=imgPath("pixel.gif"))},onLeaveTypeChange:function(){LeavePopup.updateTimeOffIcon();LeavePopup.validateSelectionAndShowErrors(!1)},onTimeOffFieldFocus:function(){LeavePopup.radioButtons[LeavePopup.TIME_OFF_RADIO_BUTTON].checked=!0;LeavePopup.validateSelectionAndShowErrors(!0)},onLeaveRadioButtonClick:function(){LeavePopup.radioButtons[LeavePopup.TIME_OFF_RADIO_BUTTON].checked&&(isMSIE()||this.timeOffField.focus());LeavePopup.validateSelectionAndShowErrors(!0)},
getCurrentLeaveInfo:function(){var a;a=LeavePopup.getSelectedLeaveType();if(LeavePopup.radioButtons[LeavePopup.TIME_OFF_RADIO_BUTTON].checked){var b=$(LeavePopup.timeOffField).pVal(),b=""==trim(b)?-1:UserTime.parseTimeWithSystemSettings(b);return new DayLeaveInfo(a,b)}return new DayLeaveInfo(null,null)},hide:function(){null!=LeavePopup.leavePopup&&LeavePopup.leavePopup.isVisible()&&LeavePopup.leavePopup.clickOk()},validateAndSave:function(){if(LeavePopup.pressedButton){LeavePopup.unmarkInvalidFieldsAndHideErrorMessage();
var a=LeavePopup.getCurrentLeaveInfo(),b=LeavePopup.validateSelection();if(LeavePopup.lastValidationResult=b){var c;c=LeavePopup.leaveTypeSelect;switch(b){case LeavePopup.ERROR_INCORRECT_TIME:return LeavePopup.markFieldAsInvalidAndShowErrorMessage(LeavePopup.timeOffField,LeavePopup.MSG_INCORRECT_TIME_TOOLTIP,LeavePopup.MSG_INCORRECT_TIME_LABEL,!1),!1;case LeavePopup.ERROR_MISSING_LEAVE_TYPE:return a=messageResource.getMessage(LeavePopup.MSG_MISSING_LEAVE_TYPE_NAME),LeavePopup.markFieldAsInvalidAndShowErrorMessage(c,
a,a,!0),!1;case LeavePopup.ERROR_MISSING_TIME:return a=messageResource.getMessage(LeavePopup.MSG_MISSING_TIME_NAME,[escapeHtmlSymbols(c.options[c.selectedIndex].text.toLowerCase())]),LeavePopup.markFieldAsInvalidAndShowErrorMessage(LeavePopup.timeOffField,a,a,!1),!1;case LeavePopup.ERROR_TIME_EXCEEDS_WORKDAY:return LeavePopup.markFieldAsInvalidAndShowErrorMessage(LeavePopup.timeOffField,LeavePopup.getTimeExceedsWorkdayMessage(),LeavePopup.getTimeExceedsWorkdayMessage(),!1),!1}}LeavePopup.pressedButton.getDayLeaveInfo().equals(a)||
(LeavePopup.lastSelectedLeaveType=a.leaveType);LeavePopup.pressedButton.setDayLeaveInfo(a)}return!0},markFieldAsInvalidAndShowErrorMessage:function(a,b,c,d){void 0!=d&&d?ClientSideErrors.markSelectFieldAsInvalid(a,b,!0):ClientSideErrors.paintElementAsInvalid(a,b);LeavePopup.leavePopup.showErrorMessage(c)},unmarkInvalidFieldsAndHideErrorMessage:function(){ClientSideErrors.paintElementAsValid(LeavePopup.timeOffField);ClientSideErrors.markSelectFieldAsValid(LeavePopup.leaveTypeSelect);LeavePopup.leavePopup.hideErrorMessage()},
isOpenedAndChanged:function(){if(!LeavePopup.pressedButton)return!1;var a=LeavePopup.getCurrentLeaveInfo();return!LeavePopup.pressedButton.getDayLeaveInfo().equals(a)},getOpenedDayNumber:function(){return LeavePopup.pressedButton?LeavePopup.pressedButton.getDayOfWeekNum():null},setBeforeShowHandler:function(a){LeavePopup.beforeShowHandler=a},fillActualLeaveTypes:function(a){var b=LeaveTypesList.leaveTypes.filter(function(a){return a.isActive}),c=LeaveTypesList.leaveTypes.find(function(b){return b.id===
a&&b.isActive});LeavePopup.leaveTypeSelect.setItems(b,0<a?c:b[0])},leaveTypeIsValid:function(a){return a.isActive}},LeaveButtons={buttons:[],addButton:function(a){LeaveButtons.buttons[a.dayOfWeekNum]=a},onClick:function(a){if(!LeaveButtons.buttons[a].isDisabled()){var b=LeavePopup.getOpenedDayNumber();LeavePopup.validateAndSave()&&(LeavePopup.leavePopup.hide(),b!=a&&LeavePopup.show(LeaveButtons.buttons[a]))}},onMouseOver:function(a){LeaveButtons.buttons[a].hover()},onMouseOut:function(a){LeaveButtons.buttons[a].unhover()},
getLeaveTimeForDay:function(a){a=LeaveButtons.buttons[a];if(null==a)return 0;a=a.getDayLeaveInfo();return null==a.leaveType?0:a.duration},isLeaveInfoChanged:function(a){a=LeaveButtons.buttons[a];return null!=a?a.isChanged():!1},setDayChanged:function(a,b){LeaveButtons.buttons[a].setChanged(b)},hasChanges:function(){for(var a=0;a<LeaveButtons.buttons.length;a++)if(LeaveButtons.buttons[a].isChanged())return!0;return!1},markButtonAsInvalid:function(a,b){var c=LeaveButtons.buttons[a];null!=c&&c.markAsInvalid(b)},
markButtonAsValid:function(a){a=LeaveButtons.buttons[a];null!=a&&a.markAsValid()}};function LockTTPage(a){TemplateView.call(this,a)}
LockTTPage.prototype=_.create(TemplateView.prototype,{html:"<table cellpadding='0' cellspacing='0' border='0' width='900' align='center' class='display-for-print'>  <tr>    <td class='lockTtLeftPadding rightPadding' align='left'>      <div id='lockHeader' class='additionalLeftPadding'>        <div id='headerWidthStrut'>          <p class='pagetitle' style='margin-top: 5px'>            <span><%=lockTTTitle%></span>          </p>          <div class='messagesBottomMargin'></div>          <div id='lockTableFilter'></div>          <div id='lockedTillDateNote'></div>        </div>        <div id='topInfoPlaceHolder'></div>      </div>      <div class='lockTableWrapper'>        <div id='lockTablePlaceholder'></div>        <div id='selectionVeil' class='selectionVeil'>          <div id='veilAnimation' class='veilAnimation'></div>          <div id='veilText' class='veilText'></div>        </div>        <div id='pagerPlaceholder'></div>        <div id='emptyTable'></div>      </div>    </td>  </tr></table>",messageKeys:function(){return{lockTTTitle:"lock_tt.page.title"}},
update:function(){},afterRender:function(){}});LockTTPage.ErrorTooltip=function(a){Tooltip.call(this,a)};
LockTTPage.ErrorTooltip.prototype=_.create(Tooltip.prototype,{html:"<div id='lockTTErrorTooltip' class='lockTTErrorTooltip'><%-labelText%></div>",messageKeys:function(){return{labelText:window.EnabledFeatures.UGR&&window.EnabledFeatures.TZG?"mail_notifications.users_selector.tooltip.no_users_selected":window.EnabledFeatures.TZG?"mail_notifications.users_selector.tooltip.tgz_only.no_users_selected":window.EnabledFeatures.UGR?"mail_notifications.users_selector.tooltip.ug_only.no_users_selected":"mail_notifications.users_selector.no_users_selected"}}});
LockTTPage.ErrorTooltip.getInstance=function(){this._instance||(this._instance=(new this($("body"))).init());return this._instance};LockTTUsersButton=Ext.extend(ReportUserSelectorButton,{init:function(a){this.containerId=a.selectorId;this.predefinedUserSelection={};var b=a.userSelection;this.settedWithPredefinedValues=!!b;this.predefinedUserSelection.selectedUsers=b&&b.selectedUsers?b.selectedUsers:[];this.predefinedUserSelection.selectedGroups=b&&b.selectedGroups?b.selectedGroups:[];this.predefinedUserSelection.allUsers=b?!!b.allUsers:!0;this.predefinedUserSelection.showDisabled=b?!!b.showDisabled:!0;this.predefinedUserSelection.includeUsersWithoutData=
b?!!b.includeUsersWithoutData:!1;this.predefinedUserSelection.groupType=b?b.groupType:null;this.panel=new LockTTUsersPanel({});this.panel.setPredefinedState(this.convertPredefinedStateFromSelection(this.predefinedUserSelection));this.userSelectorMenu=new AT.SharedUserButtonMenu({panel:this.panel});this._createUserButton(this.containerId,this.userSelectorMenu,450,a);return this}});LockTTUsersPanel=Ext.extend(AT.ReportsSelectorUsersPanel,{allItemsOptionLabelKey:"users_selector.all_users",customOptionLabelKey:"users_selector.selected_users"});LockTTPage.ConfigurationPanel=function(a){TemplateView.call(this,a)};
LockTTPage.ConfigurationPanel.prototype=_.create(TemplateView.prototype,{html:"<table>  <tbody>    <tr class='reportHeaderFooterTr noprint report'>       <td id='dateRangeSelectorCell' class='headerFooterCell cellWithBorder'>          <div id='dateRangeSelector' class='customDateRangeSelectorPanel'></div>          <div id='incorrectDateTooltip' class='yellowTooltip' style='display: none;'>             <div id='incorrectDateTooltip_textPlaceholder'/>          </div>       </td>       <td class='headerFooterCell cellWithBorder chooseUserButton'>          <div id='usersSelector'>             <div class='errorIcon'></div>             <div class='commonVisibleFilterButton greyBackground'>                  <div class='mainIcon'></div>                  <div  id='usersSelectorLabel' class='label ellipsis'></div>                  <div class='downIcon'></div>             </div>          </div>       </td>       <td class='headerFooterCell cellWithBorder emptyCell'>          <div id='clearButton'>             <div><%=clearButton%></div>          </div>       </td>    </tr>  </tbody></table>",messageKeys:function(){return{clearButton:"view_tt.filter.clear_button.label"}},
update:function(){var a=this._configurationPanelWidth(LockTTStore.getDateRangeConfig());this.setHeaderWidth(a)},_configurationPanelWidth:function(a){return 49*(a.toDate.offsetInDaysFrom(a.fromDate)+1)+293},setHeaderWidth:function(a){$("#lockHeader").width(Math.max(a,900))},afterRender:function(){}});LockTTPage.FilterController=function(){};LockTTPage.FilterController.parseDateRangeConfig=function(a){return DateRangeSelectorController.prototype.parseJSON.call(this,a)};
LockTTPage.FilterController.prototype={_triggerDateRangeChange:function(){$(document).trigger("dateRangeSelector.changed",this.getDateRange())},getDateRange:function(){return this.dateSelectorController.getSelectedRange()},init:function(){this.dateSelectorController=(new DateRangeSelectorController).init({dateRangeSelection:LockTTStore.getDateRangeConfig(),dateRangeParsed:!0,rangeMinDays:7,rangeMaxDays:62,rangeTooLongMessageKey:"date_range_selector.range_error.longer_than_2_months",renderTo:"dateRangeSelector",
menuStates:this._createDateRangeMenu()});this.dateSelectorController.setOnChangeCallback(_.bind(this._triggerDateRangeChange,this));$(document).on("updateDateRange",_.bind(this.updateDateRangeSelector,this));var a={selectorId:"usersSelectorLabel",userSelection:LockTTStore.getUsersSelectorConfig(),changeCallback:function(){$(document).trigger("usersSelector.changed")}};this.userSelector=(new LockTTUsersButton).init(a);var a=LockTTStore.getUserGroupFeatureForSelector(),b=LockTTStore.getTimeZoneGroupFeatureForSelector();
this.userSelector.initializeData(a,b,LockTTStore.getUsersForSelector(),null,LockTTStore.getUsersGroupsForSelector(),LockTTStore.getTimeZonesForSelector());this.errorTooltip=LockTTPage.ErrorTooltip.getInstance();var c=$("#lockTableFilter").find(".chooseUserButton .commonVisibleFilterButton");this.userSelector.getButton().on("menuhide",function(){c.removeClass("pressed")});this.userSelector.getButton().on("menushow",function(){c.addClass("pressed")});this.errorTooltip.subscribeToMouseEvents(c);this.errorTooltip.disable();
return this},setErrorTooltipEnabled:function(a){this.errorTooltip.setEnabled(a)},getUserSelection:function(){return this.userSelector.getSelection()},setUserSelection:function(a){this.userSelector.setSelection(a)},updateDateRangeSelector:function(){this.dateSelectorController.setSelectedRange(LockTTStore.getDateRangeConfig())},_createDateRangeMenu:function(){return[new AT.CurrentWeekMenuItem,new AT.CurrentAndPreviousWeeksMenuItem,new AT.CurrentAndTwoPreviousWeeksMenuItem,AT.DateRangeSelectorSeparator,
new AT.Last7DaysMenuItem,new AT.Last14DaysMenuItem,AT.DateRangeSelectorSeparator,new AT.CurrentMonthMenuItem,new AT.PreviousMonthMenuItem,AT.DateRangeSelectorSeparator,new AT.CustomDateRangeMenuItem]}};function LockTTEmptyTable(a){TemplateView.call(this,a)}LockTTEmptyTable.prototype=_.create(TemplateView.prototype,{html:'<div class="additionalLeftPadding">  <div class="usersDeletedMsg"><%=lockTTTitle%></div></div>',messageKeys:function(){return{lockTTTitle:"lock_tt.all_selected_users_deleted"}}});var UserSelectionUtils={empty:function(a){return 0==a.allUsers&&0==a.selectedGroups.length&&0==a.selectedUsers.length},equals:function(a,b){return a.allUsers==b.allUsers&&1==b.allUsers?!0:a.allUsers==b.allUsers&&this._arrayEquals(a.selectedGroups,b.selectedGroups)&&this._arrayEquals(a.selectedUsers,b.selectedUsers)&&a.showDisabled==b.showDisabled&&a.groupType==b.groupType},_arrayEquals:function(a,b){if(a===b)return!0;if(null==a||null==b||a.length!=b.length)return!1;a.sort();b.sort();for(var c=0;c<
a.length;c++)if(a[c]!=b[c])return!1;return!0},defaultUserSelector:function(){return{allUsers:!0,selectedGroups:[],selectedUsers:[],groupType:"USER_GROUP",showDisabled:!0}}};function LockTTPager(a,b){TemplateView.call(this,a);this.selectOptions=b}
LockTTPager.prototype=_.create(TemplateView.prototype,{html:"<table class='additionalLeftPadding tablePager'>  <tr>    <td>      <%=resultsContain%>&nbsp;<span class='result-number'></span>&nbsp;<span class='endOfText'></span>      <span class='recordsPerPageSelectorContainer'>        <select>          <% _.each(selectOptions, function(pageAmount) { %>             <option value='<%=pageAmount%>'><%=pageAmount%></option>          <% }) %>        </select>&nbsp;<%=aPageText%>      </span>    </td>    <td class='columnPagerSeparator'>      <span class='pagerSeparator'></span>    </td>    <td class='pageLinksContainer'>      <div class='prevNextLinks'>        <nobr class='previousLink text'></nobr>        <span>&nbsp;&nbsp;&nbsp;</span>        <span class='pageLinks'></span>        <span>&nbsp;&nbsp;</span>        <nobr class='nextLink text'></nobr>      </div>    </td>  </tr></table>",updateOnInit:!1,
afterRender:function(){this.$endOfText=this.find(".endOfText");this.$resultNumber=this.find(".result-number");this.$selectorContainer=this.find(".recordsPerPageSelectorContainer");this.$select=this.$selectorContainer.find("select");this.$previousLink=this.find(".previousLink");this.$nextLink=this.find(".nextLink");this.$pageLinks=this.find(".pageLinks");this.$select.on("change",function(a){$(document).trigger("pager.records_per_page.change",a.target.value)})},update:function(){var a=LockTTStore.getPagerConfig();
if(_.isNull(a)||0>=a.recordsNumber)this.$el.hide();else{var b="";this.$resultNumber.text(a.recordsNumber);if(a.need){var b=this.$select.find("option"),c=b.find(":selected");c&&c.removeAttr("selected");b.each(function(){if($(this).prop("value")==a.recordsPerPage)return $(this).attr("selected","selected"),!1});this.$selectorContainer.show();b="common.end_of_results_contain_x_users_shown_by"}else b=1==a.recordsNumber?"common.user":"common.users",this.$selectorContainer.hide();this.$endOfText.text(messageResource.getMessage(b));
1<a.currentPagesCount&&this._createPageLinks(a);this.$el.toggleClass("onlyOnePage",1==a.currentPagesCount);this.$el.show()}},templateModel:function(){return{selectOptions:this.selectOptions}},messageKeys:function(){return{aPageText:"common.a_page",resultsContain:"common.results_contain",previous:"common.previous",next:"common.next"}},_createPageLinks:function(a){this.$previousLink.empty();_.isNull(a.previousPageFirstRecordNumber)?this.$previousLink.text(messageResource.getMessage("common.previous")+
" --"):this.$previousLink.append(this._createPageLink(a.previousPageFirstRecordNumber,messageResource.getMessage("common.previous"))," --");var b=this;this.$pageLinks.empty();_.each(a.pages,function(a){var d=$("<nobr class='text'></nobr>"),e=a.firstRecordNumber+1+"-"+(a.lastRecordsNumber+1);a.current?d.append(e+"&nbsp;&nbsp;&nbsp;"):d.append(b._createPageLink(a.firstRecordNumber,e),"&nbsp;&nbsp;&nbsp;");b.$pageLinks.append(d)});this.$nextLink.empty();_.isNull(a.nextPageFirstRecordNumber)?this.$nextLink.text("-- "+
messageResource.getMessage("common.next")):(this.$nextLink.append("-- "),this.$nextLink.append(this._createPageLink(a.nextPageFirstRecordNumber,messageResource.getMessage("common.next"))))},_createPageLink:function(a,b){var c=$("<a data-record='"+a+"' href='javascript:void(0);'>"+b+"</a>");c.click(function(a){$(document).trigger("pager.shown_record.change",a.target.getAttribute("data-record"))});return c}});function LockTTMessages(a,b){TemplateView.call(this,a);this.data=b}
LockTTMessages.prototype=_.create(TemplateView.prototype,{html:'<% if (hasMessages) { %><table cellpadding="0" cellspacing="0" border="0" id="MessagesTable">  <tr>    <td valign="top" class="messageIcon"><img src="<%=successImg%>"/></td>    <td valign="top">      <table border="0" cellspacing="0" cellpadding="0" id="SuccessMessages">        <tr><td valign="top" style="padding-left:6px;"><span class="successmsg"><%=messages%></span></td></tr>      </table>    </td>  </tr></table><% } %><% if (hasErrors || hasWarnings) { %><table cellpadding="0" cellspacing="0" id="ErrorsTable">  <tr>    <td valign="top" class="messageIcon"><img src="<%=errorImg%>"/></td>    <td valign="top">      <table border="0" cellspacing="0" cellpadding="0">        <% if (hasErrors) { %>          <tr><td valign="top" style="padding-left:6px;"><span class="errormsg"><%=errors%></span></td></tr>        <% } %>        <% if (hasWarnings) { %>          <tr><td valign="top" style="padding-left:6px;"><span class="errormsg"><%=warnings%></span></td></tr>        <% } %>        <% if (hasAdditionalError) { %>          <tr><td valign="top" style="padding-left:6px;"><span class="errormsg"><%=additionalError%></span></td></tr>        <% } %>      </table>    </td>  </tr></table><% } %>',templateModel:function(){return this.data}});function LockTTTopInfo(a){TemplateView.call(this,a);this.dateFormat=new DateFormat(SystemSettings.dateFormat)}
LockTTTopInfo.prototype=_.create(TemplateView.prototype,{html:"<table class='topInfo' border='0' cellpadding='0' cellspasing='0' id='topPagerWidthStruct'>  <tr>    <td></td>    <td class='text lockedTillDateColumn'>      <span>        <img src='<%=unlockImg%>' class='lockImg'/>        <span class='ttOfSelectedUsersText'></span>        <span id='lockedTillDate'></span>      </span>    </td>    <td class='lockTTLegend' style='float: right'>      <table>        <tr>          <td style='width:18px;'>            <span class='legendSeparator'></span>          </td>          <td style='padding-right: 20px'>            <div class='legendCell lockedCell'></div>            <span class='legendTextType'><%=legendLocked%></span>          </td>          <td style='padding-right: 20px'>            <div class='legendCell approveAndLockedCell'></div>            <span class='legendTextType'><%=legendApproveAndLocked%></span>          </td>          <td width='75px'>            <div class='legendCell approveCell'></div>            <span class='legendTextType'><%=legendApproved%></span>          </td>        </tr>      </table>    </td>  </tr></table>",updateOnInit:!1,
templateModel:function(){return{unlockImg:atImgPath("/unlock.png")}},messageKeys:function(){return{legendLocked:"lock_tt.legend.locked",legendApproveAndLocked:"lock_tt.legend.approve_and_locked",legendApproved:"lock_tt.legend.approved"}},afterRender:function(){this.$ttOfSelectedUsersText=this.find(".ttOfSelectedUsersText");this.$lockedTillDate=this.find("#lockedTillDate")},update:function(){var a=LockTTStore.getPagerConfig();_.isNull(a)||0>=a.recordsNumber?this.$el.hide():(this.$el.toggleClass("hideLegend",
!LockTTStore.getEnabledFeatures().TTA),this.updateTillDate(),this.$el.show())},updateTillDate:function(){var a=LockTTStore.getLockedTillDate(),b=LockTTStore.getPagerConfig(),c=_.isNull(a);this.$el.toggleClass("hideLockedTillDate",c);c||(b=1==b.recordsNumber?messageResource.getMessage("lock_tt.tt_of_selected_user_is_completely_locked_till"):messageResource.getMessage("lock_tt.tt_of_selected_users_is_completely_locked_till",[b.recordsNumber]),this.$ttOfSelectedUsersText.empty(),this.$ttOfSelectedUsersText.append(b),
this.$lockedTillDate.empty(),b=LockTTStore.getDateRangeConfig(),a>=b.fromDate&&a<=b.toDate?this.$lockedTillDate.append($("<b>"+this.dateFormat.formatDate(a)+"</b>")):(a=$("<a href='javascript:void(0);'>"+this.dateFormat.formatDate(a)+"</a>"),a.click(function(){$(document).trigger("navigate.till_lock_date")}),this.$lockedTillDate.append(a)))}});function ViewTTPage(a){TemplateView.call(this,a)}
ViewTTPage.prototype=_.create(TemplateView.prototype,{html:"<div id='viewTTContent' style='display: none'>  <div id='viewTTPrintHeaderContainer'></div>  <table class='viewTTHeader noprint' cellpadding='0' cellspacing='0'><tr>    <td class='viewTimeTrackTitle pagetitle'><span><%=viewTTFor%></span></td>    <td class='userSelectorTd pagetitle'><table cellpadding='0' cellspacing='0'><tr>         <td class='selectorInputTd'><div id='singleUserSelector'></div></td>         <td class='userSelectorButton'><div class='userNameWrapper'><span class='dashedLink'></span></div><span class='arrow'></span></td>         <td class='backToMySheet'><span class='backToMyTTSeparator'></span></td>         <td class='backToMySheet backToMyTTImg'></td>         <td class='backToMySheet backToMyTTLabel'><a class='backToMyTtText link'><%=backToMe%></a></td>    </tr></table></td>    <td class='balancesViewerOuterPlaceholder'>      <div id='balancesViewerSpinner'></div>      <div id='balancesViewerPlaceholder'></div>    </td>  </tr></table>  <div class='viewTTChartPanel'>    <table class='viewTTFilterPanel noprint' cellspacing='0' cellpadding='0'>         <tr>            <td id='dateRangeSelectorCell' class='dateRangeSelectorCell headerFooterCell cellWithBorder'>                <div id='viewTTDateSelector' class='viewTTDateSelector customDateRangeSelectorPanel'></div>            </td>            <td class='filterPane cellWithBorder'><table class='filterPaneContent'  cellspacing='0' cellpadding='0'><tr id='viewTTFilterContainer'>                <td class='filterEditButton headerFooterCell activeButton'>                    <div class='filterButtonContainer'>                         <div class='errorIcon'></div>                         <div class='commonVisibleFilterButton greyBackground'>                             <div class='mainIcon'></div>                             <div class='label ellipsis'><%=viewTTFilterEdit%></div>                             <div class='downIcon'></div>                         </div>                    </div>                </td>                <td class='noTTACPSelector activeButton'>                    <div class='filterButtonContainer'>                         <div class='errorIcon'></div>                         <div class='commonVisibleFilterButton greyBackground'>                             <div class='mainIcon'></div>                             <div class='label ellipsis'></div>                             <div class='downIcon'></div>                         </div>                    </div>                </td>                <td class='filterClearButtonWrap headerFooterCell'>                    <div class='filterClearButton clearIcon' title='<%=viewTTFilterClear%>'><div class='text'><%=viewTTFilterClear%></div></div>                </td>                <td style='display:none'>                    <div id='noTTACPSelector'/>                </td>            </tr></table></td>            <td class='generatePDF headerFooterCell activeButton cellWithBorder'>                <%=exportPdfLabel%>            </td>         </tr>    </table>    <div id='filterDialog' class='viewTTFilterDialog noprint'></div>    <div class='chartPanelContent'>        <div id='viewTTTotals' class='viewTTTotals'></div>        <div id='viewTTChartSectionContainer'></div>    </div>  </div>  <div id='viewTTExportPdfDisabledTooltip' class='yellowTooltip' style='display: none;'>    <div id='viewTTExportPdfDisabledTooltip_textPlaceholder'><%=exportPdfDisabledTooltip%></div>  </div>  <div id='viewTTDetailsTableContainer' class='viewTTDetailsTableContainer'></div>  <div id='viewTTPrintFooter' class='for-print-only'>    <span class='signatureField'>Signature</span>    <span class='gapField'></span>    <span class='signatureField'>Date</span>  </div>  <div id='viewTTUsersSelectorWarning'></div>  <div id='incorrectDateTooltip' class='yellowTooltip tooltipText' style='display: none;'>     <div id='incorrectDateTooltip_textPlaceholder'/>  </div></div>",templateModel:function(){return{}},
messageKeys:function(){return{viewTTFilterEdit:"view_tt.filter.edit_button.label",viewTTFilterClear:"view_tt.filter.clear_button.label",exportPdfLabel:"view_tt.export.pdf.label",viewTTFor:"view_tt.title",backToMe:"usersselector.back_to_me",exportPdfDisabledTooltip:"common.export.pdf.disabled_tooltip"}},update:function(){this.$chartPanel.toggleClass("chartVisible",ViewTTStore.getChartSectionConfig().showChart)},afterRender:function(){this.$chartPanel=this.find(".chartPanelContent");var a=(new LoadingMoire(ViewTTPageUtils.SPINNER_SETTINGS)).init(this.$chartPanel);
$(document).on("viewTT.beginLoadData",function(){a.show()});$(document).on("viewTT.endLoadData",function(){a.hide()});var b=this;$(ViewTTStore).on("chartSectionConfigChange",function(){b.update()});var c=this.find(".generatePDF");if(isOldIE()){var d=(new TableTooltip).init("viewTTExportPdfDisabledTooltip");c.addClass("disabled");c.hover(function(){d.show()},function(){d.hide()});c.mousemove(function(a){d.move(calculateTooltipOffset(d,a))})}else{var e=!0;$(document).on("viewTT.beginLoadData",function(){e=
!1;c.toggleClass("disabled",!0)});$(document).on("viewTT.endLoadData",function(){e=!0;c.toggleClass("disabled",!1)});this.findAndBindClick(".generatePDF",function(){e&&$(document).trigger("viewTT.showPDFPreview")})}$(document).on("viewTT.init",function(){b.update();b.$el.atAnimation().fadeIn()})},showPageComponents:function(){this.find(".viewTTChartPanel").addClass("showViewTTChartPanel")}});ViewTTPageUtils={tablePresentDataByDays:function(){var a=[],b=ViewTTStore.getData(),c=ViewTTStore.getDetailsTableConfig().asc,d=ViewTTPageUtils.isFeatureEnabled(Features.TTA),e=ViewTTStore.getFilter(),f=_.create(null);_.each(e.weekApprovalStatuses,function(a){f[a]=a});for(e=0;e<b.daysInfoData.length;e++){var g=b.daysInfoData[c?e:b.daysInfoData.length-e-1],h=g.approvalStatus;if(!d||h==EffectiveWeekApprovalStatus.AUTO_APPROVED||f.hasOwnProperty(h)){a.push({type:ViewTTPageUtils.RowType.DAY,dayModel:g});
var k=[];g.leave&&0<g.leave.leaveTime&&k.push({type:ViewTTPageUtils.RowType.LEAVE,dayModel:g});_.each(g.ttRecords,function(a){k.push({type:ViewTTPageUtils.RowType.TASK_BY_DAY,dayModel:g,taskModel:a})},this);_.isObject(g.otherTTInfo)&&k.push({type:ViewTTPageUtils.RowType.OTHER_SPENT_BY_DAY,dayModel:g});g.overtime&&(h=_.isNumber(g.overtime.reported)?g.overtime.reported:g.overtime.auto,(_.isNumber(h)&&0!=h||0==h&&h!=g.overtime.auto)&&k.push({type:ViewTTPageUtils.RowType.OVERTIME,dayModel:g}));0<k.length&&
(_.last(k).last=!0,_.each(k,function(b){a.push(b)}))}}return a},tablePresentDataByCP:function(){for(var a=[],b=ViewTTStore.getData(),c=ViewTTStore.getDetailsTableConfig().asc,d=b.customersData.customersTTData,e=0;e<d.length;e++){var f=d[c?e:d.length-e-1];a.push({type:ViewTTPageUtils.RowType.CUSTOMER,customerModel:f});_.each(f.projectTTData,function(b){a.push({type:ViewTTPageUtils.RowType.PROJECT,projectModel:b});_.each(b.taskTTData,function(c,d){a.push({type:ViewTTPageUtils.RowType.TASK_BY_CP,taskModel:c,
last:d==b.taskTTData.length-1})},this)},this)}_.isObject(b.customersData.otherTTInfo)&&a.push({type:ViewTTPageUtils.RowType.OTHER_SPENT_BY_CP,otherTTInfo:b.customersData.otherTTInfo});return a},leaveTotalsOrderedIterate:function(a,b){_.each(LEAVE_TYPES_ORDERED,function(c){var d=_.matcher({leaveTypeId:c.id}),d=_.find(a,d);_.isObject(d)&&b(c,d.leaveTime)})},isFeatureEnabled:function(a){return!_.isUndefined(ViewTTStore.getEnabledFeatures()[a])},createEnterTTURL:function(a){var b=ViewTTStore.getSelectedUserId();
return window.EnterTTUrlUtils.makeEnterTTUrl(a,b)},updateName:function(a,b){_.each(a,function(a){var d=b[a.id];_.isUndefined(d)||(a.name=d.name)})},updateCPList:function(a,b){ViewTTPageUtils.updateName(a.customers,b.customersById);ViewTTPageUtils.updateName(a.projects,b.projectsById)},customerComparator:function(a,b){if(a.id==b.id)return 0;var c=a.name.toLowerCase();return b.name.toLowerCase()<c?1:-1},getProjectComparator:function(a){return function(b,c){var d=ViewTTPageUtils.customerComparator(a[b.customerId],
a[c.customerId]);if(0!==d)return d;d=b.name.toLowerCase();return c.name.toLowerCase()<d?1:-1}},mergeCPLists:function(a,b,c){var d=this.orderLists(a.customersById,b.customers,c.customers,ViewTTPageUtils.customerComparator);return{customers:d,projects:this.orderLists(a.projectsById,b.projects,c.projects,ViewTTPageUtils.getProjectComparator(arrayToMapById(d)))}},orderLists:function(a,b,c,d){b=b.slice();for(var e=0;e<c.length;e++){var f=c[e];a[f.id]||b.push(f)}b.sort(d);return b},getChartTypeMessage:function(a){var b;
switch(a){case ViewTTChartType.BY_DAYS:b="view_tt.chart.view_by_days";break;case ViewTTChartType.BY_CUSTOMERS:b="view_tt.chart.view_by_customers";break;case ViewTTChartType.BY_PROJECTS:b="view_tt.chart.view_by_projects"}return messageResource.getMessage("view_tt.chart.view_by",[messageResource.getMessage(b)])},calculateTotalSpent:function(a){var b=a.totalWorking;a.totalLeaveTime&&(b+=a.totalLeaveTime);return b},calculateTotalSpentForToday:function(a){var b=a.totalWorkingForToday;a.totalLeaveTimeForToday&&
(b+=a.totalLeaveTimeForToday);return b},calculateOvertime:function(a){var b=0,c=0;a.totalOvertimeInfo&&(b=a.totalOvertimeInfo.reported,c=a.totalOvertimeInfo.auto||0,_.isNumber(b)||(b=c));return{reported:b,auto:c}},makeStatusFilterToDisplay:function(a){return _.isNull(a)?null:ViewTTStore.getUserInfo().autoApproved?[WeekApprovalStatus.APPROVED]:a},RowType:{DAY:1,TASK_BY_DAY:2,TASK_BY_CP:3,PROJECT:4,CUSTOMER:5,LEAVE:6,OVERTIME:7,OTHER_SPENT_BY_DAY:8,OTHER_SPENT_BY_CP:9},SPINNER_SETTINGS:{lines:12,length:9,
width:5,radius:11}};ViewTTPage.BalancesViewerController=function(a){BaseBalancesViewerController.call(this,a)};
ViewTTPage.BalancesViewerController.prototype=_.create(BaseBalancesViewerController.prototype,{init:function(){BaseBalancesViewerController.prototype.init.call(this);$(ViewTTStore).on("balancesDataChange",_.bind(this._updateBalances,this));return this},createBalanceViewer:function(a){return new BalancesViewer(a)},getUserWorkScheduleData:function(){return ViewTTStore.getBalancesViewerConfig()},getFormatterSettings:function(){return ViewTTStore.getFormatterConfig()},onDateChange:function(a,b){$(document).trigger("viewTT.balancesViewerDateChange",
b)},_updateBalances:function(){var a=ViewTTStore.getBalancesData(),b=ViewTTStore.getBalancesViewerDate(),c=this.balancesViewer.isDisplayedPto(),d=this.balancesViewer.isDisplayedSick(),e=ViewTTPageUtils.isFeatureEnabled(Features.PTO),f=ViewTTPageUtils.isFeatureEnabled(Features.SDB),g=ViewTTStore.getSelectedUserId();!e&&c||!f&&d?alert(messageResource.getMessage("view_tt.balances_viewer.turn_off",[messageResource.getMessage(f||e?e?"view_tt.balances_viewer.sick_calculation":"view_tt.balances_viewer.pto_calculation":
"view_tt.balances_viewer.all_calculations")])):g===this.previousUserId&&(!a.displayPto&&c||!a.displaySick&&d)&&(c=a.displayPto||a.displaySick?a.displayPto?"view_tt.balances_viewer.sick_control":"view_tt.balances_viewer.pto_control":"view_tt.balances_viewer.all_controls",alert(messageResource.getMessage("view_tt.balances_viewer.turn_off_controls",[messageResource.getMessage(c)])));this.previousUserId=g;BaseBalancesViewerController.prototype.updateBalances.call(this,b,a);$(document).trigger("viewTT.balanceViewer.update")},
hide:function(){this.balancesViewer.hide();this.spinner.stop();$(document).trigger("viewTT.balanceViewer.hide")},getViewerDate:function(){return this.balancesViewer.getDate()},setDate:function(a){this.balancesViewer.setDate(a)}});ViewTTPage.PDFPreviewLightbox=function(){};
ViewTTPage.PDFPreviewLightbox.prototype=_.create(BasicLightbox.prototype,{exist_invalid_fields_message_key:"",close_tab_confirmation_message_key:"",init:function(a){BasicLightbox.prototype.init.call(this,a.popupId,a.closeBtnId);var b=this;this.titleEl=$(this.lightBoxEl).find(".lightBoxTitle");this.setCancelCallback(function(){b.hide()});this.reloadPageAfterClose=!1;this.formatter=new BaseFormatterCreator;this.pdfPreviewViewController=(new ViewTTPDFPreviewLightboxController).init(this.lightBoxEl,this.titleEl,
a.popupId);return this},show:function(){BasicLightbox.prototype.show.call(this);this.pdfPreviewViewController.onShow();$(document).trigger("viewTT.pdfPreview.lightbox.show")},hide:function(){$(document).trigger("viewTT.pdfPreview.lightbox.hide");BasicLightbox.prototype.hide.call(this)},cancelAllExportingProcesses:function(){this.pdfPreviewViewController.cancelAllExportingProcesses()}});ViewTTPage.ViewTTCPSelector=function(){};
ViewTTPage.ViewTTCPSelector.prototype=_.create(CPReportSelector.prototype,{_createDropDownButton:function(a){return new ViewTTPage.ViewTTCPSelectorDropDownButton(a)},_initDropDownButton:function(a){CPReportSelector.prototype._initDropDownButton.call(this,a);this.button.init(this)},_removeDeletedCPFromSelection:function(a,b){var c=arrayToMapById(a.customers),d=arrayToMapById(a.projects);this._removeObsoleteItems(b.customers,c);this._removeObsoleteItems(b.projects,d);var e=this.predefinedState;this._removeObsoleteItems(e.selection.getFirstLevel(),
c);this._removeObsoleteItems(e.selection.getSecondLevel(),d)},_removeObsoleteItems:function(a,b){for(var c=a.length-1;0<=c;c--)b[a[c]]||a.splice(c,1)},remakeSelector:function(){if(this.panel.isAlreadyShown()){$(this.panel.treePanel).empty();this.panel.initializeSelector(this.preloadedData);var a=ViewTTStore.getFilter().cpSelection.showArchivedProjects;this.panel.activeOnlySet=a;this.panel.selectorFilter.setShowInactiveAndReFilter(a,!0);this.setInitialValueFromCurrent()}},markAsInvalid:function(){this.button._invalidateCPListStatus()},
isValid:function(){return this.button.isCPListValid}});ViewTTPage.ViewTTCPSelectorDropDownButton=function(a){AT.HierarchySelectorDropdownButton.call(this,a)};
ViewTTPage.ViewTTCPSelectorDropDownButton.prototype=_.create(AT.HierarchySelectorDropdownButton.prototype,{init:function(a){this.cpSelector=a;$(ViewTTStore).on("dataChange",_.bind(this._invalidateCPListStatus,this));this._invalidateCPListStatus();return this},showMenu:function(){this.isCPListValid||(this.isCPListValid=!0,this.cpSelector.remakeSelector());return this._showMenu()},_invalidateCPListStatus:function(){this.cpSelector.initializeData(this._cpList());this.cpSelector.setSelection(ViewTTStore.getFilter().cpSelection);
this.isCPListValid=!1;$(this.cpSelector).trigger("selectionChange")},_cpList:function(){return ViewTTStore.getMergedCpList()},_showMenu:function(){return AT.HierarchySelectorDropdownButton.prototype.showMenu.call(this)}});ViewTTPage.UsersSelector=function(){BaseUsersSelector.call(this)};
ViewTTPage.UsersSelector.prototype=_.create(TTUsersSelector.prototype,{init:function(a,b,c){var d=messageResource.getMessage("usersselector.please_select_a_user");TTUsersSelector.prototype.init.call(this,a,b,-1==c?null:c,d,"",0,"usersSelectorOnTT",EnabledFeatures.UGR,EnabledFeatures.TZG);$(".viewTimeTrackTitle").html("<span>"+messageResource.getMessage("view_tt.title.for")+"</span>");$(ViewTTStore).on("dataConfigRestored",_.bind(this._reInit,this))},_getLoggedInUserId:function(){return ViewTTStore.getViewerId()},
_reInit:function(){this.usersCombo.setValue(ViewTTStore.getSelectedUserId());this.updateUI()},onUserSelect:function(a){$(document).trigger("viewTT.selectedUserChange",a);this.usersCombo.setValue(a);this.updateUI()},needToRenderSelector:function(){return ViewTTStore.isNeedToRenderUsersSelector()}});ViewTTPage.Totals=function(a){TemplateView.call(this,a)};
ViewTTPage.Totals.prototype=_.create(TemplateView.prototype,{html:"<div class='totalsRow'>     <div class='totalsForPeriodCell totalsCell'><div id='totalsForPeriod' class='totalsForPeriod'>         <div id='totalsForPeriodLabel' class='totalsLabel'><%=totalsLabel%></div>          <div id='totalsForPeriodTable' class='totalTimeTablePlaceholder'/>     </div></div>     <div id='totalsWorking' class='totalsWorkingCell totalsCell'><div class='workingTime dl'>         <span><%=totalsWorkingTime%></span>         <span id='totalsWorkingTime' class='totalValue'/></div>         <div class='regularWorking dl'>             <div class='marker markerWT dt'><img src='<%=markerWTUrl%>'/><span><%=workingHours%></span></div>             <div class='markedTotal dd'><span id='regularWorkingTime'/></div>         </div>     </div>     <div id='totalsLeave' class='totalsLeaveCell totalsCell'><div class='leaveTime dl'>         <div class='totalsList totalsTimeHeader'>             <span><%=totalsLeaveTime%></span>             <span id='totalsLeaveTime' class='totalValue'/>         </div>         <div id='totalsLeaveTypesWrap' class='leaveTypes'><div class='totalsList'><div id='totalsLeaveTypes'/></div></div>     </div></div>     <div id='totalsOvertimeList' class='overtime dl'>         <div>             <div class='marker markerOT dt'><img src='<%=markerOTUrl%>'/><span><%=totalsOvertime%></span></div>             <div class='markedTotal dd'><span id='totalsOvertime'/></div>         </div>         <div class='totalAutoOvertimeRow'>             <div class='dt'><span><%=totalsAutoOvertime%></span></div>             <div class='dd'><span id='totalsAutoOvertime'/></div>         </div>     </div></div>",messageKeys:function(){return{totalsWorkingTime:"view_tt.totals.total_working_time",
workingHours:"view_tt.totals.regular_working",totalsOvertime:"view_tt.totals.overtime",totalsAutoOvertime:"view_tt.totals.auto_overtime",totalsLeaveTime:"view_tt.totals.leave_time",totalsLabel:"view_tt.totals.period"}},templateModel:function(){return{markerWTUrl:atImgPath("viewtt/marker_wt.png"),markerLTUrl:atImgPath("viewtt/marker_lt.png"),markerOTUrl:atImgPath("viewtt/marker_ot.png")}},afterRender:function(){this.totalTimeTable=(new ViewTTPage.TotalTimeTable($("#totalsForPeriodTable"))).init();
this.totalsForPeriod=(new ViewTTPage.TotalsForPeriod).init($("#totalsForPeriod"));this.totalsWorkingTime=(new ViewTTPage.TotalsWorkingTime).init($("#totalsWorking"));this.totalsLeaveTime=(new ViewTTPage.TotalsLeaveTime).init($("#totalsLeave"));this.totalsOvertime=(new ViewTTPage.TotalsOvertime).init($("#totalsOvertimeList"));$(ViewTTStore).on("dataChange",_.bind(this._changeTotals,this))},_changeTotals:function(){var a=ViewTTStore.getData();if(a){var b=null!==a.totalOvertimeInfo,c=null!==a.totalLeaveTime,
d=null!==a.effectiveDuration;this.totalsLeaveTime.$containerEl.toggleClass("withLeaveTime",c);this.totalsWorkingTime.$containerEl.toggleClass("withWorkingTime",b||c);this.totalsForPeriod.$containerEl.parent().toggleClass("single",!(b||c));this.$el.toggleClass("withScheduled",d);this.totalsWorkingTime.$containerEl.toggleClass("withOvertime",b);this.totalsWorkingTime.$containerEl.append(this.totalsOvertime.$containerEl);this.totalsOvertime.changeTotals(a);this.totalsForPeriod.changeTotals(a);this.totalsWorkingTime.changeTotals(a);
this.totalsLeaveTime.changeTotals(a)}},update:function(){this.totalsForPeriod._changeDateRange();this._changeTotals()}});ViewTTPage.TotalTimeTable=function(a){TemplateView.call(this,a)};
ViewTTPage.TotalTimeTable.prototype=_.create(TemplateView.prototype,{html:"<table class='display-for-print totalTimeTable'> <thead><tr><th></th><th class='reported'><%=reported%></th><th class='scheduled'><%=scheduled%></th></tr></thead> <tr class='rangeTotal'>     <td class='label'></td>     <td class='reported'><span class='value'/></td>     <td class='scheduled'><%=of%><span class='value'/></td></tr><tr class='forTodayTotal'>     <td class='label'><%=today%></td>     <td class='reported'><span class='value'/></td>     <td class='scheduled'><%=of%><span class='value'/></td></tr></table><div class='totalDiff'><span class='value'/><span class='diffMessage'/></div>",messageKeys:function(){return{reported:"view_tt.totals.reported",
scheduled:"view_tt.totals.scheduled",of:"view_tt.totals.of",today:"view_tt.totals.today"}}});ViewTTPage.TotalsForPeriod=function(){};
ViewTTPage.TotalsForPeriod.prototype={monthName:function(a){var b=new Date;b.setMonth(a,1);return this.monthDateFormat.formatDate(b)},_currentMonth:function(){return currentUserTime().getMonth()},monthDateFormat:new DateFormat("MMMM"),init:function(a){this.$containerEl=a;this.$label=$("#totalsForPeriodLabel");this.$rangeTotal=a.find(".rangeTotal");this.$forTodayTotal=a.find(".forTodayTotal");this.$totalDiff=a.find(".totalDiff");return this},formatDateQualifier:function(a){switch(a){case DateRangeSelectionQualifier.CURRENT_MONTH:return this._currentMonthLabel();case DateRangeSelectionQualifier.PREVIOUS_MONTH:return this._prevMonthLabel();
case DateRangeSelectionQualifier.CURRENT_WEEK:return messageResource.getMessage("view_tt.totals.period.current_week");case DateRangeSelectionQualifier.PREVIOUS_WEEK:return messageResource.getMessage("view_tt.totals.period.previous_week");case DateRangeSelectionQualifier.CURRENT_QUARTER:return messageResource.getMessage("view_tt.totals.period.current_quarter");case DateRangeSelectionQualifier.PREVIOUS_QUARTER:return messageResource.getMessage("view_tt.totals.period.previous_quarter");case DateRangeSelectionQualifier.CUSTOM:return messageResource.getMessage("view_tt.totals.period.custom_range");
default:return messageResource.getMessage("common.not_available")}},_changeDateRange:function(){var a=ViewTTStore.getDateRangeConfig();a&&(a=this.formatDateQualifier(a.qualifier),this.setPeriod(a))},changeTotals:function(a){this._changeDateRange();var b=ViewTTPageUtils.calculateTotalSpent(a);this.$rangeTotal.find(".reported .value").text(UserTime.formatTimeWithDigitSeparator(b));_.isNull(a.effectiveDuration)||this.$rangeTotal.find(".scheduled .value").text(UserTime.formatTimeWithDigitSeparator(a.effectiveDuration));
var c=0;_.isNull(a.totalWorkingForToday)?(_.isNull(a.effectiveDuration)||(c=b-a.effectiveDuration),this.$forTodayTotal.hide()):(b=ViewTTPageUtils.calculateTotalSpentForToday(a),this.$forTodayTotal.find(".reported .value").text(UserTime.formatTimeWithDigitSeparator(b)),_.isNull(a.effectiveDurationForToday)||(this.$forTodayTotal.find(".scheduled .value").text(UserTime.formatTimeWithDigitSeparator(a.effectiveDurationForToday)),c=b-a.effectiveDurationForToday),this.$forTodayTotal.show());a=ViewTTStore.getDateRangeConfig().fromDate>
ViewTTStore.getUserInfo().today;0===c||a?this.$totalDiff.hide():(this.$totalDiff.find(".value").text(UserTime.formatTimeWithDigitSeparator(0<c?c:-c)),this.$totalDiff.find(".diffMessage").text(messageResource.getMessage(0<c?"view_tt.totals.diff.more":"view_tt.totals.diff.less")),this.$totalDiff.toggleClass("less",0>c),this.$totalDiff.toggleClass("more",0<c),this.$totalDiff.show())},_currentMonthLabel:function(){return this.monthName(this._currentMonth())},_prevMonthLabel:function(){var a=this._currentMonth()||
12;return this.monthName(a-1)},setPeriod:function(a){this.$rangeTotal.find(".label").text(messageResource.getMessage("view_tt.totals.for",[a]))}};ViewTTPage.TotalsWorkingTime=function(){};ViewTTPage.TotalsWorkingTime.prototype={init:function(a){this.$containerEl=a;this.$workingTime=$("#totalsWorkingTime");this.$regularTime=$("#regularWorkingTime");return this},changeTotals:function(a){this.$workingTime.text(UserTime.formatTimeWithDigitSeparator(a.totalWorking));var b=ViewTTPageUtils.calculateOvertime(a);this.$regularTime.text(UserTime.formatTimeWithDigitSeparator(a.totalWorking-b.reported))}};ViewTTPage.TotalsLeaveTime=function(){};
ViewTTPage.TotalsLeaveTime.prototype={init:function(a){this.$containerEl=a;this.$leaveTime=$("#totalsLeaveTime");this.$leaveTypes=$("#totalsLeaveTypes");this.leaveTypeTemplate=_.template("<div class='marker markerLT dt' title='<%-name%>'><img src='<%=markerLTUrl%>'/><span><%-name%></span></div><div class='markedTotal dd'><span><%=value%></span></div>");a=$("#totalsLeaveTypesWrap");this.customScroll=ScrollUtils.addVerticalScroll(a,{isFaded:!1});return this},changeTotals:function(a){this.$leaveTime.text(UserTime.formatTimeWithDigitSeparator(a.totalLeaveTime||
0));this.$leaveTypes.empty();if(a=a.leaveTimeTotals){var b=this;ViewTTPageUtils.leaveTotalsOrderedIterate(a,function(a,d){b.addLeaveType(a.name,d)})}ScrollUtils.refreshCustomScroll(this.customScroll)},addLeaveType:function(a,b){this.$leaveTypes.append(this.leaveTypeTemplate({name:a,value:UserTime.formatTimeWithDigitSeparator(b),markerLTUrl:atImgPath("viewtt/marker_lt.png")}))}};ViewTTPage.TotalsOvertime=function(){};
ViewTTPage.TotalsOvertime.prototype={init:function(a){this.$containerEl=a;this.$overTime=$("#totalsOvertime");this.$autoOvertime=$("#totalsAutoOvertime");this.$overTimeMarker=$(".markerOT img");return this},changeTotals:function(a){a=ViewTTPageUtils.calculateOvertime(a);this.$containerEl.toggleClass("hasReportedOvertime",a.reported!=a.auto);var b=0!==a.reported?atImgPath("viewtt/marker_ot.png"):atImgPath("viewtt/marker_zero_ot.png");this.$overTimeMarker.attr("src",b);this.$overTime.text(UserTime.formatTimeWithDigitSeparator(a.reported));
this.$autoOvertime.text(UserTime.formatTimeWithDigitSeparator(a.auto))}};ViewTTPage.ChartSection=function(a){TemplateView.call(this,a)};
ViewTTPage.ChartSection.prototype=_.create(TemplateView.prototype,{html:"<div class='viewTTChartSection'>    <div class='containerHeader'>        <span class='selectorLabel'><%=viewChartByLabel%></span><span class='selectorLink'><span class='selectorLinkText'></span></span>        <div class='collapseButton noprint'></div>    </div>    <div class='chartContainerWrapper'>        <div id='viewTTChartContainer' class='chartContainer'></div>        <div id='viewTTChartContainerHidden' class='hiddenChartContainer'></div>    </div></div>",afterRender:function(){this.config=
ViewTTStore.getChartSectionConfig();this.$selectorLink=this.find(".selectorLink");this.$collapseBtn=this.find(".collapseButton");this.$chartContainer=this.find(".chartContainer");this.$hiddenChartContainer=this.find(".hiddenChartContainer");this._initChartSelector(this.config.chartType);this.$collapseBtn.on("click",_.bind(this._onCollapseExpandButtonClick,this))},update:function(){this._updateChartSelectorLinkText(this.config.chartType);this._updateCollapseExpandButton(this.config.showChart);this.$el.toggleClass("noprint",
!this.config.showChart)},messageKeys:function(){return{viewChartByLabel:"view_tt.chart.view_by_label"}},hideChartContainer:function(){this.$chartContainer.hide()},showChartContainer:function(){this.$chartContainer.show()},updateSizesForHiddenChartContainer:function(a,b){this.$hiddenChartContainer.css("height",a).css("width",b)},clearHiddenChartContainer:function(){this.$hiddenChartContainer.empty()},showEmptyDataMessage:function(){this.$chartContainer.empty();this.$chartContainer.append("<div class='noData'>"+
messageResource.getMessage("view_tt.chart.no_data")+"</div>")},_initChartSelector:function(a){var b=(new ViewTTPage.ChartSection.ChartTypeSelector($("body"),a)).init();$(b).on("chartTypeChanged",_.bind(this._onChartTypeChanged,this));this.$selectorLink.on("click",function(){b.showAt($(this))})},_updateChartSelectorLinkText:function(a){this.find(".selectorLinkText").text(ViewTTPageUtils.getChartTypeMessage(a))},_onCollapseExpandButtonClick:function(){this.config.showChart=!this.config.showChart;this._onChartSectionConfigChanged()},
_onChartTypeChanged:function(a,b){this.config.chartType!=b&&(this.config.showChart=!0);this.config.chartType=b;this._onChartSectionConfigChanged()},_updateCollapseExpandButton:function(a){this.$collapseBtn.toggleClass("collapsed",!a)},_onChartSectionConfigChanged:function(){this.update();$(document).trigger("viewTT.chartSection.change",this.config)},updateChartContainerHeight:function(a){this.$chartContainer.css("height",a)}});ViewTTPage.ChartController=function(){};
ViewTTPage.ChartController.prototype={DEFAULT_CHART_SIZE:{height:300,width:750},init:function(){this._viewTTChartContainerId="viewTTChartContainer";this._viewTTChartContainerIdForExport="viewTTChartContainerHidden";this._chartSection=(new ViewTTPage.ChartSection($("#viewTTChartSectionContainer"))).init();this._renderChartMoire=(new LoadingMoire(ViewTTPageUtils.SPINNER_SETTINGS)).init(this._chartSection.find(".chartContainerWrapper"));this._columnChartGenerator=(new ViewTTPageColumnChartGenerator).init(this.DEFAULT_CHART_SIZE);
this._pieChartByCustomersGenerator=(new ViewTTPage.PieChartByCustomersGenerator).init(this.DEFAULT_CHART_SIZE);this._pieChartByProjectsGenerator=(new ViewTTPage.PieChartByProjectsGenerator).init(this.DEFAULT_CHART_SIZE);var a=this;$(ViewTTStore).on("dataChange",function(){a._isNeedRebuildChart=!0;a.showChart()});$(ViewTTStore).on("chartSectionConfigChange",function(){var b=ViewTTStore.getChartSectionConfig();a._isChartVisible=b.showChart;b=b.chartType;b!=a._currentChartType&&(a._isNeedRebuildChart=
!0,a._currentChartType=b);a.showChart()});var b=ViewTTStore.getChartSectionConfig();this._isNeedRebuildChart=!0;this._isChartVisible=b.showChart;this._currentChartType=b.chartType;this.showChart();return this},showChart:function(){if(this._isChartVisible){if(this._chartSection.showChartContainer(),this._isNeedRebuildChart){this._chartSection.updateChartContainerHeight(this.DEFAULT_CHART_SIZE.height);this._renderChartMoire.show();var a=this,b=!0,c=this._getCurrentChartGeneratorBondedWithData();c.showChart(this._viewTTChartContainerId,
{onRendered:function(){b=!b;a._onChartReadyPostProcess(a._viewTTChartContainerId,a.DEFAULT_CHART_SIZE,b?null:function(b,e){a._chartSection.updateChartContainerHeight(a.DEFAULT_CHART_SIZE.height+b+e);c.resizeChartAndRemoveChartReference(b,e)},function(){a._renderChartMoire.hide()})}});this._isNeedRebuildChart=!1}}else this._chartSection.hideChartContainer()},exportChart:function(a,b){this._chartSection.updateSizesForHiddenChartContainer(a.height,a.width);var c=this,d=!0,e=this._getCurrentChartGeneratorBondedWithData();
e.exportChart(this._viewTTChartContainerIdForExport,{onExported:function(f){d=!d;c._onChartReadyPostProcess(c._viewTTChartContainerIdForExport,a,d?null:function(a,b,c){e.rescaleChartAndRemoveChartReference(a,b,c)},function(){c._chartSection.clearHiddenChartContainer();b(f)})},chartSize:a})},_onChartReadyPostProcess:function(a,b,c,d){if(c&&!isIE8()&&this._currentChartType!=ViewTTChartType.BY_DAYS){var e=0,f=0;$("#"+a).find("g").each(function(){var a=this.getBBox();e=Math.max(e,a.y+a.height);f=Math.min(f,
a.y)});e>b.height||0>f?c(Math.abs(f),e>b.height?e-b.height:0,b):d()}else d()},_getCurrentChartGeneratorBondedWithData:function(){var a=ViewTTStore.getData(),b,c,d,e;this._currentChartType==ViewTTChartType.BY_DAYS?(c=a.daysInfoData,e=0==c.length,b=this._columnChartGenerator,d=this._prepareConfigForColumnChart(a)):this._currentChartType==ViewTTChartType.BY_CUSTOMERS?(c=a.customersData,e=0==c.customersTTData.length&&_.isNull(c.otherTTInfo),b=this._pieChartByCustomersGenerator,d=this._prepareConfigForPieChartByCustomers()):
(c=a.customersData,e=0==c.customersTTData.length&&_.isNull(c.otherTTInfo),b=this._pieChartByProjectsGenerator,d=this._prepareConfigForPieChartByProjects());var f;this._currentChartType==ViewTTChartType.BY_DAYS?(a=function(){},f=function(){}):(a=function(a,c){b.resizePieChart(a,c);b.removeReferenceOnChart()},f=function(a,c,d){b.rescalePieChartForExport(a,c,d);b.removeReferenceOnChart()});var g;if(e){var h=this;e=function(a,b){h._chartSection.showEmptyDataMessage();defer(function(){b.onRendered()})};
g=function(a,b){b.onExported(null)}}else e=function(a,e){d=$.extend(!0,d,e);b.renderChart(a,c,d)},g=function(a,e){d=$.extend(!0,d,e);b.exportChartToJPG(a,c,d)};return{showChart:e,exportChart:g,resizeChartAndRemoveChartReference:a,rescaleChartAndRemoveChartReference:f}},_prepareConfigForColumnChart:function(a){a=ViewTTStore.getUserInfo().today;var b=ViewTTStore.getSelectedUserId()!=ViewTTStore.getViewerId();return{userToday:a,userHireDate:ViewTTStore.getUserInfo().hireDate,colorScheme:this._getColumnChartColorScheme(b),
dateFormat:ViewTTStore.getDateFormat(),weekStartDay:ViewTTStore.getWeekStartDay()}},_prepareConfigForPieChartByCustomers:function(){return{customersMap:ViewTTStore.getCptMaps().customersById}},_prepareConfigForPieChartByProjects:function(){return{customersMap:ViewTTStore.getCptMaps().customersById,projectsMap:ViewTTStore.getCptMaps().projectsById}},_getColumnChartColorScheme:function(a){var b=ViewTTPageColumnChartGenerator.colorScheme;return a?b.DEFAULT_GREY:b.DEFAULT}};ViewTTPage.PieChartGenerator=function(){};
ViewTTPage.PieChartGenerator.prototype=_.create(PieChartGenerator.prototype,{_makeChart:function(a,b){return this._chart=AmCharts.makeChart(a,b,10)},resizePieChart:function(a,b){this._chart.marginTop=a;this._chart.marginBottom=b;this._redrawChart()},rescalePieChartForExport:function(a,b,c){a=(c.height-a-b)/c.height;this._chart.radius*=a;this._chart.innerRadius*=a;this._chart.fontSize*=a;this._chart.outlineThickness*=a;this._redrawChart()},_redrawChart:function(){this._chart.validateNow()},removeReferenceOnChart:function(){this._chart=
null}});ViewTTPage.PieChartByCustomersGenerator=function(){};
ViewTTPage.PieChartByCustomersGenerator.prototype=_.create(ViewTTPage.PieChartGenerator.prototype,{_getDataProvider:function(a,b){for(var c=[],d=a.customersTTData,e=0;e<d.length;e++){var f=d[e];c.push({category:this._formattedCategory(f,b),value:f.totalSpent})}d=a.otherTTInfo;_.isNull(d)||c.push({category:messageResource.getMessage("view_tt.chart.other_tt_customers"),value:d.spent,sectorColor:"#dbdbdb"});return c},_formattedCategory:function(a,b){return b.customersMap[a.customerId].name}});ViewTTPage.PieChartByProjectsGenerator=function(){};
ViewTTPage.PieChartByProjectsGenerator.prototype=_.create(ViewTTPage.PieChartGenerator.prototype,{_getDataProvider:function(a,b){for(var c=[],d=a.customersTTData,e=0;e<d.length;e++)for(var f=d[e],g=0;g<f.projectTTData.length;g++){var h=f.projectTTData[g];c.push({category:this._formattedCategory(f,h,b),value:h.totalSpent})}d=a.otherTTInfo;_.isNull(d)||c.push({category:messageResource.getMessage("view_tt.chart.other_tt_projects"),value:d.spent,sectorColor:"#dbdbdb"});return c},_formattedCategory:function(a,
b,c){return c.projectsMap[b.projectId].name+" ("+c.customersMap[a.customerId].name+")"}});ViewTTPage.ChartSection.ChartTypeSelector=function(a,b){DropdownTemplateView.call(this,a);this._selectedChartType=b;this.updateOnInit=!1};
ViewTTPage.ChartSection.ChartTypeSelector.prototype=_.create(DropdownTemplateView.prototype,{html:"<div class='viewTTChartTypeSelector noprint menuZindex' style='display: none;'>    <div class='row byDays'><div class='type'><%-byDays%></div></div>    <div class='separator'></div>    <div class='row byCustomers'><div class='type'><%-byCustomers%></div></div>    <div class='row byProjects'><div class='type'><%-byProjects%></div></div></div>",afterRender:function(){this.isShown=!1;this._bindRowClickFunction(ViewTTChartType.BY_DAYS);
this._bindRowClickFunction(ViewTTChartType.BY_CUSTOMERS);this._bindRowClickFunction(ViewTTChartType.BY_PROJECTS)},messageKeys:function(){return{byDays:"view_tt.chart.view_by_days",byCustomers:"view_tt.chart.view_by_customers",byProjects:"view_tt.chart.view_by_projects"}},update:function(){this.find(".selected").removeClass("selected");this._getRowByType(this._selectedChartType).addClass("selected")},_getRowByType:function(a){switch(a){case ViewTTChartType.BY_DAYS:return this.find(".byDays");case ViewTTChartType.BY_CUSTOMERS:return this.find(".byCustomers");
case ViewTTChartType.BY_PROJECTS:return this.find(".byProjects")}},_bindRowClickFunction:function(a){this._getRowByType(a).on("click",_.bind(function(){this.hide();this._onChartTypeSelected(a)},this))},_onChartTypeSelected:function(a){this._selectedChartType!=a&&(this._selectedChartType=a,$(this).trigger("chartTypeChanged",a))}});ViewTTPage.PrintableHeader=function(a){TemplateView.call(this,a)};
ViewTTPage.PrintableHeader.prototype=_.create(TemplateView.prototype,{html:"<div class='printHeader'>  <table class='for-print-only-table'>     <tbody>       <tr>         <td class='pageTitle'>            <div class='printableTitle'></div>            <div class='printableDateRangeHeader'></div>         </td>       </tr>       <tr>         <td class='statusesList'>            <div class='filterProject'></div>            <div class='timeTrackStatuses'></div>         </td>       </tr>  </table></div>",afterRender:function(){this.$pageTitle=
this.find(".printableTitle");this.$dateRange=this.find(".printableDateRangeHeader");this.$filters=this.find(".filterProject");this.$statuses=this.find(".timeTrackStatuses");this.dateFormat=new DateFormat(SystemSettings.dateFormat);this.formatDateStrategy=new DateRangeFormattingStrategy(this.dateFormat);$(ViewTTStore).on("dataChange",this.bind(this.update))},update:function(){var a=ViewTTStore.getSelectedUser(),a="Time-Track of "+UserNameFormat.formatFML(a.firstName,a.lastName,a.middleName);this.$pageTitle.text(a);
a=ViewTTStore.getDateRangeConfig();a=this.formatDateStrategy.formatForDateInformation({dateRangeSelection:a})+this.formatDateStrategy.formatSpecifyingInformation({dateRangeSelection:a});this.$dateRange.text(a);var a=ViewTTStore.getMergedCpList(),b=ViewTTStore.getFilter().cpSelection,a=new ATReportParamsStringBuilder({data:{cpList:a},dataFormat:this.dateFormat}),b=a.getCPSelectionParamString(b);this.$filters.text(b);ViewTTPageUtils.isFeatureEnabled(Features.TTA)?(b=ViewTTStore.getFilter().weekApprovalStatuses,
a=a.getStatusesSelectionParamString(b),this.$statuses.text(a),this.$statuses.show()):this.$statuses.hide()}});ViewTTPage.NoUsersWarning=function(a){TemplateView.call(this,a)};ViewTTPage.NoUsersWarning.prototype=_.create(TemplateView.prototype,{html:"<div class='noPageDataForViewingNote'><div><%=noUsersWarningText%></div></div>",messageKeys:function(){return{noUsersWarningText:"view_tt.no_users_to_view_tt"}}});ViewTTPage.UserIsNotSelectedWarning=function(a){TemplateView.call(this,a)};
ViewTTPage.UserIsNotSelectedWarning.prototype=_.create(TemplateView.prototype,{html:"<div class='userIsNotSelectedNote noPageDataForViewingNote'> <div class='wizardSelectionImg'></div><div class='userIsNotSelectedText'><%=userIsNotSelectedText%></div></div>",messageKeys:function(){return{userIsNotSelectedText:"view_tt.user_is_not_selected"}},afterRender:function(){var a=this;$(ViewTTStore).on("selectedUserIdChange",function(){a.$el.toggleClass("hideWarning",-1!=ViewTTStore.getSelectedUserId())})}});function ChangeWeekApprovalStatusMediator(){this.constructor=ChangeWeekApprovalStatusMediator}
ChangeWeekApprovalStatusMediator.prototype.getWeekStatusHistory=function(a,b,c,d,e){var f=this;makeRpcCall("EnterTTService.getTTAHistory",[a,b,c],function(a){d(a.list)},function(a,b,c){e();return"com.actimind.actitime.services.FeatureIsDisabledException"==c.exception?(alert(messageResource.getMessage("userlist.js.error_tta_feature_disabled")),reloadSubmitTTPageWithoutFormReloading(),!0):"com.actimind.actitime.services.EnterTTService$NoRightsToViewUserTTAHistory"==c.exception?(alert(messageResource.getMessage("change_week_approval_status.error.no_rights_to_view_history",
[f.formatUserInfo()])),reloadSubmitTTPageWithoutFormReloading(),!0):f.commonErrorHandler(a,b,c)})};
ChangeWeekApprovalStatusMediator.prototype.commonErrorHandler=function(a,b,c){if("com.actimind.actitime.administration.NoSuchUserException"==c.exception||"com.actimind.actitime.administration.UserIsDisabledException"==c.exception||"com.actimind.actitime.services.NoRightsForRemoteCallException"==c.exception)return reloadSubmitTTPageWithoutFormReloading(),!0;if("com.actimind.actitime.services.DateBeforeHireDateException"==c.exception)return alert(messageResource.getMessage("change_week_approval_status.error.before_hire_date",
[this.formatUserInfo()])),reloadSubmitTTPageWithoutFormReloading(),!0;if("com.actimind.actitime.administration.NoRightsToApproveUser"==c.exception)return alert(messageResource.getMessage("change_week_approval_status.error.user_not_managable_anymore",[this.formatUserInfo()])),reloadSubmitTTPageWithoutFormReloading(),!0;if("com.actimind.actitime.administration.TimeTrackChangedException"==c.exception)return alert(messageResource.getMessage("change_week_approval_status.error.time_track_changed_alert")),
document.SubmitTTForm.pageAction.value="",submitSubmitTTForm(),!0};function ChangeMyWeekApprovalStatusControl(){this.constructor=ChangeMyWeekApprovalStatusControl}
ChangeMyWeekApprovalStatusControl.prototype.init=function(a,b,c,d,e,f,g){var h=this;this.disabled=c;this.onChangeCallback=f;this.getWeekStatusHistoryCallback=g;this.controlBlock=$(".changeWeekApprovalStatusControl");this.pageContainer=$(".mainContentPadding");this.statusMessage=this.controlBlock.find(".statusText");this.notReadyButton=this.controlBlock.find(".notReadyLabelCell");this.readyButton=this.controlBlock.find(".readyLabelCell");this.switcher=this.controlBlock.find(".switcherImageCell");this.currentState=
null;this.controlBlock.show();this.update(b);this.value=this.defaultValue=b;this.userId=a;this.dateFrom=d;this.dateTo=e;this.controlBlock.show();this.disabled||(this.historyButton=this.controlBlock.find(".ttaHistoryButton"),this.historyButton.click(function(){h.showWeekStatusHistory(this)}),this.historyLightboxDiv=$("#ttaHistoryLightBoxDiv"),this.historyPopup=new DropdownDialog({wrapperClass:"ttaHistoryLightBox",dialogDiv:this.historyLightboxDiv,hideButtons:!0,isWithBeak:!0,hideOnResize:!0}),this.historySpinnerController=
new SpinnerController);return this};
ChangeMyWeekApprovalStatusControl.prototype.states={NOT_READY_DISABLED:{getClassName:function(){return"notReady"},updateUI:function(a){a.controlBlock.removeClass("showStatus").addClass("showSwitcher disabledMyWeekApprovalStatusControl");PageOverlayTipsManager.getInstance().refreshDynamicTips()},getCurrentStatus:function(){return EffectiveWeekApprovalStatus.NOT_READY}},NOT_READY:{getClassName:function(){return"notReady"},updateUI:function(a){a.controlBlock.removeClass("showStatus").addClass("showSwitcher");a.notReadyButton.off("click");
a.readyButton.off("click").click(function(){a.update(EffectiveWeekApprovalStatus.READY)});a.switcher.off("click").click(function(){a.update(EffectiveWeekApprovalStatus.READY)});PageOverlayTipsManager.getInstance().refreshDynamicTips()},getCurrentStatus:function(){return EffectiveWeekApprovalStatus.NOT_READY}},READY:{getClassName:function(){return"ready"},updateUI:function(a){a.controlBlock.removeClass("showStatus").addClass("showSwitcher");a.notReadyButton.off("click").click(function(){a.update(EffectiveWeekApprovalStatus.NOT_READY)});
a.readyButton.off("click");a.switcher.off("click").click(function(){a.update(EffectiveWeekApprovalStatus.NOT_READY)});PageOverlayTipsManager.getInstance().refreshDynamicTips()},getCurrentStatus:function(){return EffectiveWeekApprovalStatus.READY}},APPROVED:{getClassName:function(){return"approved"},updateUI:function(a){a.controlBlock.removeClass("showSwitcher").addClass("showStatus");a.statusMessage.text(messageResource.getMessage("change_week_approval_status.status.approved"))},getCurrentStatus:function(){return EffectiveWeekApprovalStatus.APPROVED}},
REJECTED:{getClassName:function(){return"rejected"},updateUI:function(a){a.controlBlock.removeClass("showSwitcher").addClass("showStatus");a.statusMessage.text(messageResource.getMessage("change_week_approval_status.status.rejected"))},getCurrentStatus:function(){return EffectiveWeekApprovalStatus.REJECTED}},AUTO_APPROVED:{getClassName:function(){return"autoApproved"},updateUI:function(a){a.controlBlock.removeClass("showSwitcher").addClass("showStatus");a.statusMessage.text(messageResource.getMessage("change_week_approval_status.status.auto_approved"))},
getCurrentStatus:function(){return EffectiveWeekApprovalStatus.AUTO_APPROVED}},AUTO_APPROVED_DISABLED:{getClassName:function(){return"autoApproved"},updateUI:function(a){a.controlBlock.removeClass("showSwitcher").addClass("showStatus disabledMyWeekApprovalStatusControl");a.statusMessage.text(messageResource.getMessage("change_week_approval_status.status.auto_approved"))},getCurrentStatus:function(){return EffectiveWeekApprovalStatus.AUTO_APPROVED}}};
ChangeMyWeekApprovalStatusControl.prototype.updateState=function(a){if(this.disabled)this.currentState=a==EffectiveWeekApprovalStatus.AUTO_APPROVED?this.states.AUTO_APPROVED_DISABLED:this.states.NOT_READY_DISABLED;else{var b;switch(a){case EffectiveWeekApprovalStatus.NOT_READY:b=this.states.NOT_READY;break;case EffectiveWeekApprovalStatus.READY:b=this.states.READY;break;case EffectiveWeekApprovalStatus.APPROVED:b=this.states.APPROVED;break;case EffectiveWeekApprovalStatus.REJECTED:b=this.states.REJECTED;
break;case EffectiveWeekApprovalStatus.AUTO_APPROVED:b=this.states.AUTO_APPROVED}this.currentState=b}};ChangeMyWeekApprovalStatusControl.prototype.updateUI=function(){this.currentState.updateUI(this)};ChangeMyWeekApprovalStatusControl.prototype.getCurrentStatus=function(){return this.currentState.getCurrentStatus()};
ChangeMyWeekApprovalStatusControl.prototype.update=function(a){if(null==this.currentState||this.getCurrentStatus()!=a){var b=null!=this.currentState;this.switcherIsShown();var c=this.currentState;this.updateState(a);this.controlBlock.addClass(this.currentState.getClassName());this.pageContainer.addClass(this.currentState.getClassName());null!=c&&(this.controlBlock.removeClass(c.getClassName()),this.pageContainer.removeClass(c.getClassName()));this.updateUI();this.value=a;if(b&&this.onChangeCallback)this.onChangeCallback()}};
ChangeMyWeekApprovalStatusControl.prototype.showSwitcherIfNeeded=function(){this.getCurrentStatus()!=EffectiveWeekApprovalStatus.APPROVED&&this.getCurrentStatus()!=EffectiveWeekApprovalStatus.REJECTED||this.update(EffectiveWeekApprovalStatus.NOT_READY)};ChangeMyWeekApprovalStatusControl.prototype.switcherIsShown=function(){return null!=this.currentState&&(this.getCurrentStatus()==EffectiveWeekApprovalStatus.NOT_READY||this.getCurrentStatus()==EffectiveWeekApprovalStatus.READY)};
ChangeMyWeekApprovalStatusControl.prototype._startSpinHistory=function(a){$(a).addClass("loading");this.historySpinnerController.spinInElement($(a))};ChangeMyWeekApprovalStatusControl.prototype._stopSpinHistory=function(a){$(a).removeClass("loading");this.historySpinnerController.stop()};
ChangeMyWeekApprovalStatusControl.prototype._showHistoryPopup=function(a){var b=this.isElementInBottomControl(a);this.historyPopup.setBeak(b);this.historyPopup.showAt(a,b?{offset:"30px -12px",my:"right bottom",at:"right top",collision:"none"}:{offset:"30px 12px",my:"right top",at:"right bottom",collision:"none"})};ChangeMyWeekApprovalStatusControl.prototype.isElementInBottomControl=function(a){return $(a).closest(".weekApprovalStatusControlOuterContainer").hasClass("bottom")};
ChangeMyWeekApprovalStatusControl.prototype.showWeekStatusHistory=function(a){this._startSpinHistory(a);var b=this;this.getWeekStatusHistoryCallback(this.userId,this.dateFrom,this.dateTo,function(c){b._stopSpinHistory(a);renderTTAHistoryTable(b.historyLightboxDiv,b.userId,c);b._showHistoryPopup(a)},function(){b._stopSpinHistory(a)})};function ChangeMyWeekApprovalStatusMediator(){this.constructor=ChangeMyWeekApprovalStatusMediator}
ChangeMyWeekApprovalStatusMediator.prototype=_.create(ChangeWeekApprovalStatusMediator.prototype,{init:function(a,b,c,d,e){this.spinnerController=new SpinnerController;var f=this;this.changeWeekControl=(new ChangeMyWeekApprovalStatusControl).init(a,b,c,d,e,c?null:function(){f.onStatusChange.apply(f,arguments)},c?null:function(){f.getWeekStatusHistory.apply(f,arguments)});return this},onStatusChange:function(){submitTTManager.handleChange(!0,!1);SubmitTTChanges.registerChange("statusSwitcher");document.SubmitTTForm.effectiveWeekStatusName.value=
this.changeWeekControl.getCurrentStatus();document.SubmitTTForm.doSaveWeekStatusValue.value=!0},showSwitcherIfNeeded:function(){this.changeWeekControl.showSwitcherIfNeeded();document.SubmitTTForm.doSaveWeekStatusValue.value=!0}});function ChangeOtherWeekApprovalStatusControl(){this.constructor=ChangeOtherWeekApprovalStatusControl}
ChangeOtherWeekApprovalStatusControl.prototype.init=function(a,b,c,d,e,f,g,h,k,m){var l=this;this.disabledControl=e;this.pageContainer=$(".mainContentPadding");this.controlBlocks=$(".changeWeekApprovalStatusControl");this.currentStatusCells=this.controlBlocks.find(".currentStatusCell");this.approveButtons=this.controlBlocks.find(".approveButton");this.rejectButtons=this.controlBlocks.find(".rejectButton");this.revokeLinks=this.controlBlocks.find(".revokeLink");this.historyButtons=this.controlBlocks.find(".ttaHistoryButton");
this.approveCallback=g;this.rejectCallback=h;this.revokeCallback=k;this.getWeekStatusHistoryCallback=m;this.approveButtons.click(function(){l._isDisabled()||l.approve(this)});this.rejectButtons.click(function(){l._isDisabled()||l.reject(this)});this.disabledControl||(this.buttonsTooltip=$("#changeWeekApprovalStatusButtonsTooltip"),this.approveButtons.hover(function(){l.showButtonTooltip(this)},function(){l.hideButtonTooltip()}),this.rejectButtons.hover(function(){l.showButtonTooltip(this)},function(){l.hideButtonTooltip()}));
this.revokeLinks.click(function(){l._disableControls()&&l.revoke(this)});this.historyButtons.click(function(){l.showWeekStatusHistory(this)});this.userId=a.userId;this.userData=a;this.dateFrom=b;this.dateTo=c;this.managerId=f;this.update(d);this.controlBlocks.show();this.rejectCommentDialog=(new RejectCommentDialog).init("rejectWeekCommentDialog",function(){return l._reject()});this.historyLightboxDiv=$("#ttaHistoryLightBoxDiv");this.historyPopup=new DropdownDialog({wrapperClass:"ttaHistoryLightBox",
dialogDiv:this.historyLightboxDiv,hideButtons:!0,isWithBeak:!0,hideOnResize:!0});this.historySpinnerController=new SpinnerController;return this};
ChangeOtherWeekApprovalStatusControl.prototype.states={NOT_READY_DISABLED:{approve:function(){},reject:function(){},revoke:function(){},updateUI:function(a){a.controlBlocks.addClass("disabledOtherWeekApprovalStatusControl");a._updateUI(this.getClassName(),"change_week_approval_status.status.not_ready")},getCurrentStatus:function(){return EffectiveWeekApprovalStatus.NOT_READY},showWeekStatusHistory:function(){},getClassName:function(){return"notReady"}},NOT_READY:{approve:function(a,b){a._approve(b)},
reject:function(a,b){a._openRejectCommentDialog(b)},revoke:function(){},updateUI:function(a){a._updateUI(this.getClassName(),"change_week_approval_status.status.not_ready")},getCurrentStatus:function(){return EffectiveWeekApprovalStatus.NOT_READY},showWeekStatusHistory:function(a,b){a._showWeekStatusHistory(b)},getClassName:function(){return"notReady"}},READY:{approve:function(a,b){a._approve(b)},reject:function(a,b){a._openRejectCommentDialog(b)},revoke:function(){},updateUI:function(a){a._updateUI(this.getClassName(),
"change_week_approval_status.status.ready")},getCurrentStatus:function(){return EffectiveWeekApprovalStatus.READY},showWeekStatusHistory:function(a,b){a._showWeekStatusHistory(b)},getClassName:function(){return"ready"}},APPROVED:{approve:function(){},reject:function(a,b){a._openRejectCommentDialog(b)},revoke:function(a,b){a._revoke(b)},updateUI:function(a){a._updateUI(this.getClassName(),"change_week_approval_status.status.approved")},getCurrentStatus:function(){return EffectiveWeekApprovalStatus.APPROVED},
showWeekStatusHistory:function(a,b){a._showWeekStatusHistory(b)},getClassName:function(){return"approved"}},REJECTED:{approve:function(a,b){a._approve(b)},reject:function(){},revoke:function(a,b){a._revoke(b)},updateUI:function(a){a._updateUI(this.getClassName(),"change_week_approval_status.status.rejected")},getCurrentStatus:function(){return EffectiveWeekApprovalStatus.REJECTED},showWeekStatusHistory:function(a,b){a._showWeekStatusHistory(b)},getClassName:function(){return"rejected"}},AUTO_APPROVED:{approve:function(){},
reject:function(){},revoke:function(){},updateUI:function(a){a._updateUI(this.getClassName(),"change_week_approval_status.status.auto_approved")},getCurrentStatus:function(){return EffectiveWeekApprovalStatus.AUTO_APPROVED},showWeekStatusHistory:function(a,b){a._showWeekStatusHistory(b)},getClassName:function(){return"autoApproved"}}};ChangeOtherWeekApprovalStatusControl.prototype._isDisabled=function(){return this.controlBlocks.hasClass("disabled")};
ChangeOtherWeekApprovalStatusControl.prototype._disableControls=function(){return this._isDisabled()?!1:(this.controlBlocks.addClass("disabled"),!0)};ChangeOtherWeekApprovalStatusControl.prototype._enableControls=function(){this.controlBlocks.removeClass("disabled")};
ChangeOtherWeekApprovalStatusControl.prototype._updateUI=function(a,b){for(var c in this.states){var d=this.states[c].getClassName();this.controlBlocks.removeClass(d);this.pageContainer.removeClass(d)}this._enableControls();this.controlBlocks.addClass(a);this.pageContainer.addClass(a);this.currentStatusCells.text(messageResource.getMessage(b))};
ChangeOtherWeekApprovalStatusControl.prototype.updateState=function(a){var b;if(this.disabledControl)this.currentState=this.states.NOT_READY_DISABLED;else{switch(a){case EffectiveWeekApprovalStatus.NOT_READY:b=this.states.NOT_READY;break;case EffectiveWeekApprovalStatus.READY:b=this.states.READY;break;case EffectiveWeekApprovalStatus.APPROVED:b=this.states.APPROVED;break;case EffectiveWeekApprovalStatus.REJECTED:b=this.states.REJECTED;break;case EffectiveWeekApprovalStatus.AUTO_APPROVED:b=this.states.AUTO_APPROVED}this.currentState=
b}};ChangeOtherWeekApprovalStatusControl.prototype._findNearestChangeStatusSpinnerPl=function(a){return $(a).closest(".weekApprovalStatusControlOuterContainer").find(".spinnerPlaceholder")};ChangeOtherWeekApprovalStatusControl.prototype._approve=function(a){var b=this;this.hideButtonTooltip();this.approveCallback(this.userId,this.dateFrom,this._findNearestChangeStatusSpinnerPl(a),function(a){b.update(a)},function(){},function(){return b._disableControls()},function(){return b._enableControls()})};
ChangeOtherWeekApprovalStatusControl.prototype._reject=function(){if(!this.rejectCommentDialog.isValid())return alert(messageResource.getMessage("change_week_approval_status.reject_comment.too_long.alert")),!1;var a=this,b=this.rejectCommentDialog.getComment();this.rejectCallback(this.userId,this.dateFrom,isNotEmpty(b)?b:null,this._findNearestChangeStatusSpinnerPl(this.pressedRejectButton),function(b){a.update(b)},function(){},function(){return a._disableControls()},function(){return a._enableControls()});
return!0};ChangeOtherWeekApprovalStatusControl.prototype._revoke=function(a){var b=this;this.revokeCallback(this.userId,this.dateFrom,this.getCurrentStatus(),this._findNearestChangeStatusSpinnerPl(a),function(a){b.update(a)})};ChangeOtherWeekApprovalStatusControl.prototype._openRejectCommentDialog=function(a){this.pressedRejectButton=a;this.hideButtonTooltip();var b=this.isElementInBottomControl(a),c={};c.userInfo=this.formatUserInfo();c.isBottom=b;this.rejectCommentDialog._open(a,c)};
ChangeOtherWeekApprovalStatusControl.prototype._startSpinHistory=function(a){$(a).addClass("loading");this.historySpinnerController.spinInElement($(a))};ChangeOtherWeekApprovalStatusControl.prototype._stopSpinHistory=function(a){$(a).removeClass("loading");this.historySpinnerController.stop()};
ChangeOtherWeekApprovalStatusControl.prototype._showHistoryPopup=function(a){var b=this.isElementInBottomControl(a);this.historyPopup.setBeak(b);this.historyPopup.showAt(a,b?{offset:"30px -12px",my:"right bottom",at:"right top",collision:"none"}:{offset:"30px 12px",my:"right top",at:"right bottom",collision:"none"})};ChangeOtherWeekApprovalStatusControl.prototype.isElementInBottomControl=function(a){return $(a).closest(".weekApprovalStatusControlOuterContainer").hasClass("bottom")};
ChangeOtherWeekApprovalStatusControl.prototype._showWeekStatusHistory=function(a){this._startSpinHistory(a);var b=this;this.getWeekStatusHistoryCallback(this.userId,this.dateFrom,this.dateTo,function(c){b._stopSpinHistory(a);renderTTAHistoryTable(b.historyLightboxDiv,b.managerId,c);b._showHistoryPopup(a)},function(){b._stopSpinHistory(a)})};ChangeOtherWeekApprovalStatusControl.prototype.updateUI=function(){this.currentState.updateUI(this)};
ChangeOtherWeekApprovalStatusControl.prototype.approve=function(a){this.currentState.approve(this,a)};ChangeOtherWeekApprovalStatusControl.prototype.reject=function(a){this.currentState.reject(this,a)};ChangeOtherWeekApprovalStatusControl.prototype.revoke=function(a){this.currentState.revoke(this,a)};ChangeOtherWeekApprovalStatusControl.prototype.showWeekStatusHistory=function(a){this.currentState.showWeekStatusHistory(this,a)};ChangeOtherWeekApprovalStatusControl.prototype.getCurrentStatus=function(){return this.currentState.getCurrentStatus()};
ChangeOtherWeekApprovalStatusControl.prototype.showButtonTooltip=function(a){a=$(a);var b=messageResource.getMessage(a.hasClass("approveButton")?"change_week_approval_status.approve_button.tooltip":"change_week_approval_status.reject_button.tooltip"),b=b+" "+messageResource.getEscapedMessage("change_week_approval_status.user_of.tooltip",[this.formatUserInfo()]);this.buttonsTooltip.html(b);b=$(window).scrollLeft()+$(window).width()-(a.offset().left+40);this.buttonsTooltip.show();var c=this.buttonsTooltip.width()+
1;this.buttonsTooltip.css("width",c);b=b>c+30?a.offset().left+40:a.offset().left+b-c+10;this.buttonsTooltip.offset({left:b,top:a.offset().top+24})};ChangeOtherWeekApprovalStatusControl.prototype.hideButtonTooltip=function(){this.buttonsTooltip.css("width","");this.buttonsTooltip.css("top","");this.buttonsTooltip.css("left","");this.buttonsTooltip.hide()};ChangeOtherWeekApprovalStatusControl.prototype.update=function(a){this.updateState(a);this.updateUI()};
ChangeOtherWeekApprovalStatusControl.prototype.formatUserInfo=function(){return UserNameFormat.formatFML(this.userData.firstName,this.userData.lastName,this.userData.middleName)};function ChangeOtherWeekApprovalStatusMediator(){this.constructor=ChangeOtherWeekApprovalStatusMediator}
ChangeOtherWeekApprovalStatusMediator.prototype=_.create(ChangeWeekApprovalStatusMediator.prototype,{init:function(a,b,c,d,e,f,g){this.userData=a;this.spinnerController=new SpinnerController;this.lastChangesTimestampStr=g;var h=this;(new ChangeOtherWeekApprovalStatusControl).init(a,b,c,d,e,f,function(){h.processApproval.apply(h,arguments)},function(){h.processRejection.apply(h,arguments)},function(){h.processRevoke.apply(h,arguments)},function(){h.getWeekStatusHistory.apply(h,arguments)});return this},
processApproval:function(a,b,c,d,e,f,g){this.timeEntriesChanged?this._openApproveRejectConfirmDialog("change_week_approval_status.confirm_dialog.approve.header","change_week_approval_status.confirm_dialog.approve_save.caption",function(){f()&&!submitSubmitTTFormWithApprovalStatus(EffectiveWeekApprovalStatus.APPROVED)&&g()}):f()&&this._approve(a,b,this.lastChangesTimestampStr,c,d,e)},processRejection:function(a,b,c,d,e,f,g,h){this.timeEntriesChanged?this._openApproveRejectConfirmDialog("change_week_approval_status.confirm_dialog.reject.header",
"change_week_approval_status.confirm_dialog.reject_save.caption",function(){g()&&!submitSubmitTTFormWithApprovalStatusAndComment(EffectiveWeekApprovalStatus.REJECTED,c)&&h()}):g()&&this._reject(a,b,c,this.lastChangesTimestampStr,d,e,f)},processRevoke:function(a,b,c,d,e,f){this.callChangeStatusServiceMethod("EnterTTService.revokeUserWeekStatus",[a,b,c],d,e,f)},_approve:function(a,b,c,d,e,f){this.callChangeStatusServiceMethod("EnterTTService.approveUserWeek",[a,b,c],d,e,f)},_reject:function(a,b,c,d,
e,f,g){this.callChangeStatusServiceMethod("EnterTTService.rejectUserWeek",[a,b,c,d],e,f,g)},setTimeEntriesChanged:function(){this.timeEntriesChanged=!0},commonSuccessHandler:function(a){setApprovalStatusToSubmitTTForm(a.effectiveWeekStatus);var b=a.warnings,c=!1;if(b&&0<b.length){for(var d="",e=0;e<b.length;e++)b[e]==SubmitTTConstants.WARNING_STATUS_HAS_ALREADY_BEEN_SET?d+=messageResource.getMessage("change_week_approval_status.status_already_set.warning",[messageResource.getMessage(a.effectiveWeekStatus==
EffectiveWeekApprovalStatus.APPROVED?"change_week_approval_status.week_approved":"change_week_approval_status.week_rejected")]):b[e]==SubmitTTConstants.WARNING_STATUS_HAS_BEEN_CHANGED_CONCURRENTLY?d+=messageResource.getMessage("change_week_approval_status.status_has_been_changed.warning"):b[e]==SubmitTTConstants.WARNING_TTA_FEATURE_IS_DISABLED&&(d+=messageResource.getMessage("userlist.js.error_tta_feature_disabled"),c=!0),d+="\n\n";alert(d)}c&&reloadSubmitTTPageWithoutFormReloading()},callChangeStatusServiceMethod:function(a,
b,c,d,e){var f=this;this._startChangeStatusSpinner(c);makeRpcCall(a,b,function(a){f._stopChangeStatusSpinner();d&&d(a.effectiveWeekStatus);f.commonSuccessHandler(a)},function(a,b,c){f._stopChangeStatusSpinner();return e&&e()?!0:f.commonErrorHandler(a,b,c)})},_openApproveRejectConfirmDialog:function(a,b,c){operationConfirmDlg.initWithData(messageResource.getMessage(a),[messageResource.getMessage(b)],messageResource.getEscapedMessage("change_week_approval_status.confirm_dialog.text",[this.formatUserInfo()]),
messageResource.getMessage("change_week_approval_status.confirm_dialog.do_nothing.caption"),{onConfirm:c},!0,!0);operationConfirmDlg.open(!1)},formatUserInfo:function(){return UserNameFormat.formatFML(this.userData.firstName,this.userData.lastName,this.userData.middleName)},_startChangeStatusSpinner:function(a){this.spinnerController.spinInElement(a)},_stopChangeStatusSpinner:function(){this.spinnerController.stop()}});ATProductSettingsValidator=function(){};ATProductSettingsValidator.prototype=_.create(ProductSettingsValidator.prototype,{isTZGEnabled:function(){return EnabledFeatures.TZG},isUGREnabled:function(){return EnabledFeatures.UGR},isSickEnabled:function(){return EnabledFeatures.SDB},isPTOEnabled:function(){return EnabledFeatures.PTO}});function ATReportRightsValidator(){}ATReportRightsValidator.prototype=_.create(ReportRightsValidator.prototype,{isCanViewBalances:function(){return UserRights.MANAGE_PTO_AND_SICK}});function CPTManagement(){};CPTManagement.Store={customers:[],projects:[],tasks:[],addCustomer:function(a){this.customers[a.id]=a},addProject:function(a){this.projects[a.id]=a},addTask:function(a){this.tasks[a.id]=a},getCustomer:function(a){return this.customers[a]},getProject:function(a){return this.projects[a]},getTask:function(a){return this.tasks[a]},getCustomers:function(){return this.customers},getProjects:function(){return this.projects},getTasks:function(){return this.tasks}};
function CPTManagementEntity(a,b){this.id=a;this.name=b;this.children=[]}CPTManagementEntity.prototype={addChild:function(a){this.children.push(a)},getChildren:function(){return this.children},isContainChild:function(a){return isArrayContains(this.children,a)},hasChild:function(){return 0<this.children.length},getChildCount:function(){return this.children.length}};
function CustomerManagementEntity(a,b,c,d,e){CPTManagementEntity.apply(this,arguments);this.isActive=c;this.taskCount=d;this.hiddenProjectCount=e}CustomerManagementEntity.prototype=_.create(CPTManagementEntity.prototype);function EditDialogCustomerManagementEntity(a,b,c,d,e,f){CustomerManagementEntity.apply(this,arguments);this.visibleProjectCount=f}EditDialogCustomerManagementEntity.prototype=_.create(CustomerManagementEntity.prototype,{getChildCount:function(){return this.visibleProjectCount}});
function ProjectManagementEntity(a,b,c,d,e){CPTManagementEntity.apply(this,arguments);this.customerId=e}ProjectManagementEntity.prototype=_.create(CPTManagementEntity.prototype);function TaskManagementEntity(a,b,c,d){CPTManagementEntity.apply(this,arguments);this.projectId=c;this.customerId=d}TaskManagementEntity.prototype=_.create(CPTManagementEntity.prototype);TaskDeleteLightBox=function(){};
TaskDeleteLightBox.prototype=_.create(BasicLightbox.prototype,{init:function(a){this.exist_invalid_fields_message_key=this.close_tab_confirmation_message_key="";BasicLightbox.prototype.init.call(this,a.popupId);this.setCancelCallback(_.bind(this.hide,this));return this},restoreOnKeyDownHandler:function(){this._resotreKeyDownHandler&&this._resotreKeyDownHandler()},setupKeyDownHandler:function(){var a=this;this._resotreKeyDownHandler=KEY_HANDLERS.onKeyDown(function(b,c){switch(b){case KEY_CODE_ESC:return a.onEscape(),
!0}})}});function TaskManagement(){};function CPTreeHeader(a){TemplateView.call(this,a)}CPTreeHeader.prototype=_.create(TemplateView.prototype,{html:"<div class='cpTreeHeader'></div>"});function CPTreePanel(a){TemplateView.call(this,a)}CPTreePanel.prototype=_.create(TemplateView.prototype,{html:"<div class='cpTreePanel'> <div class='collapseButton'></div></div>"});function AssignmentUser(a,b,c,d,e,f){this.id=a;this.name=b;this.active=c;this.isAllProjectsAvailable=d;this.userGroupId=e;this.timeZoneGroupId=f;this.selected=!1}AssignmentUser.prototype.isActive=function(){return this.active};
//# sourceMappingURL=at.min.js.map
