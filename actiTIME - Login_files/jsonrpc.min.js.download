var escapeJSONString=function(){var a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return function(c){a.lastIndex=0;return a.test(c)?'"'+c.replace(a,function(a){var c=b[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'}}();
function toJSON(a){function b(){for(var a;d;)a=d.$_$jabsorbed$813492.prev,delete d.$_$jabsorbed$813492,d=a}function c(a,f,l){var p=[],h,q;if(null===a||void 0===a)return"null";if("string"===typeof a)return escapeJSONString(a);if("number"===typeof a||"boolean"===typeof a)return a.toString();if(a.$_$jabsorbed$813492){for(l=[l];f;)h&&h.unshift(f.$_$jabsorbed$813492.ref),f===a&&(q=f,h=[q.$_$jabsorbed$813492.ref]),l.unshift(f.$_$jabsorbed$813492.ref),f=f.$_$jabsorbed$813492.parent;if(q){if(JSONRpcClient.fixupCircRefs)return l.shift(),
h.shift(),e.push([l,h]),g;b();throw Error("circular reference detected!");}if(JSONRpcClient.fixupDuplicates){h=[a.$_$jabsorbed$813492.ref];for(f=a.$_$jabsorbed$813492.parent;f;)h.unshift(f.$_$jabsorbed$813492.ref),f=f.$_$jabsorbed$813492.parent;l.shift();h.shift();e.push([l,h]);return g}}else a.$_$jabsorbed$813492={parent:f,prev:d,ref:l},d=a;if(a.constructor===Date)return a.javaClass?'{javaClass: "'+a.javaClass+'", time: '+a.valueOf()+"}":'{javaClass: "java.util.Date", time: '+a.valueOf()+"}";if(a.constructor===
Array){for(h=0;h<a.length;h++)k=c(a[h],a,h),p.push(k===g?null:k);return"["+p.join(", ")+"]"}for(var n in a)"$_$jabsorbed$813492"!==n&&(null===a[n]||void 0===a[n]?p.push('"'+n+'": null'):"function"!=typeof a[n]&&(k=c(a[n],a,n),k!==g&&p.push(escapeJSONString(n)+": "+k)));return"{"+p.join(", ")+"}"}var d,e=[],g={},k;k=c(a,null,"root");b();return e.length?{json:k,fixups:e}:{json:k}}
function JSONRpcClient(){var a=0,b,c=typeof arguments[0],d=!0;"function"===c?(this.readyCB=arguments[0],a++):arguments[0]&&"object"===c&&arguments[0].length&&(this._addMethods(arguments[0]),a++,d=!1);this.serverURL=arguments[a];this.user=arguments[a+1];this.pass=arguments[a+2];this.objectID=0;d&&(this._addMethods(["system.listMethods"]),a=JSONRpcClient._makeRequest(this,"system.listMethods",[]),this.readyCB&&(b=this,a.cb=function(a,c){c||b._addMethods(a);b.readyCB(a,c)}),this.readyCB?(JSONRpcClient.async_requests.push(a),
JSONRpcClient.kick_async()):(a=JSONRpcClient._sendRequest(this,a),this._addMethods(a)))}JSONRpcClient.prototype.createCallableProxy=function(a,b){var c,d;c=new JSONRPCCallableProxy(a,b);for(d in JSONRpcClient.knownClasses[b])c[d]=JSONRpcClient.bind(JSONRpcClient.knownClasses[b][d],c);return c};function JSONRPCCallableProxy(a,b){this.objectID=a;this.javaClass=b;this.JSONRPCType="CallableReference"}JSONRpcClient.knownClasses={};
JSONRpcClient.Exception=function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);this.trace&&(a=this.trace.match(/^([^:]*)/))&&(this.name=a[0]);this.name||(this.name="JSONRpcClientException")};JSONRpcClient.Exception.CODE_REMOTE_EXCEPTION=490;JSONRpcClient.Exception.CODE_ERR_CLIENT=550;JSONRpcClient.Exception.CODE_ERR_PARSE=590;JSONRpcClient.Exception.CODE_ERR_NOMETHOD=591;JSONRpcClient.Exception.CODE_ERR_UNMARSHALL=592;JSONRpcClient.Exception.CODE_ERR_MARSHALL=593;
JSONRpcClient.Exception.prototype=Error();JSONRpcClient.Exception.prototype.toString=function(a,b){var c="";this.name&&(c+=this.name);this.message&&(c+=": "+this.message);0==c.length&&(c="no exception information given");return c};JSONRpcClient.default_ex_handler=function(a){alert(a)};JSONRpcClient.toplevel_ex_handler=JSONRpcClient.default_ex_handler;JSONRpcClient.profile_async=!1;JSONRpcClient.max_req_active=1;JSONRpcClient.requestId=2;JSONRpcClient.fixupCircRefs=!0;
JSONRpcClient.fixupDuplicates=!0;JSONRpcClient.transformDates=!1;JSONRpcClient.transformDateWithoutHint=!1;JSONRpcClient.javaDateClasses={"java.util.Date":!0,"java.sql.Date":!0,"java.sql.Time":!0,"java.sql.Timestamp":!0};JSONRpcClient.bind=function(a,b){return function(){return a.apply(b,arguments)}};
JSONRpcClient._createMethod=function(a,b){return function(){for(var c=[],d,e=0;e<arguments.length;e++)c.push(arguments[e]);"function"==typeof c[0]&&(d=c.shift());c=JSONRpcClient._makeRequest(this,b,c,this.objectID,d);return d?(JSONRpcClient.async_requests.push(c),JSONRpcClient.kick_async(),c.requestId):JSONRpcClient._sendRequest(a,c)}};
JSONRpcClient.prototype.createObject=function(){for(var a=[],b=null,c=0;c<arguments.length;c++)a.push(arguments[c]);"function"==typeof a[0]&&(b=a.shift());a=JSONRpcClient._makeRequest(this,a[0]+".$constructor",a[1],0,b);if(null===b)return JSONRpcClient._sendRequest(this,a);JSONRpcClient.async_requests.push(a);JSONRpcClient.kick_async();return a.requestId};JSONRpcClient.CALLABLE_REFERENCE_METHOD_PREFIX=".ref";
JSONRpcClient.prototype._addMethods=function(a,b){for(var c,d,e,g,k=[],m,f=0;f<a.length;f++){d=this;e=a[f].split(".");c=a[f].indexOf("[");g=a[f].indexOf("]");if(a[f].substring(0,JSONRpcClient.CALLABLE_REFERENCE_METHOD_PREFIX.length)==JSONRpcClient.CALLABLE_REFERENCE_METHOD_PREFIX&&-1!=c&&-1!=g&&c<g)m=a[f].substring(c+1,g);else for(g=0;g<e.length-1;g++)c=e[g],d[c]||(d[c]={}),d=d[c];c=e[e.length-1];m?(e=JSONRpcClient._createMethod(this,c),JSONRpcClient.knownClasses[m]||(JSONRpcClient.knownClasses[m]=
{}),JSONRpcClient.knownClasses[m][c]=e):(e=JSONRpcClient._createMethod(this,a[f]),d[c]||b||(d[c]=JSONRpcClient.bind(e,this)),k.push(e));m=null}return k};JSONRpcClient._getCharsetFromHeaders=function(a){var b,c,d;try{for(b=a.getResponseHeader("Content-type"),c=b.split(/\s*;\s*/),d=0;d<c.length;d++)if("charset="==c[d].substring(0,8))return c[d].substring(8,c[d].length)}catch(e){}return"UTF-8"};JSONRpcClient.async_requests=[];JSONRpcClient.async_inflight={};JSONRpcClient.async_responses=[];
JSONRpcClient.async_timeout=null;JSONRpcClient.num_req_active=0;
JSONRpcClient._async_handler=function(){var a;for(JSONRpcClient.async_timeout=null;0<JSONRpcClient.async_responses.length;)if(a=JSONRpcClient.async_responses.shift(),!a.canceled){a.profile&&(a.profile.dispatch=new Date);try{a.cb(a.result,a.ex,a.profile)}catch(b){JSONRpcClient.toplevel_ex_handler(b)}}for(;0<JSONRpcClient.async_requests.length&&JSONRpcClient.num_req_active<JSONRpcClient.max_req_active;)a=JSONRpcClient.async_requests.shift(),a.canceled||JSONRpcClient._sendRequest(a.client,a)};
JSONRpcClient.kick_async=function(){JSONRpcClient.async_timeout||(JSONRpcClient.async_timeout=setTimeout(JSONRpcClient._async_handler,0))};
JSONRpcClient.cancelRequest=function(a){if(JSONRpcClient.async_inflight[a])return JSONRpcClient.async_inflight[a].canceled=!0;var b;for(b=0;b<JSONRpcClient.async_requests.length;b++)if(JSONRpcClient.async_requests[b].requestId==a)return JSONRpcClient.async_requests[b].canceled=!0;for(b=0;b<JSONRpcClient.async_responses.length;b++)if(JSONRpcClient.async_responses[b].requestId==a)return JSONRpcClient.async_responses[b].canceled=!0;return!1};
JSONRpcClient._makeRequest=function(a,b,c,d,e){var g={};g.client=a;g.requestId=JSONRpcClient.requestId++;g.methodName=b;a="{id:"+g.requestId+",method:";a=d&&0<d?a+('".obj['+d+"]."+b+'"'):a+('"'+b+'"');e&&(g.cb=e);JSONRpcClient.profile_async&&(g.profile={submit:new Date});b=toJSON(c);a+=",params:"+b.json;b.fixups&&(a+=",fixups:"+toJSON(b.fixups).json);g.data=a+"}";return g};
JSONRpcClient._sendRequest=function(a,b){var c;b.profile&&(b.profile.start=new Date);c=JSONRpcClient.poolGetHTTPRequest();JSONRpcClient.num_req_active++;c.open("POST",a.serverURL,!!b.cb,a.user,a.pass);try{c.setRequestHeader("Content-type","text/plain"),c.setRequestHeader("X-RPC-Method",b.methodName)}catch(d){}c.onreadystatechange=b.cb?function(){var d;if(4==c.readyState){c.onreadystatechange=function(){};d={cb:b.cb,result:null,ex:null};b.profile?(d.profile=b.profile,d.profile.end=new Date):d.profile=
!1;try{d.result=a._handleResponse(c)}catch(e){d.ex=e}JSONRpcClient.async_inflight[b.requestId].canceled||JSONRpcClient.async_responses.push(d);delete JSONRpcClient.async_inflight[b.requestId];JSONRpcClient.kick_async()}}:function(){};JSONRpcClient.async_inflight[b.requestId]=b;try{c.send(b.data)}catch(d){throw JSONRpcClient.poolReturnHTTPRequest(c),JSONRpcClient.num_req_active--,new JSONRpcClient.Exception({code:JSONRpcClient.Exception.CODE_ERR_CLIENT,message:"Connection failed"});}return b.cb?null:
(delete JSONRpcClient.async_inflight[b.requestId],a._handleResponse(c))};
JSONRpcClient.prototype._handleResponse=function(a){this.charset||(this.charset=JSONRpcClient._getCharsetFromHeaders(a));var b,c,d;try{b=a.status,c=a.statusText,d=a.responseText}catch(e){throw JSONRpcClient.poolReturnHTTPRequest(a),JSONRpcClient.num_req_active--,JSONRpcClient.kick_async(),new JSONRpcClient.Exception({code:JSONRpcClient.Exception.CODE_ERR_CLIENT,message:"Connection failed"});}JSONRpcClient.poolReturnHTTPRequest(a);JSONRpcClient.num_req_active--;if(200!=b)throw new JSONRpcClient.Exception({code:b,
message:c});return this.unmarshallResponse(d)};
JSONRpcClient.prototype.unmarshallResponse=function(a){function b(a,b){function c(a,b){for(var d=0,e=b.length;d<e;d++)a=a[b[d]];return a}function d(a,b,c){for(var e=b.length-1,g=0;g<e;g++)a=a[b[g]];a[b[e]]=c}for(var f=0,l=b.length;f<l;f++)d(a,b[f][0],c(a,b[f][1]))}function c(a){var b;if(a&&"object"===typeof a){if(a.javaClass&&JSONRpcClient.javaDateClasses[a.javaClass])return b=new Date(a.time),"java.util.Date"!==a.javaClass&&(b.javaClass=a.javaClass),b;var d;if(d=JSONRpcClient.transformDateWithoutHint)a:{var m;
d=0;if(a.hasOwnProperty("time")){for(m in a)if(a.hasOwnProperty(m)&&(d++,1<d)){d=!1;break a}d=!0}else d=void 0}if(d)return new Date(a.time);for(b in a)a.hasOwnProperty(b)&&(a[b]=c(a[b]))}return a}var d;try{d=JSON.parse(a)}catch(e){throw new JSONRpcClient.Exception({code:550,message:"error parsing result"});}if(d.error)throw new JSONRpcClient.Exception(d.error);if(a=d.result){if(a.objectID&&"CallableReference"==a.JSONRPCType)return this.createCallableProxy(a.objectID,a.javaClass);a=JSONRpcClient.extractCallableReferences(this,
JSONRpcClient.transformDates?c(a):a);d.fixups&&b(a,d.fixups)}return a};JSONRpcClient.extractCallableReferences=function(a,b){var c,d,e;for(c in b)"object"==typeof b[c]&&((d=JSONRpcClient.makeCallableReference(a,b[c]))||(d=JSONRpcClient.extractCallableReferences(a,b[c])),b[c]=d),"object"==typeof c&&((d=JSONRpcClient.makeCallableReference(a,c))||(d=JSONRpcClient.extractCallableReferences(a,c)),e=b[c],delete b[c],b[d]=e);return b};
JSONRpcClient.makeCallableReference=function(a,b){return b&&b.objectID&&b.javaClass&&"CallableReference"==b.JSONRPCType?a.createCallableProxy(b.objectID,b.javaClass):null};JSONRpcClient.http_spare=[];JSONRpcClient.http_max_spare=8;JSONRpcClient.poolGetHTTPRequest=function(){var a=JSONRpcClient.http_spare.pop();return a?a:JSONRpcClient.getHTTPRequest()};JSONRpcClient.poolReturnHTTPRequest=function(a){JSONRpcClient.http_spare.length>=JSONRpcClient.http_max_spare?delete a:JSONRpcClient.http_spare.push(a)};
JSONRpcClient.msxmlNames="MSXML2.XMLHTTP.6.0 MSXML2.XMLHTTP.3.0 MSXML2.XMLHTTP MSXML2.XMLHTTP.5.0 MSXML2.XMLHTTP.4.0 Microsoft.XMLHTTP".split(" ");
JSONRpcClient.getHTTPRequest=function(){try{return JSONRpcClient.httpObjectName="XMLHttpRequest",new XMLHttpRequest}catch(b){}for(var a=0;a<JSONRpcClient.msxmlNames.length;a++)try{return JSONRpcClient.httpObjectName=JSONRpcClient.msxmlNames[a],new ActiveXObject(JSONRpcClient.msxmlNames[a])}catch(b){}JSONRpcClient.httpObjectName=null;throw new JSONRpcClient.Exception({code:0,message:"Can't create XMLHttpRequest object"});};
